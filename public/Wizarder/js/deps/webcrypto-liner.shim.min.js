var _excluded=["name","optional","primitiveSchema"],_excluded2=["value"],_excluded3=["isHexOnly"],_excluded4=["value","isIndefiniteForm"],_excluded5=["value"],_excluded6=["isConstructed"],_excluded7=["idBlock","lenBlock"],_excluded8=["unusedBits","isConstructed"],_excluded9=["idBlock","lenBlock"],_excluded10=["value"],_excluded11=["valueDec","isFirstSid"],_excluded12=["value"],_excluded13=["valueDec"],_excluded14=["value"],_excluded15=["value","valueDate"],_excluded16=["value"],_excluded17=["value","local"];function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _regeneratorRuntime(){"use strict";_regeneratorRuntime=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n=Object.defineProperty||function(e,t,r){e[t]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(e){s=function(e,t,r){return e[t]=r}}function c(e,t,r,i){var a=t&&t.prototype instanceof f?t:f,o=Object.create(a.prototype),u=new A(i||[]);return n(o,"_invoke",{value:b(e,r,u)}),o}function l(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var h={};function f(){}function p(){}function v(){}var y={};s(y,a,(function(){return this}));var g=Object.getPrototypeOf,d=g&&g(g(x([])));d&&d!==t&&r.call(d,a)&&(y=d);var m=v.prototype=f.prototype=Object.create(y);function k(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function w(e,t){function i(n,a,o,u){var s=l(e[n],e,a);if("throw"!==s.type){var c=s.arg,h=c.value;return h&&"object"==_typeof(h)&&r.call(h,"__await")?t.resolve(h.__await).then((function(e){i("next",e,o,u)}),(function(e){i("throw",e,o,u)})):t.resolve(h).then((function(e){c.value=e,o(c)}),(function(e){return i("throw",e,o,u)}))}u(s.arg)}var a;n(this,"_invoke",{value:function(e,r){function n(){return new t((function(t,n){i(e,r,t,n)}))}return a=a?a.then(n,n):n()}})}function b(e,t,r){var n="suspendedStart";return function(i,a){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw a;return B()}for(r.method=i,r.arg=a;;){var o=r.delegate;if(o){var u=_(o,r);if(u){if(u===h)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var s=l(e,t,r);if("normal"===s.type){if(n=r.done?"completed":"suspendedYield",s.arg===h)continue;return{value:s.arg,done:r.done}}"throw"===s.type&&(n="completed",r.method="throw",r.arg=s.arg)}}}function _(e,t){var r=t.method,n=e.iterator[r];if(void 0===n)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=void 0,_(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),h;var i=l(n,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,h;var a=i.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,h):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,h)}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function S(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function x(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,i=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:B}}function B(){return{value:void 0,done:!0}}return p.prototype=v,n(m,"constructor",{value:v,configurable:!0}),n(v,"constructor",{value:p,configurable:!0}),p.displayName=s(v,u,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,s(e,u,"GeneratorFunction")),e.prototype=Object.create(m),e},e.awrap=function(e){return{__await:e}},k(w.prototype),s(w.prototype,o,(function(){return this})),e.AsyncIterator=w,e.async=function(t,r,n,i,a){void 0===a&&(a=Promise);var o=new w(c(t,r,n,i),a);return e.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},k(m),s(m,u,"Generator"),s(m,a,(function(){return this})),s(m,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},e.values=x,A.prototype={constructor:A,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(S),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return o.type="throw",o.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],o=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var u=r.call(a,"catchLoc"),s=r.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,h):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),S(r),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;S(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:x(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),h}},e}function asyncGeneratorStep(e,t,r,n,i,a,o){try{var u=e[a](o),s=u.value}catch(e){return void r(e)}u.done?t(s):Promise.resolve(s).then(n,i)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function o(e){asyncGeneratorStep(a,n,i,o,u,"next",e)}function u(e){asyncGeneratorStep(a,n,i,o,u,"throw",e)}o(void 0)}))}}function _wrapNativeSuper(e){var t="function"==typeof Map?new Map:void 0;return _wrapNativeSuper=function(e){if(null===e||!_isNativeFunction(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return _construct(e,arguments,_getPrototypeOf(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(r,e)},_wrapNativeSuper(e)}function _construct(e,t,r){return _construct=_isNativeReflectConstruct()?Reflect.construct.bind():function(e,t,r){var n=[null];n.push.apply(n,t);var i=new(Function.bind.apply(e,n));return r&&_setPrototypeOf(i,r.prototype),i},_construct.apply(null,arguments)}function _isNativeFunction(e){return-1!==Function.toString.call(e).indexOf("[native code]")}function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _objectDestructuringEmpty(e){if(null==e)throw new TypeError("Cannot destructure "+e)}function _objectWithoutProperties(e,t){if(null==e)return{};var r,n,i=_objectWithoutPropertiesLoose(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var r,n,i={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(r),!0).forEach((function(t){_defineProperty(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _defineProperty(e,t,r){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _get(){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=_superPropBase(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(arguments.length<3?e:r):i.value}},_get.apply(this,arguments)}function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},_setPrototypeOf(e,t)}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var r,n=_getPrototypeOf(e);if(t){var i=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf(e){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf(e)}function _createForOfIteratorHelper(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){u=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(u)throw a}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_toPropertyKey(n.key),n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"===_typeof(t)?t:String(t)}function _toPrimitive(e,t){if("object"!==_typeof(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var liner=function(e,t,r){"use strict";var n;function i(e){var t=Object.create(null);return e&&Object.keys(e).forEach((function(r){if("default"!==r){var n=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return e[r]}})}})),t.default=e,Object.freeze(t)}var a=i(t),o=i(r),u={};"undefined"!=typeof self&&(u=self),e.nativeCrypto=u.msCrypto||u.crypto||{},e.nativeSubtle=null;try{e.nativeSubtle=(null===e.nativeCrypto||void 0===e.nativeCrypto?void 0:e.nativeCrypto.subtle)||(null===e.nativeCrypto||void 0===e.nativeCrypto?void 0:e.nativeCrypto.webkitSubtle)||null}catch(e){console.warn("Cannot get subtle from crypto",e)}var s=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"isArrayBuffer",value:function(e){return"[object ArrayBuffer]"===Object.prototype.toString.call(e)}},{key:"toArrayBuffer",value:function(e){return this.isArrayBuffer(e)?e:e.byteLength===e.buffer.byteLength?e.buffer:this.toUint8Array(e).slice().buffer}},{key:"toUint8Array",value:function(e){return this.toView(e,Uint8Array)}},{key:"toView",value:function(e,t){if(e.constructor===t)return e;if(this.isArrayBuffer(e))return new t(e);if(this.isArrayBufferView(e))return new t(e.buffer,e.byteOffset,e.byteLength);throw new TypeError("The provided value is not of type '(ArrayBuffer or ArrayBufferView)'")}},{key:"isBufferSource",value:function(e){return this.isArrayBufferView(e)||this.isArrayBuffer(e)}},{key:"isArrayBufferView",value:function(e){return ArrayBuffer.isView(e)||e&&this.isArrayBuffer(e.buffer)}},{key:"isEqual",value:function(t,r){var n=e.toUint8Array(t),i=e.toUint8Array(r);if(n.length!==i.byteLength)return!1;for(var a=0;a<n.length;a++)if(n[a]!==i[a])return!1;return!0}},{key:"concat",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];if(Array.isArray(t[0])){var n,i=t[0],a=0,o=_createForOfIteratorHelper(i);try{for(o.s();!(n=o.n()).done;){a+=n.value.byteLength}}catch(e){o.e(e)}finally{o.f()}var u,s=new Uint8Array(a),c=0,l=_createForOfIteratorHelper(i);try{for(l.s();!(u=l.n()).done;){var h=u.value,f=this.toUint8Array(h);s.set(f,c),c+=f.length}}catch(e){l.e(e)}finally{l.f()}return t[1]?this.toView(s,t[1]):s.buffer}return this.concat(t)}}]),e}(),c=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"fromString",value:function(e){for(var t=unescape(encodeURIComponent(e)),r=new Uint8Array(t.length),n=0;n<t.length;n++)r[n]=t.charCodeAt(n);return r.buffer}},{key:"toString",value:function(e){for(var t=s.toUint8Array(e),r="",n=0;n<t.length;n++)r+=String.fromCharCode(t[n]);return decodeURIComponent(escape(r))}}]),e}(),l=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"toString",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=s.toArrayBuffer(e),n=new DataView(r),i="",a=0;a<r.byteLength;a+=2){var o=n.getUint16(a,t);i+=String.fromCharCode(o)}return i}},{key:"fromString",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=new ArrayBuffer(2*e.length),n=new DataView(r),i=0;i<e.length;i++)n.setUint16(2*i,e.charCodeAt(i),t);return r}}]),e}(),h=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"isHex",value:function(e){return"string"==typeof e&&/^[a-z0-9]+$/i.test(e)}},{key:"isBase64",value:function(e){return"string"==typeof e&&/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}},{key:"isBase64Url",value:function(e){return"string"==typeof e&&/^[a-zA-Z0-9-_]+$/i.test(e)}},{key:"ToString",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf8",r=s.toUint8Array(e);switch(t.toLowerCase()){case"utf8":return this.ToUtf8String(r);case"binary":return this.ToBinary(r);case"hex":return this.ToHex(r);case"base64":return this.ToBase64(r);case"base64url":return this.ToBase64Url(r);case"utf16le":return l.toString(r,!0);case"utf16":case"utf16be":return l.toString(r);default:throw new Error("Unknown type of encoding '".concat(t,"'"))}}},{key:"FromString",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf8";if(!e)return new ArrayBuffer(0);switch(t.toLowerCase()){case"utf8":return this.FromUtf8String(e);case"binary":return this.FromBinary(e);case"hex":return this.FromHex(e);case"base64":return this.FromBase64(e);case"base64url":return this.FromBase64Url(e);case"utf16le":return l.fromString(e,!0);case"utf16":case"utf16be":return l.fromString(e);default:throw new Error("Unknown type of encoding '".concat(t,"'"))}}},{key:"ToBase64",value:function(e){var t=s.toUint8Array(e);if("undefined"!=typeof btoa){var r=this.ToString(t,"binary");return btoa(r)}return Buffer.from(t).toString("base64")}},{key:"FromBase64",value:function(t){var r=this.formatString(t);if(!r)return new ArrayBuffer(0);if(!e.isBase64(r))throw new TypeError("Argument 'base64Text' is not Base64 encoded");return"undefined"!=typeof atob?this.FromBinary(atob(r)):new Uint8Array(Buffer.from(r,"base64")).buffer}},{key:"FromBase64Url",value:function(t){var r=this.formatString(t);if(!r)return new ArrayBuffer(0);if(!e.isBase64Url(r))throw new TypeError("Argument 'base64url' is not Base64Url encoded");return this.FromBase64(this.Base64Padding(r.replace(/\-/g,"+").replace(/\_/g,"/")))}},{key:"ToBase64Url",value:function(e){return this.ToBase64(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}},{key:"FromUtf8String",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.DEFAULT_UTF8_ENCODING;switch(r){case"ascii":return this.FromBinary(t);case"utf8":return c.fromString(t);case"utf16":case"utf16be":return l.fromString(t);case"utf16le":case"usc2":return l.fromString(t,!0);default:throw new Error("Unknown type of encoding '".concat(r,"'"))}}},{key:"ToUtf8String",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.DEFAULT_UTF8_ENCODING;switch(r){case"ascii":return this.ToBinary(t);case"utf8":return c.toString(t);case"utf16":case"utf16be":return l.toString(t);case"utf16le":case"usc2":return l.toString(t,!0);default:throw new Error("Unknown type of encoding '".concat(r,"'"))}}},{key:"FromBinary",value:function(e){for(var t=e.length,r=new Uint8Array(t),n=0;n<t;n++)r[n]=e.charCodeAt(n);return r.buffer}},{key:"ToBinary",value:function(e){for(var t=s.toUint8Array(e),r="",n=0;n<t.length;n++)r+=String.fromCharCode(t[n]);return r}},{key:"ToHex",value:function(e){for(var t=s.toUint8Array(e),r=[],n=t.length,i=0;i<n;i++){var a=t[i].toString(16).padStart(2,"0");r.push(a)}return r.join("")}},{key:"FromHex",value:function(t){var r=this.formatString(t);if(!r)return new ArrayBuffer(0);if(!e.isHex(r))throw new TypeError("Argument 'hexString' is not HEX encoded");r.length%2&&(r="0".concat(r));for(var n=new Uint8Array(r.length/2),i=0;i<r.length;i+=2){var a=r.slice(i,i+2);n[i/2]=parseInt(a,16)}return n.buffer}},{key:"ToUtf16String",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return l.toString(e,t)}},{key:"FromUtf16String",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return l.fromString(e,t)}},{key:"Base64Padding",value:function(e){var t=4-e.length%4;if(t<4)for(var r=0;r<t;r++)e+="=";return e}},{key:"formatString",value:function(e){return(null==e?void 0:e.replace(/[\n\r\t ]/g,""))||""}}]),e}();function f(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=t.map((function(e){return e.byteLength})).reduce((function(e,t){return e+t})),i=new Uint8Array(n),a=0;return t.map((function(e){return new Uint8Array(e)})).forEach((function(e){var t,r=_createForOfIteratorHelper(e);try{for(r.s();!(t=r.n()).done;){var n=t.value;i[a++]=n}}catch(e){r.e(e)}finally{r.f()}})),i.buffer}function p(e,t){var r=0;if(1===e.length)return e[0];for(var n=e.length-1;n>=0;n--)r+=e[e.length-1-n]*Math.pow(2,t*n);return r}function v(e,t){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,n=e,i=0,a=Math.pow(2,t),o=1;o<8;o++){if(e<a){var u=void 0;if(r<0)u=new ArrayBuffer(o),i=o;else{if(r<o)return new ArrayBuffer(0);u=new ArrayBuffer(r),i=r}for(var s=new Uint8Array(u),c=o-1;c>=0;c--){var l=Math.pow(2,c*t);s[i-c-1]=Math.floor(n/l),n-=s[i-c-1]*l}return u}a*=Math.pow(2,t)}return new ArrayBuffer(0)}function y(){for(var e=0,t=0,r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];for(var a=0,o=n;a<o.length;a++){e+=o[a].length}for(var u=new ArrayBuffer(e),s=new Uint8Array(u),c=0,l=n;c<l.length;c++){var h=l[c];s.set(h,t),t+=h.length}return s}function g(){var e=new Uint8Array(this.valueHex);if(this.valueHex.byteLength>=2){var t=255===e[0]&&128&e[1],r=0===e[0]&&0==(128&e[1]);(t||r)&&this.warnings.push("Needlessly long format")}for(var n=new ArrayBuffer(this.valueHex.byteLength),i=new Uint8Array(n),a=0;a<this.valueHex.byteLength;a++)i[a]=0;i[0]=128&e[0];for(var o=p(i,8),u=new ArrayBuffer(this.valueHex.byteLength),s=new Uint8Array(u),c=0;c<this.valueHex.byteLength;c++)s[c]=e[c];return s[0]&=127,p(s,8)-o}function d(e,t){var r=e.toString(10);if(t<r.length)return"";for(var n=t-r.length,i=new Array(n),a=0;a<n;a++)i[a]="0";return i.join("").concat(r)}function m(){if("undefined"==typeof BigInt)throw new Error("BigInt is not defined. Your environment doesn't implement BigInt.")}function k(e){for(var t=0,r=0,n=0;n<e.length;n++){t+=e[n].byteLength}for(var i=new Uint8Array(t),a=0;a<e.length;a++){var o=e[a];i.set(new Uint8Array(o),r),r+=o.byteLength}return i.buffer}function w(e,t,r,n){return t instanceof Uint8Array?t.byteLength?r<0?(e.error="Wrong parameter: inputOffset less than zero",!1):n<0?(e.error="Wrong parameter: inputLength less than zero",!1):!(t.byteLength-r-n<0)||(e.error="End of input reached before message was fully decoded (inconsistent offset and length values)",!1):(e.error="Wrong parameter: inputBuffer has zero length",!1):(e.error="Wrong parameter: inputBuffer must be 'Uint8Array'",!1)}h.DEFAULT_UTF8_ENCODING="utf8";var b=function(){function e(){_classCallCheck(this,e),this.items=[]}return _createClass(e,[{key:"write",value:function(e){this.items.push(e)}},{key:"final",value:function(){return k(this.items)}}]),e}(),_=[new Uint8Array([1])],C="0123456789",S="name",A="valueHexView",x="isHexOnly",B="idBlock",E="tagClass",R="tagNumber",K="isConstructed",O="fromBER",N="toBER",P="local",U="",I=new ArrayBuffer(0),L=new Uint8Array(0),T="EndOfContent",j="OCTET STRING",H="BIT STRING";function V(e){var t;return t=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n;_classCallCheck(this,r);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];e=t.call.apply(t,[this].concat(a));var u=a[0]||{};return e.isHexOnly=null!==(n=u.isHexOnly)&&void 0!==n&&n,e.valueHexView=u.valueHex?s.toUint8Array(u.valueHex):L,e}return _createClass(r,[{key:"valueHex",get:function(){return this.valueHexView.slice().buffer},set:function(e){this.valueHexView=new Uint8Array(e)}},{key:"fromBER",value:function(e,t,r){var n=e instanceof ArrayBuffer?new Uint8Array(e):e;if(!w(this,n,t,r))return-1;var i=t+r;return this.valueHexView=n.subarray(t,i),this.valueHexView.length?(this.blockLength=r,i):(this.warnings.push("Zero buffer length"),t)}},{key:"toBER",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.isHexOnly?e?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.byteLength===this.valueHexView.buffer.byteLength?this.valueHexView.buffer:this.valueHexView.slice().buffer:(this.error="Flag 'isHexOnly' is not set, abort",I)}},{key:"toJSON",value:function(){return _objectSpread(_objectSpread({},_get(_getPrototypeOf(r.prototype),"toJSON",this).call(this)),{},{isHexOnly:this.isHexOnly,valueHex:h.ToHex(this.valueHexView)})}}]),r}(e),t.NAME="hexBlock",t}var D=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.blockLength,n=void 0===r?0:r,i=t.error,a=void 0===i?U:i,o=t.warnings,u=void 0===o?[]:o,c=t.valueBeforeDecode,l=void 0===c?L:c;_classCallCheck(this,e),this.blockLength=n,this.error=a,this.warnings=u,this.valueBeforeDecodeView=s.toUint8Array(l)}return _createClass(e,[{key:"valueBeforeDecode",get:function(){return this.valueBeforeDecodeView.slice().buffer},set:function(e){this.valueBeforeDecodeView=new Uint8Array(e)}},{key:"toJSON",value:function(){return{blockName:this.constructor.NAME,blockLength:this.blockLength,error:this.error,warnings:this.warnings,valueBeforeDecode:h.ToHex(this.valueBeforeDecodeView)}}}],[{key:"blockName",value:function(){return this.NAME}}]),e}();D.NAME="baseBlock";var M=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,[{key:"fromBER",value:function(e,t,r){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}},{key:"toBER",value:function(e,t){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}}]),r}(D);M.NAME="valueBlock";var F=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n,i,a,o,u=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).idBlock,c=void 0===u?{}:u;return _classCallCheck(this,r),e=t.call(this),c?(e.isHexOnly=null!==(n=c.isHexOnly)&&void 0!==n&&n,e.valueHexView=c.valueHex?s.toUint8Array(c.valueHex):L,e.tagClass=null!==(i=c.tagClass)&&void 0!==i?i:-1,e.tagNumber=null!==(a=c.tagNumber)&&void 0!==a?a:-1,e.isConstructed=null!==(o=c.isConstructed)&&void 0!==o&&o):(e.tagClass=-1,e.tagNumber=-1,e.isConstructed=!1),e}return _createClass(r,[{key:"toBER",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=0;switch(this.tagClass){case 1:t|=0;break;case 2:t|=64;break;case 3:t|=128;break;case 4:t|=192;break;default:return this.error="Unknown tag class",I}if(this.isConstructed&&(t|=32),this.tagNumber<31&&!this.isHexOnly){var r=new Uint8Array(1);if(!e){var n=this.tagNumber;t|=n&=31,r[0]=t}return r.buffer}if(!this.isHexOnly){var i=v(this.tagNumber,7),a=new Uint8Array(i),o=i.byteLength,u=new Uint8Array(o+1);if(u[0]=31|t,!e){for(var s=0;s<o-1;s++)u[s+1]=128|a[s];u[o]=a[o-1]}return u.buffer}var c=new Uint8Array(this.valueHexView.byteLength+1);if(c[0]=31|t,!e){for(var l=this.valueHexView,h=0;h<l.length-1;h++)c[h+1]=128|l[h];c[this.valueHexView.byteLength]=l[l.length-1]}return c.buffer}},{key:"fromBER",value:function(e,t,r){var n=s.toUint8Array(e);if(!w(this,n,t,r))return-1;var i=n.subarray(t,t+r);if(0===i.length)return this.error="Zero buffer length",-1;switch(192&i[0]){case 0:this.tagClass=1;break;case 64:this.tagClass=2;break;case 128:this.tagClass=3;break;case 192:this.tagClass=4;break;default:return this.error="Unknown tag class",-1}this.isConstructed=32==(32&i[0]),this.isHexOnly=!1;var a=31&i[0];if(31!==a)this.tagNumber=a,this.blockLength=1;else{for(var o=1,u=this.valueHexView=new Uint8Array(255),c=255;128&i[o];){if(u[o-1]=127&i[o],++o>=i.length)return this.error="End of input reached before message was fully decoded",-1;if(o===c){c+=255;for(var l=new Uint8Array(c),h=0;h<u.length;h++)l[h]=u[h];u=this.valueHexView=new Uint8Array(c)}}this.blockLength=o+1,u[o-1]=127&i[o];for(var f=new Uint8Array(o),v=0;v<o;v++)f[v]=u[v];(u=this.valueHexView=new Uint8Array(o)).set(f),this.blockLength<=9?this.tagNumber=p(u,7):(this.isHexOnly=!0,this.warnings.push("Tag too long, represented as hex-coded"))}if(1===this.tagClass&&this.isConstructed)switch(this.tagNumber){case 1:case 2:case 5:case 6:case 9:case 13:case 14:case 23:case 24:case 31:case 32:case 33:case 34:return this.error="Constructed encoding used for primitive type",-1}return t+this.blockLength}},{key:"toJSON",value:function(){return _objectSpread(_objectSpread({},_get(_getPrototypeOf(r.prototype),"toJSON",this).call(this)),{},{tagClass:this.tagClass,tagNumber:this.tagNumber,isConstructed:this.isConstructed})}}]),r}(V(D));F.NAME="identificationBlock";var J=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n,i,a,o=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).lenBlock,u=void 0===o?{}:o;return _classCallCheck(this,r),(e=t.call(this)).isIndefiniteForm=null!==(n=u.isIndefiniteForm)&&void 0!==n&&n,e.longFormUsed=null!==(i=u.longFormUsed)&&void 0!==i&&i,e.length=null!==(a=u.length)&&void 0!==a?a:0,e}return _createClass(r,[{key:"fromBER",value:function(e,t,r){var n=s.toUint8Array(e);if(!w(this,n,t,r))return-1;var i=n.subarray(t,t+r);if(0===i.length)return this.error="Zero buffer length",-1;if(255===i[0])return this.error="Length block 0xFF is reserved by standard",-1;if(this.isIndefiniteForm=128===i[0],this.isIndefiniteForm)return this.blockLength=1,t+this.blockLength;if(this.longFormUsed=!!(128&i[0]),!1===this.longFormUsed)return this.length=i[0],this.blockLength=1,t+this.blockLength;var a=127&i[0];if(a>8)return this.error="Too big integer",-1;if(a+1>i.length)return this.error="End of input reached before message was fully decoded",-1;var o=t+1,u=n.subarray(o,o+a);return 0===u[a-1]&&this.warnings.push("Needlessly long encoded length"),this.length=p(u,8),this.longFormUsed&&this.length<=127&&this.warnings.push("Unnecessary usage of long length form"),this.blockLength=a+1,t+this.blockLength}},{key:"toBER",value:function(){var e,t,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.length>127&&(this.longFormUsed=!0),this.isIndefiniteForm)return e=new ArrayBuffer(1),!1===r&&((t=new Uint8Array(e))[0]=128),e;if(this.longFormUsed){var n=v(this.length,8);if(n.byteLength>127)return this.error="Too big length",I;if(e=new ArrayBuffer(n.byteLength+1),r)return e;var i=new Uint8Array(n);(t=new Uint8Array(e))[0]=128|n.byteLength;for(var a=0;a<n.byteLength;a++)t[a+1]=i[a];return e}return e=new ArrayBuffer(1),!1===r&&((t=new Uint8Array(e))[0]=this.length),e}},{key:"toJSON",value:function(){return _objectSpread(_objectSpread({},_get(_getPrototypeOf(r.prototype),"toJSON",this).call(this)),{},{isIndefiniteForm:this.isIndefiniteForm,longFormUsed:this.longFormUsed,length:this.length})}}]),r}(D);J.NAME="lengthBlock";var G={},z=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=n.name,a=void 0===i?U:i,o=n.optional,u=void 0!==o&&o,s=n.primitiveSchema,c=_objectWithoutProperties(n,_excluded),l=arguments.length>1?arguments[1]:void 0;return _classCallCheck(this,r),(e=t.call(this,c)).name=a,e.optional=u,s&&(e.primitiveSchema=s),e.idBlock=new F(c),e.lenBlock=new J(c),e.valueBlock=l?new l(c):new M(c),e}return _createClass(r,[{key:"fromBER",value:function(e,t,r){var n=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===n?(this.error=this.valueBlock.error,n):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),n)}},{key:"toBER",value:function(e,t){var r=t||new b;t||q(this);var n=this.idBlock.toBER(e);if(r.write(n),this.lenBlock.isIndefiniteForm)r.write(new Uint8Array([128]).buffer),this.valueBlock.toBER(e,r),r.write(new ArrayBuffer(2));else{var i=this.valueBlock.toBER(e);this.lenBlock.length=i.byteLength;var a=this.lenBlock.toBER(e);r.write(a),r.write(i)}return t?I:r.final()}},{key:"toJSON",value:function(){var e=_objectSpread(_objectSpread({},_get(_getPrototypeOf(r.prototype),"toJSON",this).call(this)),{},{idBlock:this.idBlock.toJSON(),lenBlock:this.lenBlock.toJSON(),valueBlock:this.valueBlock.toJSON(),name:this.name,optional:this.optional});return this.primitiveSchema&&(e.primitiveSchema=this.primitiveSchema.toJSON()),e}},{key:"toString",value:function(){return"ascii"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"ascii")?this.onAsciiEncoding():h.ToHex(this.toBER())}},{key:"onAsciiEncoding",value:function(){return"".concat(this.constructor.NAME," : ").concat(h.ToHex(this.valueBlock.valueBeforeDecodeView))}},{key:"isEqual",value:function(e){return this===e||e instanceof this.constructor&&function(e,t){if(e.byteLength!==t.byteLength)return!1;for(var r=new Uint8Array(e),n=new Uint8Array(t),i=0;i<r.length;i++)if(r[i]!==n[i])return!1;return!0}(this.toBER(),e.toBER())}}]),r}(D);function q(e){if(e instanceof G.Constructed){var t,r=_createForOfIteratorHelper(e.valueBlock.value);try{for(r.s();!(t=r.n()).done;){q(t.value)&&(e.lenBlock.isIndefiniteForm=!0)}}catch(e){r.e(e)}finally{r.f()}}return!!e.lenBlock.isIndefiniteForm}z.NAME="BaseBlock";var W=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=n.value,a=void 0===i?U:i,o=_objectWithoutProperties(n,_excluded2),u=arguments.length>1?arguments[1]:void 0;return _classCallCheck(this,r),e=t.call(this,o,u),a&&e.fromString(a),e}return _createClass(r,[{key:"getValue",value:function(){return this.valueBlock.value}},{key:"setValue",value:function(e){this.valueBlock.value=e}},{key:"fromBER",value:function(e,t,r){var n=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===n?(this.error=this.valueBlock.error,n):(this.fromBuffer(this.valueBlock.valueHexView),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),n)}},{key:"onAsciiEncoding",value:function(){return"".concat(this.constructor.NAME," : '").concat(this.valueBlock.value,"'")}}]),r}(z);W.NAME="BaseStringBlock";var X,Z=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=n.isHexOnly,a=void 0===i||i,o=_objectWithoutProperties(n,_excluded3);return _classCallCheck(this,r),(e=t.call(this,o)).isHexOnly=a,e}return _createClass(r)}(V(M));Z.NAME="PrimitiveValueBlock";var $=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n,Z)).idBlock.isConstructed=!1,e}return _createClass(r)}(z);function Y(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.length,n=t,i=new z({},M),a=new D;if(!w(a,e,t,r))return i.error=a.error,{offset:-1,result:i};if(!e.subarray(t,t+r).length)return i.error="Zero buffer length",{offset:-1,result:i};var o=i.idBlock.fromBER(e,t,r);if(i.idBlock.warnings.length&&i.warnings.concat(i.idBlock.warnings),-1===o)return i.error=i.idBlock.error,{offset:-1,result:i};if(t=o,r-=i.idBlock.blockLength,o=i.lenBlock.fromBER(e,t,r),i.lenBlock.warnings.length&&i.warnings.concat(i.lenBlock.warnings),-1===o)return i.error=i.lenBlock.error,{offset:-1,result:i};if(t=o,r-=i.lenBlock.blockLength,!i.idBlock.isConstructed&&i.lenBlock.isIndefiniteForm)return i.error="Indefinite length form used for primitive encoding form",{offset:-1,result:i};var u=z;if(1===i.idBlock.tagClass){if(i.idBlock.tagNumber>=37&&!1===i.idBlock.isHexOnly)return i.error="UNIVERSAL 37 and upper tags are reserved by ASN.1 standard",{offset:-1,result:i};switch(i.idBlock.tagNumber){case 0:if(i.idBlock.isConstructed&&i.lenBlock.length>0)return i.error="Type [UNIVERSAL 0] is reserved",{offset:-1,result:i};u=G.EndOfContent;break;case 1:u=G.Boolean;break;case 2:u=G.Integer;break;case 3:u=G.BitString;break;case 4:u=G.OctetString;break;case 5:u=G.Null;break;case 6:u=G.ObjectIdentifier;break;case 10:u=G.Enumerated;break;case 12:u=G.Utf8String;break;case 13:u=G.RelativeObjectIdentifier;break;case 14:u=G.TIME;break;case 15:return i.error="[UNIVERSAL 15] is reserved by ASN.1 standard",{offset:-1,result:i};case 16:u=G.Sequence;break;case 17:u=G.Set;break;case 18:u=G.NumericString;break;case 19:u=G.PrintableString;break;case 20:u=G.TeletexString;break;case 21:u=G.VideotexString;break;case 22:u=G.IA5String;break;case 23:u=G.UTCTime;break;case 24:u=G.GeneralizedTime;break;case 25:u=G.GraphicString;break;case 26:u=G.VisibleString;break;case 27:u=G.GeneralString;break;case 28:u=G.UniversalString;break;case 29:u=G.CharacterString;break;case 30:u=G.BmpString;break;case 31:u=G.DATE;break;case 32:u=G.TimeOfDay;break;case 33:u=G.DateTime;break;case 34:u=G.Duration;break;default:var s=i.idBlock.isConstructed?new G.Constructed:new G.Primitive;s.idBlock=i.idBlock,s.lenBlock=i.lenBlock,s.warnings=i.warnings,i=s}}else u=i.idBlock.isConstructed?G.Constructed:G.Primitive;return i=function(e,t){if(e instanceof t)return e;var r=new t;return r.idBlock=e.idBlock,r.lenBlock=e.lenBlock,r.warnings=e.warnings,r.valueBeforeDecodeView=e.valueBeforeDecodeView,r}(i,u),o=i.fromBER(e,t,i.lenBlock.isIndefiniteForm?r:i.lenBlock.length),i.valueBeforeDecodeView=e.subarray(n,n+i.blockLength),{offset:o,result:i}}function Q(e){if(!e.byteLength){var t=new z({},M);return t.error="Input buffer has zero length",{offset:-1,result:t}}return Y(s.toUint8Array(e).slice(),0,e.byteLength)}X=$,G.Primitive=X,$.NAME="PRIMITIVE";var ee,te=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=n.value,a=void 0===i?[]:i,o=n.isIndefiniteForm,u=void 0!==o&&o,s=_objectWithoutProperties(n,_excluded4);return _classCallCheck(this,r),(e=t.call(this,s)).value=a,e.isIndefiniteForm=u,e}return _createClass(r,[{key:"fromBER",value:function(e,t,r){var n=s.toUint8Array(e);if(!w(this,n,t,r))return-1;if(this.valueBeforeDecodeView=n.subarray(t,t+r),0===this.valueBeforeDecodeView.length)return this.warnings.push("Zero buffer length"),t;for(var i,a,o=t;i=this.isIndefiniteForm,a=r,(i?1:a)>0;){var u=Y(n,o,r);if(-1===u.offset)return this.error=u.result.error,this.warnings.concat(u.result.warnings),-1;if(o=u.offset,this.blockLength+=u.result.blockLength,r-=u.result.blockLength,this.value.push(u.result),this.isIndefiniteForm&&u.result.constructor.NAME===T)break}return this.isIndefiniteForm&&(this.value[this.value.length-1].constructor.NAME===T?this.value.pop():this.warnings.push("No EndOfContent block encoded")),o}},{key:"toBER",value:function(e,t){for(var r=t||new b,n=0;n<this.value.length;n++)this.value[n].toBER(e,r);return t?I:r.final()}},{key:"toJSON",value:function(){var e,t=_objectSpread(_objectSpread({},_get(_getPrototypeOf(r.prototype),"toJSON",this).call(this)),{},{isIndefiniteForm:this.isIndefiniteForm,value:[]}),n=_createForOfIteratorHelper(this.value);try{for(n.s();!(e=n.n()).done;){var i=e.value;t.value.push(i.toJSON())}}catch(e){n.e(e)}finally{n.f()}return t}}]),r}(M);te.NAME="ConstructedValueBlock";var re=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n,te)).idBlock.isConstructed=!0,e}return _createClass(r,[{key:"fromBER",value:function(e,t,r){this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm;var n=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===n?(this.error=this.valueBlock.error,n):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),n)}},{key:"onAsciiEncoding",value:function(){var e,t=[],r=_createForOfIteratorHelper(this.valueBlock.value);try{for(r.s();!(e=r.n()).done;){var n=e.value;t.push(n.toString("ascii").split("\n").map((function(e){return"  ".concat(e)})).join("\n"))}}catch(e){r.e(e)}finally{r.f()}var i=3===this.idBlock.tagClass?"[".concat(this.idBlock.tagNumber,"]"):this.constructor.NAME;return t.length?"".concat(i," :\n").concat(t.join("\n")):"".concat(i," :")}}]),r}(z);ee=re,G.Constructed=ee,re.NAME="CONSTRUCTED";var ne,ie=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,[{key:"fromBER",value:function(e,t,r){return t}},{key:"toBER",value:function(e){return I}}]),r}(M);ie.override="EndOfContentValueBlock";var ae,oe=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n,ie)).idBlock.tagClass=1,e.idBlock.tagNumber=0,e}return _createClass(r)}(z);ne=oe,G.EndOfContent=ne,oe.NAME=T;var ue=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n,M)).idBlock.tagClass=1,e.idBlock.tagNumber=5,e}return _createClass(r,[{key:"fromBER",value:function(e,t,r){return this.lenBlock.length>0&&this.warnings.push("Non-zero length of value block for Null type"),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.blockLength+=r,t+r>e.byteLength?(this.error="End of input reached before message was fully decoded (inconsistent offset and length values)",-1):t+r}},{key:"toBER",value:function(e,t){var r=new ArrayBuffer(2);if(!e){var n=new Uint8Array(r);n[0]=5,n[1]=0}return t&&t.write(r),r}},{key:"onAsciiEncoding",value:function(){return"".concat(this.constructor.NAME)}}]),r}(z);ae=ue,G.Null=ae,ue.NAME="NULL";var se,ce=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=n.value,a=_objectWithoutProperties(n,_excluded5);return _classCallCheck(this,r),e=t.call(this,a),a.valueHex?e.valueHexView=s.toUint8Array(a.valueHex):e.valueHexView=new Uint8Array(1),i&&(e.value=i),e}return _createClass(r,[{key:"value",get:function(){var e,t=_createForOfIteratorHelper(this.valueHexView);try{for(t.s();!(e=t.n()).done;){if(e.value>0)return!0}}catch(e){t.e(e)}finally{t.f()}return!1},set:function(e){this.valueHexView[0]=e?255:0}},{key:"fromBER",value:function(e,t,r){var n=s.toUint8Array(e);return w(this,n,t,r)?(this.valueHexView=n.subarray(t,t+r),r>1&&this.warnings.push("Boolean value encoded in more then 1 octet"),this.isHexOnly=!0,g.call(this),this.blockLength=r,t+r):-1}},{key:"toBER",value:function(){return this.valueHexView.slice()}},{key:"toJSON",value:function(){return _objectSpread(_objectSpread({},_get(_getPrototypeOf(r.prototype),"toJSON",this).call(this)),{},{value:this.value})}}]),r}(V(M));ce.NAME="BooleanValueBlock";var le=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n,ce)).idBlock.tagClass=1,e.idBlock.tagNumber=1,e}return _createClass(r,[{key:"getValue",value:function(){return this.valueBlock.value}},{key:"setValue",value:function(e){this.valueBlock.value=e}},{key:"onAsciiEncoding",value:function(){return"".concat(this.constructor.NAME," : ").concat(this.getValue)}}]),r}(z);se=le,G.Boolean=se,le.NAME="BOOLEAN";var he,fe=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=n.isConstructed,a=void 0!==i&&i,o=_objectWithoutProperties(n,_excluded6);return _classCallCheck(this,r),(e=t.call(this,o)).isConstructed=a,e}return _createClass(r,[{key:"fromBER",value:function(e,t,n){var i=0;if(this.isConstructed){if(this.isHexOnly=!1,-1===(i=te.prototype.fromBER.call(this,e,t,n)))return i;for(var a=0;a<this.value.length;a++){var o=this.value[a].constructor.NAME;if(o===T){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, OCTET STRING may consists of OCTET STRINGs only",-1}if(o!==j)return this.error="OCTET STRING may consists of OCTET STRINGs only",-1}}else this.isHexOnly=!0,i=_get(_getPrototypeOf(r.prototype),"fromBER",this).call(this,e,t,n),this.blockLength=n;return i}},{key:"toBER",value:function(e,t){return this.isConstructed?te.prototype.toBER.call(this,e,t):e?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.slice().buffer}},{key:"toJSON",value:function(){return _objectSpread(_objectSpread({},_get(_getPrototypeOf(r.prototype),"toJSON",this).call(this)),{},{isConstructed:this.isConstructed})}}]),r}(V(te));fe.NAME="OctetStringValueBlock";var pe=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n,i,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=a.idBlock,u=void 0===o?{}:o,s=a.lenBlock,c=void 0===s?{}:s,l=_objectWithoutProperties(a,_excluded7);return _classCallCheck(this,r),null!==(n=l.isConstructed)&&void 0!==n||(l.isConstructed=!!(null===(i=l.value)||void 0===i?void 0:i.length)),(e=t.call(this,_objectSpread({idBlock:_objectSpread({isConstructed:l.isConstructed},u),lenBlock:_objectSpread(_objectSpread({},c),{},{isIndefiniteForm:!!l.isIndefiniteForm})},l),fe)).idBlock.tagClass=1,e.idBlock.tagNumber=4,e}return _createClass(r,[{key:"fromBER",value:function(e,t,n){if(this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,0===n)return 0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),t;if(!this.valueBlock.isConstructed){var i=(e instanceof ArrayBuffer?new Uint8Array(e):e).subarray(t,t+n);try{if(i.byteLength){var a=Y(i,0,i.byteLength);-1!==a.offset&&a.offset===n&&(this.valueBlock.value=[a.result])}}catch(e){}}return _get(_getPrototypeOf(r.prototype),"fromBER",this).call(this,e,t,n)}},{key:"onAsciiEncoding",value:function(){return this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length?re.prototype.onAsciiEncoding.call(this):"".concat(this.constructor.NAME," : ").concat(h.ToHex(this.valueBlock.valueHexView))}},{key:"getValue",value:function(){if(!this.idBlock.isConstructed)return this.valueBlock.valueHexView.slice().buffer;var e,t=[],n=_createForOfIteratorHelper(this.valueBlock.value);try{for(n.s();!(e=n.n()).done;){var i=e.value;i instanceof r&&t.push(i.valueBlock.valueHexView)}}catch(e){n.e(e)}finally{n.f()}return s.concat(t)}}]),r}(z);he=pe,G.OctetString=he,pe.NAME=j;var ve,ye=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=n.unusedBits,a=void 0===i?0:i,o=n.isConstructed,u=void 0!==o&&o,s=_objectWithoutProperties(n,_excluded8);return _classCallCheck(this,r),(e=t.call(this,s)).unusedBits=a,e.isConstructed=u,e.blockLength=e.valueHexView.byteLength,e}return _createClass(r,[{key:"fromBER",value:function(e,t,r){if(!r)return t;var n=-1;if(this.isConstructed){if(-1===(n=te.prototype.fromBER.call(this,e,t,r)))return n;var i,a=_createForOfIteratorHelper(this.value);try{for(a.s();!(i=a.n()).done;){var o=i.value,u=o.constructor.NAME;if(u===T){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, BIT STRING may consists of BIT STRINGs only",-1}if(u!==H)return this.error="BIT STRING may consists of BIT STRINGs only",-1;var c=o.valueBlock;if(this.unusedBits>0&&c.unusedBits>0)return this.error='Using of "unused bits" inside constructive BIT STRING allowed for least one only',-1;this.unusedBits=c.unusedBits}}catch(e){a.e(e)}finally{a.f()}return n}var l=s.toUint8Array(e);if(!w(this,l,t,r))return-1;var h=l.subarray(t,t+r);if(this.unusedBits=h[0],this.unusedBits>7)return this.error="Unused bits for BitString must be in range 0-7",-1;if(!this.unusedBits){var f=h.subarray(1);try{if(f.byteLength){var p=Y(f,0,f.byteLength);-1!==p.offset&&p.offset===r-1&&(this.value=[p.result])}}catch(e){}}return this.valueHexView=h.subarray(1),this.blockLength=h.length,t+r}},{key:"toBER",value:function(e,t){if(this.isConstructed)return te.prototype.toBER.call(this,e,t);if(e)return new ArrayBuffer(this.valueHexView.byteLength+1);if(!this.valueHexView.byteLength)return I;var r=new Uint8Array(this.valueHexView.length+1);return r[0]=this.unusedBits,r.set(this.valueHexView,1),r.buffer}},{key:"toJSON",value:function(){return _objectSpread(_objectSpread({},_get(_getPrototypeOf(r.prototype),"toJSON",this).call(this)),{},{unusedBits:this.unusedBits,isConstructed:this.isConstructed})}}]),r}(V(te));ye.NAME="BitStringValueBlock";var ge,de=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n,i,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=a.idBlock,u=void 0===o?{}:o,s=a.lenBlock,c=void 0===s?{}:s,l=_objectWithoutProperties(a,_excluded9);return _classCallCheck(this,r),null!==(n=l.isConstructed)&&void 0!==n||(l.isConstructed=!!(null===(i=l.value)||void 0===i?void 0:i.length)),(e=t.call(this,_objectSpread({idBlock:_objectSpread({isConstructed:l.isConstructed},u),lenBlock:_objectSpread(_objectSpread({},c),{},{isIndefiniteForm:!!l.isIndefiniteForm})},l),ye)).idBlock.tagClass=1,e.idBlock.tagNumber=3,e}return _createClass(r,[{key:"fromBER",value:function(e,t,n){return this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,_get(_getPrototypeOf(r.prototype),"fromBER",this).call(this,e,t,n)}},{key:"onAsciiEncoding",value:function(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return re.prototype.onAsciiEncoding.call(this);var e,t=[],r=_createForOfIteratorHelper(this.valueBlock.valueHexView);try{for(r.s();!(e=r.n()).done;){var n=e.value;t.push(n.toString(2).padStart(8,"0"))}}catch(e){r.e(e)}finally{r.f()}var i=t.join("");return"".concat(this.constructor.NAME," : ").concat(i.substring(0,i.length-this.valueBlock.unusedBits))}}]),r}(z);function me(e,t){for(var r=new Uint8Array([0]),n=new Uint8Array(e),i=new Uint8Array(t),a=n.slice(0),o=a.length-1,u=i.slice(0),s=u.length-1,c=0,l=0,h=s<o?o:s;h>=0;h--,l++){if(!0==l<u.length)c=a[o-l]+u[s-l]+r[0];else c=a[o-l]+r[0];if(r[0]=c/10,!0==l>=a.length)a=y(new Uint8Array([c%10]),a);else a[o-l]=c%10}return r[0]>0&&(a=y(r,a)),a}function ke(e){if(e>=_.length)for(var t=_.length;t<=e;t++){for(var r=new Uint8Array([0]),n=_[t-1].slice(0),i=n.length-1;i>=0;i--){var a=new Uint8Array([(n[i]<<1)+r[0]]);r[0]=a[0]/10,n[i]=a[0]%10}r[0]>0&&(n=y(r,n)),_.push(n)}return _[e]}function we(e,t){for(var r,n=0,i=new Uint8Array(e),a=new Uint8Array(t),o=i.slice(0),u=o.length-1,s=a.slice(0),c=s.length-1,l=0,h=c;h>=0;h--,l++)if(!0==(r=o[u-l]-s[c-l]-n)<0)n=1,o[u-l]=r+10;else n=0,o[u-l]=r;if(n>0)for(var f=u-c+1;f>=0;f--,l++){if(!((r=o[u-l]-n)<0)){n=0,o[u-l]=r;break}n=1,o[u-l]=r+10}return o.slice()}ve=de,G.BitString=ve,de.NAME=H;var be,_e=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=n.value,a=_objectWithoutProperties(n,_excluded10);return _classCallCheck(this,r),(e=t.call(this,a))._valueDec=0,a.valueHex&&e.setValueHex(),void 0!==i&&(e.valueDec=i),e}return _createClass(r,[{key:"setValueHex",value:function(){this.valueHexView.length>=4?(this.warnings.push("Too big Integer for decoding, hex only"),this.isHexOnly=!0,this._valueDec=0):(this.isHexOnly=!1,this.valueHexView.length>0&&(this._valueDec=g.call(this)))}},{key:"valueDec",get:function(){return this._valueDec},set:function(e){this._valueDec=e,this.isHexOnly=!1,this.valueHexView=new Uint8Array(function(e){for(var t=e<0?-1*e:e,r=128,n=1;n<8;n++){if(t<=r){if(e<0){var i=v(r-t,8,n);return new Uint8Array(i)[0]|=128,i}var a=v(t,8,n),o=new Uint8Array(a);if(128&o[0]){var u=a.slice(0),s=new Uint8Array(u);a=new ArrayBuffer(a.byteLength+1),o=new Uint8Array(a);for(var c=0;c<u.byteLength;c++)o[c+1]=s[c];o[0]=0}return a}r*=Math.pow(2,8)}return new ArrayBuffer(0)}(e))}},{key:"fromDER",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=this.fromBER(e,t,r);if(-1===i)return i;var a=this.valueHexView;return 0===a[0]&&0!=(128&a[1])?this.valueHexView=a.subarray(1):0!==n&&a.length<n&&(n-a.length>1&&(n=a.length+1),this.valueHexView=a.subarray(n-a.length)),i}},{key:"toDER",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.valueHexView;switch(!0){case 0!=(128&t[0]):var r=new Uint8Array(this.valueHexView.length+1);r[0]=0,r.set(t,1),this.valueHexView=r;break;case 0===t[0]&&0==(128&t[1]):this.valueHexView=this.valueHexView.subarray(1)}return this.toBER(e)}},{key:"fromBER",value:function(e,t,n){var i=_get(_getPrototypeOf(r.prototype),"fromBER",this).call(this,e,t,n);return-1===i||this.setValueHex(),i}},{key:"toBER",value:function(e){return e?new ArrayBuffer(this.valueHexView.length):this.valueHexView.slice().buffer}},{key:"toJSON",value:function(){return _objectSpread(_objectSpread({},_get(_getPrototypeOf(r.prototype),"toJSON",this).call(this)),{},{valueDec:this.valueDec})}},{key:"toString",value:function(){for(var e,t=8*this.valueHexView.length-1,r=new Uint8Array(8*this.valueHexView.length/3),n=0,i=this.valueHexView,a="",o=!1,u=i.byteLength-1;u>=0;u--){e=i[u];for(var s=0;s<8;s++){if(1==(1&e))if(n===t)r=we(ke(n),r),a="-";else r=me(r,ke(n));n++,e>>=1}}for(var c=0;c<r.length;c++)r[c]&&(o=!0),o&&(a+=C.charAt(r[c]));return!1===o&&(a+=C.charAt(0)),a}}]),r}(V(M));ge=_e,_e.NAME="IntegerValueBlock",Object.defineProperty(ge.prototype,"valueHex",{set:function(e){this.valueHexView=new Uint8Array(e),this.setValueHex()},get:function(){return this.valueHexView.slice().buffer}});var Ce,Se=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n,_e)).idBlock.tagClass=1,e.idBlock.tagNumber=2,e}return _createClass(r,[{key:"toBigInt",value:function(){return m(),BigInt(this.valueBlock.toString())}},{key:"convertToDER",value:function(){var e=new r({valueHex:this.valueBlock.valueHexView});return e.valueBlock.toDER(),e}},{key:"convertFromDER",value:function(){return new r({valueHex:0===this.valueBlock.valueHexView[0]?this.valueBlock.valueHexView.subarray(1):this.valueBlock.valueHexView})}},{key:"onAsciiEncoding",value:function(){return"".concat(this.constructor.NAME," : ").concat(this.valueBlock.toString())}}],[{key:"fromBigInt",value:function(e){m();var t=BigInt(e),n=new b,i=t.toString(16).replace(/^-/,""),a=new Uint8Array(h.FromHex(i));if(t<0){var o=new Uint8Array(a.length+(128&a[0]?1:0));o[0]|=128;var u=BigInt("0x".concat(h.ToHex(o)))+t,c=s.toUint8Array(h.FromHex(u.toString(16)));c[0]|=128,n.write(c)}else 128&a[0]&&n.write(new Uint8Array([0])),n.write(a);return new r({valueHex:n.final()})}}]),r}(z);be=Se,G.Integer=be,Se.NAME="INTEGER";var Ae=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=10,e}return _createClass(r)}(Se);Ce=Ae,G.Enumerated=Ce,Ae.NAME="ENUMERATED";var xe=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=n.valueDec,a=void 0===i?-1:i,o=n.isFirstSid,u=void 0!==o&&o,s=_objectWithoutProperties(n,_excluded11);return _classCallCheck(this,r),(e=t.call(this,s)).valueDec=a,e.isFirstSid=u,e}return _createClass(r,[{key:"fromBER",value:function(e,t,r){if(!r)return t;var n=s.toUint8Array(e);if(!w(this,n,t,r))return-1;var i=n.subarray(t,t+r);this.valueHexView=new Uint8Array(r);for(var a=0;a<r&&(this.valueHexView[a]=127&i[a],this.blockLength++,0!=(128&i[a]));a++);for(var o=new Uint8Array(this.blockLength),u=0;u<this.blockLength;u++)o[u]=this.valueHexView[u];return this.valueHexView=o,0!=(128&i[this.blockLength-1])?(this.error="End of input reached before message was fully decoded",-1):(0===this.valueHexView[0]&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=p(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}},{key:"valueBigInt",set:function(e){m();for(var t=BigInt(e).toString(2);t.length%7;)t="0"+t;for(var r=new Uint8Array(t.length/7),n=0;n<r.length;n++)r[n]=parseInt(t.slice(7*n,7*n+7),2)+(n+1<r.length?128:0);this.fromBER(r.buffer,0,r.length)}},{key:"toBER",value:function(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);for(var t=this.valueHexView,r=new Uint8Array(this.blockLength),n=0;n<this.blockLength-1;n++)r[n]=128|t[n];return r[this.blockLength-1]=t[this.blockLength-1],r.buffer}var i=v(this.valueDec,7);if(0===i.byteLength)return this.error="Error during encoding SID value",I;var a=new Uint8Array(i.byteLength);if(!e){for(var o=new Uint8Array(i),u=i.byteLength-1,s=0;s<u;s++)a[s]=128|o[s];a[u]=o[u]}return a}},{key:"toString",value:function(){var e="";if(this.isHexOnly)e=h.ToHex(this.valueHexView);else if(this.isFirstSid){var t=this.valueDec;this.valueDec<=39?e="0.":this.valueDec<=79?(e="1.",t-=40):(e="2.",t-=80),e+=t.toString()}else e=this.valueDec.toString();return e}},{key:"toJSON",value:function(){return _objectSpread(_objectSpread({},_get(_getPrototypeOf(r.prototype),"toJSON",this).call(this)),{},{valueDec:this.valueDec,isFirstSid:this.isFirstSid})}}]),r}(V(M));xe.NAME="sidBlock";var Be,Ee=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=n.value,a=void 0===i?U:i,o=_objectWithoutProperties(n,_excluded12);return _classCallCheck(this,r),(e=t.call(this,o)).value=[],a&&e.fromString(a),e}return _createClass(r,[{key:"fromBER",value:function(e,t,r){for(var n=t;r>0;){var i=new xe;if(-1===(n=i.fromBER(e,n,r)))return this.blockLength=0,this.error=i.error,n;0===this.value.length&&(i.isFirstSid=!0),this.blockLength+=i.blockLength,r-=i.blockLength,this.value.push(i)}return n}},{key:"toBER",value:function(e){for(var t=[],r=0;r<this.value.length;r++){var n=this.value[r].toBER(e);if(0===n.byteLength)return this.error=this.value[r].error,I;t.push(n)}return k(t)}},{key:"fromString",value:function(e){this.value=[];var t=0,r=0,n="",i=!1;do{if(n=-1===(r=e.indexOf(".",t))?e.substring(t):e.substring(t,r),t=r+1,i){var a=this.value[0],o=0;switch(a.valueDec){case 0:break;case 1:o=40;break;case 2:o=80;break;default:return void(this.value=[])}var u=parseInt(n,10);if(isNaN(u))return;a.valueDec=u+o,i=!1}else{var s=new xe;if(n>Number.MAX_SAFE_INTEGER){m();var c=BigInt(n);s.valueBigInt=c}else if(s.valueDec=parseInt(n,10),isNaN(s.valueDec))return;this.value.length||(s.isFirstSid=!0,i=!0),this.value.push(s)}}while(-1!==r)}},{key:"toString",value:function(){for(var e="",t=!1,r=0;r<this.value.length;r++){t=this.value[r].isHexOnly;var n=this.value[r].toString();0!==r&&(e="".concat(e,".")),t?(n="{".concat(n,"}"),this.value[r].isFirstSid?e="2.{".concat(n," - 80}"):e+=n):e+=n}return e}},{key:"toJSON",value:function(){for(var e=_objectSpread(_objectSpread({},_get(_getPrototypeOf(r.prototype),"toJSON",this).call(this)),{},{value:this.toString(),sidArray:[]}),t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}]),r}(M);Ee.NAME="ObjectIdentifierValueBlock";var Re=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n,Ee)).idBlock.tagClass=1,e.idBlock.tagNumber=6,e}return _createClass(r,[{key:"getValue",value:function(){return this.valueBlock.toString()}},{key:"setValue",value:function(e){this.valueBlock.fromString(e)}},{key:"onAsciiEncoding",value:function(){return"".concat(this.constructor.NAME," : ").concat(this.valueBlock.toString()||"empty")}},{key:"toJSON",value:function(){return _objectSpread(_objectSpread({},_get(_getPrototypeOf(r.prototype),"toJSON",this).call(this)),{},{value:this.getValue()})}}]),r}(z);Be=Re,G.ObjectIdentifier=Be,Re.NAME="OBJECT IDENTIFIER";var Ke=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=n.valueDec,a=void 0===i?0:i,o=_objectWithoutProperties(n,_excluded13);return _classCallCheck(this,r),(e=t.call(this,o)).valueDec=a,e}return _createClass(r,[{key:"fromBER",value:function(e,t,r){if(0===r)return t;var n=s.toUint8Array(e);if(!w(this,n,t,r))return-1;var i=n.subarray(t,t+r);this.valueHexView=new Uint8Array(r);for(var a=0;a<r&&(this.valueHexView[a]=127&i[a],this.blockLength++,0!=(128&i[a]));a++);for(var o=new Uint8Array(this.blockLength),u=0;u<this.blockLength;u++)o[u]=this.valueHexView[u];return this.valueHexView=o,0!=(128&i[this.blockLength-1])?(this.error="End of input reached before message was fully decoded",-1):(0===this.valueHexView[0]&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=p(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}},{key:"toBER",value:function(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);for(var t=this.valueHexView,r=new Uint8Array(this.blockLength),n=0;n<this.blockLength-1;n++)r[n]=128|t[n];return r[this.blockLength-1]=t[this.blockLength-1],r.buffer}var i=v(this.valueDec,7);if(0===i.byteLength)return this.error="Error during encoding SID value",I;var a=new Uint8Array(i.byteLength);if(!e){for(var o=new Uint8Array(i),u=i.byteLength-1,s=0;s<u;s++)a[s]=128|o[s];a[u]=o[u]}return a.buffer}},{key:"toString",value:function(){return this.isHexOnly?h.ToHex(this.valueHexView):this.valueDec.toString()}},{key:"toJSON",value:function(){return _objectSpread(_objectSpread({},_get(_getPrototypeOf(r.prototype),"toJSON",this).call(this)),{},{valueDec:this.valueDec})}}]),r}(V(D));Ke.NAME="relativeSidBlock";var Oe,Ne=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=n.value,a=void 0===i?U:i,o=_objectWithoutProperties(n,_excluded14);return _classCallCheck(this,r),(e=t.call(this,o)).value=[],a&&e.fromString(a),e}return _createClass(r,[{key:"fromBER",value:function(e,t,r){for(var n=t;r>0;){var i=new Ke;if(-1===(n=i.fromBER(e,n,r)))return this.blockLength=0,this.error=i.error,n;this.blockLength+=i.blockLength,r-=i.blockLength,this.value.push(i)}return n}},{key:"toBER",value:function(e,t){for(var r=[],n=0;n<this.value.length;n++){var i=this.value[n].toBER(e);if(0===i.byteLength)return this.error=this.value[n].error,I;r.push(i)}return k(r)}},{key:"fromString",value:function(e){this.value=[];var t=0,r=0,n="";do{n=-1===(r=e.indexOf(".",t))?e.substring(t):e.substring(t,r),t=r+1;var i=new Ke;if(i.valueDec=parseInt(n,10),isNaN(i.valueDec))return!0;this.value.push(i)}while(-1!==r);return!0}},{key:"toString",value:function(){for(var e="",t=!1,r=0;r<this.value.length;r++){t=this.value[r].isHexOnly;var n=this.value[r].toString();0!==r&&(e="".concat(e,".")),e+=t?n="{".concat(n,"}"):n}return e}},{key:"toJSON",value:function(){for(var e=_objectSpread(_objectSpread({},_get(_getPrototypeOf(r.prototype),"toJSON",this).call(this)),{},{value:this.toString(),sidArray:[]}),t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}]),r}(M);Ne.NAME="RelativeObjectIdentifierValueBlock";var Pe,Ue=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n,Ne)).idBlock.tagClass=1,e.idBlock.tagNumber=13,e}return _createClass(r,[{key:"getValue",value:function(){return this.valueBlock.toString()}},{key:"setValue",value:function(e){this.valueBlock.fromString(e)}},{key:"onAsciiEncoding",value:function(){return"".concat(this.constructor.NAME," : ").concat(this.valueBlock.toString()||"empty")}},{key:"toJSON",value:function(){return _objectSpread(_objectSpread({},_get(_getPrototypeOf(r.prototype),"toJSON",this).call(this)),{},{value:this.getValue()})}}]),r}(z);Oe=Ue,G.RelativeObjectIdentifier=Oe,Ue.NAME="RelativeObjectIdentifier";var Ie,Le=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=16,e}return _createClass(r)}(re);Pe=Le,G.Sequence=Pe,Le.NAME="SEQUENCE";var Te=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=17,e}return _createClass(r)}(re);Ie=Te,G.Set=Ie,Te.NAME="SET";var je=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=Object.assign({},(_objectDestructuringEmpty(n),n));return _classCallCheck(this,r),(e=t.call(this,i)).isHexOnly=!0,e.value=U,e}return _createClass(r,[{key:"toJSON",value:function(){return _objectSpread(_objectSpread({},_get(_getPrototypeOf(r.prototype),"toJSON",this).call(this)),{},{value:this.value})}}]),r}(V(M));je.NAME="StringValueBlock";var He=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r)}(je);He.NAME="SimpleStringValueBlock";var Ve=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=Object.assign({},(_objectDestructuringEmpty(e),e));return _classCallCheck(this,r),t.call(this,n,He)}return _createClass(r,[{key:"fromBuffer",value:function(e){this.valueBlock.value=String.fromCharCode.apply(null,s.toUint8Array(e))}},{key:"fromString",value:function(e){for(var t=e.length,r=this.valueBlock.valueHexView=new Uint8Array(t),n=0;n<t;n++)r[n]=e.charCodeAt(n);this.valueBlock.value=e}}]),r}(W);Ve.NAME="SIMPLE STRING";var De,Me=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,[{key:"fromBuffer",value:function(e){this.valueBlock.valueHexView=s.toUint8Array(e);try{this.valueBlock.value=h.ToUtf8String(e)}catch(t){this.warnings.push('Error during "decodeURIComponent": '.concat(t,", using raw string")),this.valueBlock.value=h.ToBinary(e)}}},{key:"fromString",value:function(e){this.valueBlock.valueHexView=new Uint8Array(h.FromUtf8String(e)),this.valueBlock.value=e}}]),r}(Ve);Me.NAME="Utf8StringValueBlock";var Fe=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=12,e}return _createClass(r)}(Me);De=Fe,G.Utf8String=De,Fe.NAME="UTF8String";var Je,Ge=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,[{key:"fromBuffer",value:function(e){this.valueBlock.value=h.ToUtf16String(e),this.valueBlock.valueHexView=s.toUint8Array(e)}},{key:"fromString",value:function(e){this.valueBlock.value=e,this.valueBlock.valueHexView=new Uint8Array(h.FromUtf16String(e))}}]),r}(Ve);Ge.NAME="BmpStringValueBlock";var ze=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=Object.assign({},(_objectDestructuringEmpty(n),n));return _classCallCheck(this,r),(e=t.call(this,i)).idBlock.tagClass=1,e.idBlock.tagNumber=30,e}return _createClass(r)}(Ge);Je=ze,G.BmpString=Je,ze.NAME="BMPString";var qe,We=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,[{key:"fromBuffer",value:function(e){for(var t=ArrayBuffer.isView(e)?e.slice().buffer:e.slice(0),r=new Uint8Array(t),n=0;n<r.length;n+=4)r[n]=r[n+3],r[n+1]=r[n+2],r[n+2]=0,r[n+3]=0;this.valueBlock.value=String.fromCharCode.apply(null,new Uint32Array(t))}},{key:"fromString",value:function(e){for(var t=e.length,r=this.valueBlock.valueHexView=new Uint8Array(4*t),n=0;n<t;n++){var i=v(e.charCodeAt(n),8),a=new Uint8Array(i);if(!(a.length>4))for(var o=4-a.length,u=a.length-1;u>=0;u--)r[4*n+u+o]=a[u]}this.valueBlock.value=e}}]),r}(Ve);We.NAME="UniversalStringValueBlock";var Xe,Ze=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=Object.assign({},(_objectDestructuringEmpty(n),n));return _classCallCheck(this,r),(e=t.call(this,i)).idBlock.tagClass=1,e.idBlock.tagNumber=28,e}return _createClass(r)}(We);qe=Ze,G.UniversalString=qe,Ze.NAME="UniversalString";var $e,Ye=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=18,e}return _createClass(r)}(Ve);Xe=Ye,G.NumericString=Xe,Ye.NAME="NumericString";var Qe,et=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=19,e}return _createClass(r)}(Ve);$e=et,G.PrintableString=$e,et.NAME="PrintableString";var tt,rt=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=20,e}return _createClass(r)}(Ve);Qe=rt,G.TeletexString=Qe,rt.NAME="TeletexString";var nt,it=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=21,e}return _createClass(r)}(Ve);tt=it,G.VideotexString=tt,it.NAME="VideotexString";var at,ot=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=22,e}return _createClass(r)}(Ve);nt=ot,G.IA5String=nt,ot.NAME="IA5String";var ut,st=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=25,e}return _createClass(r)}(Ve);at=st,G.GraphicString=at,st.NAME="GraphicString";var ct,lt=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=26,e}return _createClass(r)}(Ve);ut=lt,G.VisibleString=ut,lt.NAME="VisibleString";var ht,ft=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=27,e}return _createClass(r)}(Ve);ct=ft,G.GeneralString=ct,ft.NAME="GeneralString";var pt,vt=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=29,e}return _createClass(r)}(Ve);ht=vt,G.CharacterString=ht,vt.NAME="CharacterString";var yt,gt=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=n.value,a=n.valueDate,o=_objectWithoutProperties(n,_excluded15);if(_classCallCheck(this,r),(e=t.call(this,o)).year=0,e.month=0,e.day=0,e.hour=0,e.minute=0,e.second=0,i){e.fromString(i),e.valueBlock.valueHexView=new Uint8Array(i.length);for(var u=0;u<i.length;u++)e.valueBlock.valueHexView[u]=i.charCodeAt(u)}return a&&(e.fromDate(a),e.valueBlock.valueHexView=new Uint8Array(e.toBuffer())),e.idBlock.tagClass=1,e.idBlock.tagNumber=23,e}return _createClass(r,[{key:"fromBuffer",value:function(e){this.fromString(String.fromCharCode.apply(null,s.toUint8Array(e)))}},{key:"toBuffer",value:function(){for(var e=this.toString(),t=new ArrayBuffer(e.length),r=new Uint8Array(t),n=0;n<e.length;n++)r[n]=e.charCodeAt(n);return t}},{key:"fromDate",value:function(e){this.year=e.getUTCFullYear(),this.month=e.getUTCMonth()+1,this.day=e.getUTCDate(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds()}},{key:"toDate",value:function(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second))}},{key:"fromString",value:function(e){var t=/(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})Z/gi.exec(e);if(null!==t){var r=parseInt(t[1],10);this.year=r>=50?1900+r:2e3+r,this.month=parseInt(t[2],10),this.day=parseInt(t[3],10),this.hour=parseInt(t[4],10),this.minute=parseInt(t[5],10),this.second=parseInt(t[6],10)}else this.error="Wrong input string for conversion"}},{key:"toString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"iso";if("iso"===e){var t=new Array(7);return t[0]=d(this.year<2e3?this.year-1900:this.year-2e3,2),t[1]=d(this.month,2),t[2]=d(this.day,2),t[3]=d(this.hour,2),t[4]=d(this.minute,2),t[5]=d(this.second,2),t[6]="Z",t.join("")}return _get(_getPrototypeOf(r.prototype),"toString",this).call(this,e)}},{key:"onAsciiEncoding",value:function(){return"".concat(this.constructor.NAME," : ").concat(this.toDate().toISOString())}},{key:"toJSON",value:function(){return _objectSpread(_objectSpread({},_get(_getPrototypeOf(r.prototype),"toJSON",this).call(this)),{},{year:this.year,month:this.month,day:this.day,hour:this.hour,minute:this.minute,second:this.second})}}]),r}(lt);pt=gt,G.UTCTime=pt,gt.NAME="UTCTime";var dt,mt=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),null!==(n=(e=t.call(this,i)).millisecond)&&void 0!==n||(e.millisecond=0),e.idBlock.tagClass=1,e.idBlock.tagNumber=24,e}return _createClass(r,[{key:"fromDate",value:function(e){_get(_getPrototypeOf(r.prototype),"fromDate",this).call(this,e),this.millisecond=e.getUTCMilliseconds()}},{key:"toDate",value:function(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond))}},{key:"fromString",value:function(e){var t,r=!1,n="",i="",a=0,o=0,u=0;if("Z"===e[e.length-1])n=e.substring(0,e.length-1),r=!0;else{var s=new Number(e[e.length-1]);if(isNaN(s.valueOf()))throw new Error("Wrong input string for conversion");n=e}if(r){if(-1!==n.indexOf("+"))throw new Error("Wrong input string for conversion");if(-1!==n.indexOf("-"))throw new Error("Wrong input string for conversion")}else{var c=1,l=n.indexOf("+"),h="";if(-1===l&&(l=n.indexOf("-"),c=-1),-1!==l){if(h=n.substring(l+1),n=n.substring(0,l),2!==h.length&&4!==h.length)throw new Error("Wrong input string for conversion");var f=parseInt(h.substring(0,2),10);if(isNaN(f.valueOf()))throw new Error("Wrong input string for conversion");if(o=c*f,4===h.length){if(f=parseInt(h.substring(2,4),10),isNaN(f.valueOf()))throw new Error("Wrong input string for conversion");u=c*f}}}var p=n.indexOf(".");if(-1===p&&(p=n.indexOf(",")),-1!==p){var v=new Number("0".concat(n.substring(p)));if(isNaN(v.valueOf()))throw new Error("Wrong input string for conversion");a=v.valueOf(),i=n.substring(0,p)}else i=n;switch(!0){case 8===i.length:if(t=/(\d{4})(\d{2})(\d{2})/gi,-1!==p)throw new Error("Wrong input string for conversion");break;case 10===i.length:if(t=/(\d{4})(\d{2})(\d{2})(\d{2})/gi,-1!==p){var y=60*a;this.minute=Math.floor(y),y=60*(y-this.minute),this.second=Math.floor(y),y=1e3*(y-this.second),this.millisecond=Math.floor(y)}break;case 12===i.length:if(t=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})/gi,-1!==p){var g=60*a;this.second=Math.floor(g),g=1e3*(g-this.second),this.millisecond=Math.floor(g)}break;case 14===i.length:if(t=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/gi,-1!==p){var d=1e3*a;this.millisecond=Math.floor(d)}break;default:throw new Error("Wrong input string for conversion")}var m=t.exec(i);if(null===m)throw new Error("Wrong input string for conversion");for(var k=1;k<m.length;k++)switch(k){case 1:this.year=parseInt(m[k],10);break;case 2:this.month=parseInt(m[k],10);break;case 3:this.day=parseInt(m[k],10);break;case 4:this.hour=parseInt(m[k],10)+o;break;case 5:this.minute=parseInt(m[k],10)+u;break;case 6:this.second=parseInt(m[k],10);break;default:throw new Error("Wrong input string for conversion")}if(!1===r){var w=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second,this.millisecond);this.year=w.getUTCFullYear(),this.month=w.getUTCMonth(),this.day=w.getUTCDay(),this.hour=w.getUTCHours(),this.minute=w.getUTCMinutes(),this.second=w.getUTCSeconds(),this.millisecond=w.getUTCMilliseconds()}}},{key:"toString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"iso";if("iso"===e){var t=[];return t.push(d(this.year,4)),t.push(d(this.month,2)),t.push(d(this.day,2)),t.push(d(this.hour,2)),t.push(d(this.minute,2)),t.push(d(this.second,2)),0!==this.millisecond&&(t.push("."),t.push(d(this.millisecond,3))),t.push("Z"),t.join("")}return _get(_getPrototypeOf(r.prototype),"toString",this).call(this,e)}},{key:"toJSON",value:function(){return _objectSpread(_objectSpread({},_get(_getPrototypeOf(r.prototype),"toJSON",this).call(this)),{},{millisecond:this.millisecond})}}]),r}(gt);yt=mt,G.GeneralizedTime=yt,mt.NAME="GeneralizedTime";var kt,wt=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=31,e}return _createClass(r)}(Fe);dt=wt,G.DATE=dt,wt.NAME="DATE";var bt,_t=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=32,e}return _createClass(r)}(Fe);kt=_t,G.TimeOfDay=kt,_t.NAME="TimeOfDay";var Ct,St=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=33,e}return _createClass(r)}(Fe);bt=St,G.DateTime=bt,St.NAME="DateTime";var At,xt=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=34,e}return _createClass(r)}(Fe);Ct=xt,G.Duration=Ct,xt.NAME="Duration";var Bt=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=14,e}return _createClass(r)}(Fe);At=Bt,G.TIME=At,Bt.NAME="TIME";var Et=_createClass((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.name,n=void 0===r?U:r,i=t.optional,a=void 0!==i&&i;_classCallCheck(this,e),this.name=n,this.optional=a})),Rt=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=n.value,a=void 0===i?[]:i,o=_objectWithoutProperties(n,_excluded16);return _classCallCheck(this,r),(e=t.call(this,o)).value=a,e}return _createClass(r)}(Et),Kt=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=n.value,a=void 0===i?new Et:i,o=n.local,u=void 0!==o&&o,s=_objectWithoutProperties(n,_excluded17);return _classCallCheck(this,r),(e=t.call(this,s)).value=a,e.local=u,e}return _createClass(r)}(Et),Ot=function(){function e(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).data,r=void 0===t?L:t;_classCallCheck(this,e),this.dataView=s.toUint8Array(r)}return _createClass(e,[{key:"data",get:function(){return this.dataView.slice().buffer},set:function(e){this.dataView=s.toUint8Array(e)}},{key:"fromBER",value:function(e,t,r){var n=t+r;return this.dataView=s.toUint8Array(e).subarray(t,n),n}},{key:"toBER",value:function(e){return this.dataView.slice().buffer}}]),e}();function Nt(e,t,r){if(r instanceof Rt){for(var n=0;n<r.value.length;n++){if(Nt(e,t,r.value[n]).verified)return{verified:!0,result:e}}var i={verified:!1,result:{error:"Wrong values for Choice type"}};return r.hasOwnProperty(S)&&(i.name=r.name),i}if(r instanceof Et)return r.hasOwnProperty(S)&&(e[r.name]=t),{verified:!0,result:e};if(e instanceof Object==!1)return{verified:!1,result:{error:"Wrong root object"}};if(t instanceof Object==!1)return{verified:!1,result:{error:"Wrong ASN.1 data"}};if(r instanceof Object==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(B in r==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(O in r.idBlock==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(N in r.idBlock==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};var a=r.idBlock.toBER(!1);if(0===a.byteLength)return{verified:!1,result:{error:"Error encoding idBlock for ASN.1 schema"}};if(-1===r.idBlock.fromBER(a,0,a.byteLength))return{verified:!1,result:{error:"Error decoding idBlock for ASN.1 schema"}};if(!1===r.idBlock.hasOwnProperty(E))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.tagClass!==t.idBlock.tagClass)return{verified:!1,result:e};if(!1===r.idBlock.hasOwnProperty(R))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.tagNumber!==t.idBlock.tagNumber)return{verified:!1,result:e};if(!1===r.idBlock.hasOwnProperty(K))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.isConstructed!==t.idBlock.isConstructed)return{verified:!1,result:e};if(!(x in r.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.isHexOnly!==t.idBlock.isHexOnly)return{verified:!1,result:e};if(r.idBlock.isHexOnly){if(A in r.idBlock==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};var o=r.idBlock.valueHexView,u=t.idBlock.valueHexView;if(o.length!==u.length)return{verified:!1,result:e};for(var s=0;s<o.length;s++)if(o[s]!==u[1])return{verified:!1,result:e}}if(r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,U),r.name&&(e[r.name]=t)),r instanceof G.Constructed){var c=0,l={verified:!1,result:{error:"Unknown error"}},h=r.valueBlock.value.length;if(h>0&&r.valueBlock.value[0]instanceof Kt&&(h=t.valueBlock.value.length),0===h)return{verified:!0,result:e};if(0===t.valueBlock.value.length&&0!==r.valueBlock.value.length){for(var f=!0,p=0;p<r.valueBlock.value.length;p++)f=f&&(r.valueBlock.value[p].optional||!1);return f?{verified:!0,result:e}:(r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,U),r.name&&delete e[r.name]),e.error="Inconsistent object length",{verified:!1,result:e})}for(var v=0;v<h;v++)if(v-c>=t.valueBlock.value.length){if(!1===r.valueBlock.value[v].optional){var y={verified:!1,result:e};return e.error="Inconsistent length between ASN.1 data and schema",r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,U),r.name&&(delete e[r.name],y.name=r.name)),y}}else if(r.valueBlock.value[0]instanceof Kt){if(!1===(l=Nt(e,t.valueBlock.value[v],r.valueBlock.value[0].value)).verified){if(!r.valueBlock.value[0].optional)return r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,U),r.name&&delete e[r.name]),l;c++}if(S in r.valueBlock.value[0]&&r.valueBlock.value[0].name.length>0){var g={};void 0===(g=P in r.valueBlock.value[0]&&r.valueBlock.value[0].local?t:e)[r.valueBlock.value[0].name]&&(g[r.valueBlock.value[0].name]=[]),g[r.valueBlock.value[0].name].push(t.valueBlock.value[v])}}else if(!1===(l=Nt(e,t.valueBlock.value[v-c],r.valueBlock.value[v])).verified){if(!r.valueBlock.value[v].optional)return r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,U),r.name&&delete e[r.name]),l;c++}if(!1===l.verified){var d={verified:!1,result:e};return r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,U),r.name&&(delete e[r.name],d.name=r.name)),d}return{verified:!0,result:e}}if(r.primitiveSchema&&A in t.valueBlock){var m=Y(t.valueBlock.valueHexView);if(-1===m.offset){var k={verified:!1,result:m.result};return r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,U),r.name&&(delete e[r.name],k.name=r.name)),k}return Nt(e,m.result,r.primitiveSchema)}return{verified:!0,result:e}}var Pt,Ut,It=Object.freeze({__proto__:null,Any:Et,BaseBlock:z,BaseStringBlock:W,BitString:de,BmpString:ze,Boolean:le,CharacterString:vt,Choice:Rt,Constructed:re,DATE:wt,DateTime:St,Duration:xt,EndOfContent:oe,Enumerated:Ae,GeneralString:ft,GeneralizedTime:mt,GraphicString:st,HexBlock:V,IA5String:ot,Integer:Se,Null:ue,NumericString:Ye,ObjectIdentifier:Re,OctetString:pe,Primitive:$,PrintableString:et,RawData:Ot,RelativeObjectIdentifier:Ue,Repeated:Kt,Sequence:Le,Set:Te,TIME:Bt,TeletexString:rt,TimeOfDay:_t,UTCTime:gt,UniversalString:Ze,Utf8String:Fe,ValueBlock:M,VideotexString:it,ViewWriter:b,VisibleString:lt,compareSchema:Nt,fromBER:Q,verifySchema:function(e,t){if(t instanceof Object==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema type"}};var r=Y(s.toUint8Array(e));return-1===r.offset?{verified:!1,result:r.result}:Nt(r.result,r.result,t)}});!function(e){e[e.Sequence=0]="Sequence",e[e.Set=1]="Set",e[e.Choice=2]="Choice"}(Pt||(Pt={})),function(e){e[e.Any=1]="Any",e[e.Boolean=2]="Boolean",e[e.OctetString=3]="OctetString",e[e.BitString=4]="BitString",e[e.Integer=5]="Integer",e[e.Enumerated=6]="Enumerated",e[e.ObjectIdentifier=7]="ObjectIdentifier",e[e.Utf8String=8]="Utf8String",e[e.BmpString=9]="BmpString",e[e.UniversalString=10]="UniversalString",e[e.NumericString=11]="NumericString",e[e.PrintableString=12]="PrintableString",e[e.TeletexString=13]="TeletexString",e[e.VideotexString=14]="VideotexString",e[e.IA5String=15]="IA5String",e[e.GraphicString=16]="GraphicString",e[e.VisibleString=17]="VisibleString",e[e.GeneralString=18]="GeneralString",e[e.CharacterString=19]="CharacterString",e[e.UTCTime=20]="UTCTime",e[e.GeneralizedTime=21]="GeneralizedTime",e[e.DATE=22]="DATE",e[e.TimeOfDay=23]="TimeOfDay",e[e.DateTime=24]="DateTime",e[e.Duration=25]="Duration",e[e.TIME=26]="TIME",e[e.Null=27]="Null"}(Ut||(Ut={}));var Lt=function(){function e(t){_classCallCheck(this,e),"number"==typeof t?this.buffer=new ArrayBuffer(t):s.isBufferSource(t)?this.buffer=s.toArrayBuffer(t):Array.isArray(t)?this.buffer=new Uint8Array(t):this.buffer=new ArrayBuffer(0)}return _createClass(e,[{key:"byteLength",get:function(){return this.buffer.byteLength}},{key:"byteOffset",get:function(){return 0}},{key:"fromASN",value:function(e){if(!(e instanceof pe))throw new TypeError("Argument 'asn' is not instance of ASN.1 OctetString");return this.buffer=e.valueBlock.valueHex,this}},{key:"toASN",value:function(){return new pe({valueHex:this.buffer})}},{key:"toSchema",value:function(e){return new pe({name:e})}}]),e}(),Tt={fromASN:function(e){return e instanceof ue?null:e.valueBeforeDecodeView},toASN:function(e){if(null===e)return new ue;var t=Q(e);if(t.result.error)throw new Error(t.result.error);return t.result}},jt={fromASN:function(e){return e.valueBlock.valueHexView.byteLength>=4?e.valueBlock.toString():e.valueBlock.valueDec},toASN:function(e){return new Se({value:+e})}},Ht={fromASN:function(e){return e.valueBlock.valueDec},toASN:function(e){return new Ae({value:e})}},Vt={fromASN:function(e){return e.valueBlock.valueHexView},toASN:function(e){return new de({valueHex:e})}},Dt={fromASN:function(e){return e.valueBlock.toString()},toASN:function(e){return new Re({value:e})}},Mt={fromASN:function(e){return e.valueBlock.value},toASN:function(e){return new le({value:e})}},Ft={fromASN:function(e){return e.valueBlock.valueHexView},toASN:function(e){return new pe({valueHex:e})}};function Jt(e){return{fromASN:function(e){return e.valueBlock.value},toASN:function(t){return new e({value:t})}}}var Gt=Jt(Fe),zt=Jt(ze),qt=Jt(Ze),Wt=Jt(Ye),Xt=Jt(et),Zt=Jt(rt),$t=Jt(it),Yt=Jt(ot),Qt=Jt(st),er=Jt(lt),tr=Jt(ft),rr=Jt(vt),nr={fromASN:function(e){return e.toDate()},toASN:function(e){return new gt({valueDate:e})}},ir={fromASN:function(e){return e.toDate()},toASN:function(e){return new mt({valueDate:e})}},ar={fromASN:function(){return null},toASN:function(){return new ue}};function or(e){switch(e){case Ut.Any:return Tt;case Ut.BitString:return Vt;case Ut.BmpString:return zt;case Ut.Boolean:return Mt;case Ut.CharacterString:return rr;case Ut.Enumerated:return Ht;case Ut.GeneralString:return tr;case Ut.GeneralizedTime:return ir;case Ut.GraphicString:return Qt;case Ut.IA5String:return Yt;case Ut.Integer:return jt;case Ut.Null:return ar;case Ut.NumericString:return Wt;case Ut.ObjectIdentifier:return Dt;case Ut.OctetString:return Ft;case Ut.PrintableString:return Xt;case Ut.TeletexString:return Zt;case Ut.UTCTime:return nr;case Ut.UniversalString:return qt;case Ut.Utf8String:return Gt;case Ut.VideotexString:return $t;case Ut.VisibleString:return er;default:return null}}function ur(e){return"function"==typeof e&&e.prototype?!(!e.prototype.toASN||!e.prototype.fromASN)||ur(e.prototype):!!(e&&"object"===_typeof(e)&&"toASN"in e&&"fromASN"in e)}function sr(e){var t;if(e){var r=Object.getPrototypeOf(e);return(null===(t=null==r?void 0:r.prototype)||void 0===t?void 0:t.constructor)===Array||sr(r)}return!1}function cr(e,t){if(!e||!t)return!1;if(e.byteLength!==t.byteLength)return!1;for(var r=new Uint8Array(e),n=new Uint8Array(t),i=0;i<e.byteLength;i++)if(r[i]!==n[i])return!1;return!0}var lr=function(){function e(){_classCallCheck(this,e),this.items=new WeakMap}return _createClass(e,[{key:"has",value:function(e){return this.items.has(e)}},{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this.items.get(e);if(!r)throw new Error("Cannot get schema for '".concat(e.prototype.constructor.name,"' target"));if(t&&!r.schema)throw new Error("Schema '".concat(e.prototype.constructor.name,"' doesn't contain ASN.1 schema. Call 'AsnSchemaStorage.cache'."));return r}},{key:"cache",value:function(e){var t=this.get(e);t.schema||(t.schema=this.create(e,!0))}},{key:"createDefault",value:function(e){var t={type:Pt.Sequence,items:{}},r=this.findParentSchema(e);return r&&(Object.assign(t,r),t.items=Object.assign({},t.items,r.items)),t}},{key:"create",value:function(e,t){var r=this.items.get(e)||this.createDefault(e),n=[];for(var i in r.items){var a=r.items[i],o=t?i:"",u=void 0;if("number"==typeof a.type){var s=Ut[a.type],c=It[s];if(!c)throw new Error("Cannot get ASN1 class by name '".concat(s,"'"));u=new c({name:o})}else if(ur(a.type)){u=(new a.type).toSchema(o)}else if(a.optional){this.get(a.type).type===Pt.Choice?u=new Et({name:o}):(u=this.create(a.type,!1)).name=o}else u=new Et({name:o});var l=!!a.optional||void 0!==a.defaultValue;if(a.repeated)u.name="",u=new("set"===a.repeated?Te:Le)({name:"",value:[new Kt({name:o,value:u})]});if(null!==a.context&&void 0!==a.context)if(a.implicit)if("number"==typeof a.type||ur(a.type)){var h=a.repeated?re:$;n.push(new h({name:o,optional:l,idBlock:{tagClass:3,tagNumber:a.context}}))}else{this.cache(a.type);var f=!!a.repeated,p=f?u:this.get(a.type,!0).schema;p="valueBlock"in p?p.valueBlock.value:p.value,n.push(new re({name:f?"":o,optional:l,idBlock:{tagClass:3,tagNumber:a.context},value:p}))}else n.push(new re({optional:l,idBlock:{tagClass:3,tagNumber:a.context},value:[u]}));else u.optional=l,n.push(u)}switch(r.type){case Pt.Sequence:return new Le({value:n,name:""});case Pt.Set:return new Te({value:n,name:""});case Pt.Choice:return new Rt({value:n,name:""});default:throw new Error("Unsupported ASN1 type in use")}}},{key:"set",value:function(e,t){return this.items.set(e,t),this}},{key:"findParentSchema",value:function(e){var t=Object.getPrototypeOf(e);return t?this.items.get(t)||this.findParentSchema(t):null}}]),e}(),hr=new lr,fr=function(e){return function(t){var r;hr.has(t)?r=hr.get(t):(r=hr.createDefault(t),hr.set(t,r)),Object.assign(r,e)}},pr=function(e){return function(t,r){var n;hr.has(t.constructor)?n=hr.get(t.constructor):(n=hr.createDefault(t.constructor),hr.set(t.constructor,n));var i=Object.assign({},e);if("number"==typeof i.type&&!i.converter){var a=or(e.type);if(!a)throw new Error("Cannot get default converter for property '".concat(r,"' of ").concat(t.constructor.name));i.converter=a}n.items[r]=i}},vr=function(e){_inherits(r,_wrapNativeSuper(Error));var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).schemas=[],e}return _createClass(r)}(),yr=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"parse",value:function(e,t){var r=Q(e);if(r.result.error)throw new Error(r.result.error);return this.fromASN(r.result,t)}},{key:"fromASN",value:function(e,t){var r,n=this;try{if(ur(t))return(new t).fromASN(e);var i=hr.get(t);hr.cache(t);var a=i.schema;if(e.constructor===re&&i.type!==Pt.Choice)for(var o in a=new re({idBlock:{tagClass:3,tagNumber:e.idBlock.tagNumber},value:i.schema.valueBlock.value}),i.items)delete e[o];var u=Nt({},e,a);if(!u.verified)throw new vr("Data does not match to ".concat(t.name," ASN1 schema. ").concat(u.result.error));var s=new t;if(sr(t)){if(!("value"in e.valueBlock)||!Array.isArray(e.valueBlock.value))throw new Error("Cannot get items from the ASN.1 parsed value. ASN.1 object is not constructed.");var c=i.itemType;if("number"==typeof c){var l=or(c);if(!l)throw new Error("Cannot get default converter for array item of ".concat(t.name," ASN1 schema"));return t.from(e.valueBlock.value,(function(e){return l.fromASN(e)}))}return t.from(e.valueBlock.value,(function(e){return n.fromASN(e,c)}))}var h=function(){var e=u.result[f];if(!e)return"continue";var t=i.items[f],a=t.type;if("number"==typeof a||ur(a)){var o=null!==(r=t.converter)&&void 0!==r?r:ur(a)?new a:null;if(!o)throw new Error("Converter is empty");if(t.repeated)if(t.implicit){var c=new("sequence"===t.repeated?Le:Te);c.valueBlock=e.valueBlock;var l=Q(c.toBER(!1));if(-1===l.offset)throw new Error("Cannot parse the child item. ".concat(l.result.error));if(!("value"in l.result.valueBlock)||!Array.isArray(l.result.valueBlock.value))throw new Error("Cannot get items from the ASN.1 parsed value. ASN.1 object is not constructed.");var h=l.result.valueBlock.value;s[f]=Array.from(h,(function(e){return o.fromASN(e)}))}else s[f]=Array.from(e,(function(e){return o.fromASN(e)}));else{var p=e;if(t.implicit){var v;if(ur(a))v=(new a).toSchema("");else{var y=Ut[a],g=It[y];if(!g)throw new Error("Cannot get '".concat(y,"' class from asn1js module"));v=new g}v.valueBlock=p.valueBlock,p=Q(v.toBER(!1)).result}s[f]=o.fromASN(p)}}else if(t.repeated){if(!Array.isArray(e))throw new Error("Cannot get list of items from the ASN.1 parsed value. ASN.1 value should be iterable.");s[f]=Array.from(e,(function(e){return n.fromASN(e,a)}))}else s[f]=n.fromASN(e,a)};for(var f in i.items)h();return s}catch(e){throw e instanceof vr&&e.schemas.push(t.name),e}}}]),e}(),gr=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"serialize",value:function(e){return e instanceof z?e.toBER(!1):this.toASN(e).toBER(!1)}},{key:"toASN",value:function(t){var r=this;if(t&&"object"===_typeof(t)&&ur(t))return t.toASN();if(!t||"object"!==_typeof(t))throw new TypeError("Parameter 1 should be type of Object.");var n=t.constructor,i=hr.get(n);hr.cache(n);var a,o=[];if(i.itemType){if(!Array.isArray(t))throw new TypeError("Parameter 1 should be type of Array.");if("number"==typeof i.itemType){var u=or(i.itemType);if(!u)throw new Error("Cannot get default converter for array item of ".concat(n.name," ASN1 schema"));o=t.map((function(e){return u.toASN(e)}))}else o=t.map((function(e){return r.toAsnItem({type:i.itemType},"[]",n,e)}))}else for(var s in i.items){var c=i.items[s],l=t[s];if(!(void 0===l||c.defaultValue===l||"object"===_typeof(c.defaultValue)&&"object"===_typeof(l)&&cr(this.serialize(c.defaultValue),this.serialize(l)))){var h=e.toAsnItem(c,s,n,l);if("number"==typeof c.context)if(c.implicit)if(c.repeated||"number"!=typeof c.type&&!ur(c.type))o.push(new re({optional:c.optional,idBlock:{tagClass:3,tagNumber:c.context},value:h.valueBlock.value}));else{var f={};f.valueHex=h instanceof ue?h.valueBeforeDecodeView:h.valueBlock.toBER(),o.push(new $(_objectSpread({optional:c.optional,idBlock:{tagClass:3,tagNumber:c.context}},f)))}else o.push(new re({optional:c.optional,idBlock:{tagClass:3,tagNumber:c.context},value:[h]}));else c.repeated?o=o.concat(h):o.push(h)}}switch(i.type){case Pt.Sequence:a=new Le({value:o});break;case Pt.Set:a=new Te({value:o});break;case Pt.Choice:if(!o[0])throw new Error("Schema '".concat(n.name,"' has wrong data. Choice cannot be empty."));a=o[0]}return a}},{key:"toAsnItem",value:function(e,t,r,n){var i,a=this;if("number"==typeof e.type){var o=e.converter;if(!o)throw new Error("Property '".concat(t,"' doesn't have converter for type ").concat(Ut[e.type]," in schema '").concat(r.name,"'"));if(e.repeated){if(!Array.isArray(n))throw new TypeError("Parameter 'objProp' should be type of Array.");var u=Array.from(n,(function(e){return o.toASN(e)}));i=new("sequence"===e.repeated?Le:Te)({value:u})}else i=o.toASN(n)}else if(e.repeated){if(!Array.isArray(n))throw new TypeError("Parameter 'objProp' should be type of Array.");var s=Array.from(n,(function(e){return a.toASN(e)}));i=new("sequence"===e.repeated?Le:Te)({value:s})}else i=this.toASN(n);return i}}]),e}(),dr=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"serialize",value:function(e){return gr.serialize(e)}},{key:"parse",value:function(e,t){return yr.parse(e,t)}},{key:"toString",value:function(t){var r=Q(s.isBufferSource(t)?s.toArrayBuffer(t):e.serialize(t));if(-1===r.offset)throw new Error("Cannot decode ASN.1 data. ".concat(r.result.error));return r.result.toString()}}]),e}();function mr(e,t,r,n){var i,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===("undefined"==typeof Reflect?"undefined":_typeof(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var u=e.length-1;u>=0;u--)(i=e[u])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o}function kr(e,t,r,n){return new(r||(r=Promise))((function(i,a){function o(e){try{s(n.next(e))}catch(e){a(e)}}function u(e){try{s(n.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,u)}s((n=n.apply(e,t||[])).next())}))}var wr,br=function(e){_inherits(r,_wrapNativeSuper(Error));var t=_createSuper(r);function r(e,n){var i;return _classCallCheck(this,r),(i=t.call(this,n?"".concat(e,". See the inner exception for more details."):e)).message=e,i.innerError=n,i}return _createClass(r)}(),_r=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,n,i){return _classCallCheck(this,r),t.call(this,e,"JSON doesn't match to '".concat(e.target.name,"' schema. ").concat(n),i)}return _createClass(r)}(function(e){_inherits(r,e);var t=_createSuper(r);function r(e,n,i){var a;return _classCallCheck(this,r),(a=t.call(this,n,i)).schema=e,a}return _createClass(r)}(br)),Cr=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r)}(br),Sr=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,n,i){var a;return _classCallCheck(this,r),(a=t.call(this,"Cannot serialize by '".concat(e,"' schema. ").concat(n),i)).schemaName=e,a}return _createClass(r)}(br),Ar=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,n){var i,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return _classCallCheck(this,r),(i=t.call(this,e,"Some keys doesn't match to schema")).keys=n,i.errors=a,i}return _createClass(r)}(_r);function xr(e,t){if(!function(e,t){switch(t){case wr.Boolean:return"boolean"==typeof e;case wr.Number:return"number"==typeof e;case wr.String:return"string"==typeof e}return!0}(e,t))throw new TypeError("Value must be ".concat(wr[t]))}function Br(e){return e&&e.prototype?!(!e.prototype.toJSON||!e.prototype.fromJSON)||Br(e.prototype):!!(e&&e.toJSON&&e.fromJSON)}!function(e){e[e.Any=0]="Any",e[e.Boolean=1]="Boolean",e[e.Number=2]="Number",e[e.String=3]="String"}(wr||(wr={}));var Er=function(){function e(){_classCallCheck(this,e),this.items=new Map}return _createClass(e,[{key:"has",value:function(e){return this.items.has(e)||!!this.findParentSchema(e)}},{key:"get",value:function(e){var t=this.items.get(e)||this.findParentSchema(e);if(!t)throw new Error("Cannot get schema for current target");return t}},{key:"create",value:function(e){var t={names:{}},r=this.findParentSchema(e);if(r)for(var n in Object.assign(t,r),t.names={},r.names)t.names[n]=Object.assign({},r.names[n]);return t.target=e,t}},{key:"set",value:function(e,t){return this.items.set(e,t),this}},{key:"findParentSchema",value:function(e){var t=e.__proto__;return t?this.items.get(t)||this.findParentSchema(t):null}}]),e}(),Rr="default",Kr=new Er,Or=function(){function e(t){_classCallCheck(this,e),this.pattern=new RegExp(t)}return _createClass(e,[{key:"validate",value:function(e){var t=new RegExp(this.pattern.source,this.pattern.flags);if("string"!=typeof e)throw new Cr("Incoming value must be string");if(!t.exec(e))throw new Cr("Value doesn't match to pattern '".concat(t.toString(),"'"))}}]),e}(),Nr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Number.MIN_VALUE,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Number.MAX_VALUE;_classCallCheck(this,e),this.min=t,this.max=r}return _createClass(e,[{key:"validate",value:function(e){if(xr(e,wr.Number),!(this.min<=e&&e<=this.max)){var t=this.min===Number.MIN_VALUE?"MIN":this.min,r=this.max===Number.MAX_VALUE?"MAX":this.max;throw new Cr("Value doesn't match to diapason [".concat(t,",").concat(r,"]"))}}}]),e}(),Pr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Number.MIN_VALUE,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Number.MAX_VALUE;_classCallCheck(this,e),this.min=t,this.max=r}return _createClass(e,[{key:"validate",value:function(e){if(xr(e,wr.Number),!(this.min<e&&e<this.max)){var t=this.min===Number.MIN_VALUE?"MIN":this.min,r=this.max===Number.MAX_VALUE?"MAX":this.max;throw new Cr("Value doesn't match to diapason (".concat(t,",").concat(r,")"))}}}]),e}(),Ur=function(){function e(t,r,n){_classCallCheck(this,e),this.length=t,this.minLength=r,this.maxLength=n}return _createClass(e,[{key:"validate",value:function(e){if(void 0===this.length){if(void 0!==this.minLength&&e.length<this.minLength)throw new Cr("Value length must be more than ".concat(this.minLength,"."));if(void 0!==this.maxLength&&e.length>this.maxLength)throw new Cr("Value length must be less than ".concat(this.maxLength,"."))}else if(e.length!==this.length)throw new Cr("Value length must be exactly ".concat(this.length,"."))}}]),e}(),Ir=function(){function e(t){_classCallCheck(this,e),this.enumeration=t}return _createClass(e,[{key:"validate",value:function(e){if(xr(e,wr.String),!this.enumeration.includes(e))throw new Cr("Value must be one of ".concat(this.enumeration.map((function(e){return"'".concat(e,"'")})).join(", ")))}}]),e}(),Lr=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"checkValues",value:function(e,t){var r,n=_createForOfIteratorHelper(Array.isArray(e)?e:[e]);try{for(n.s();!(r=n.n()).done;){var i,a=r.value,o=_createForOfIteratorHelper(t.validations);try{for(o.s();!(i=o.n()).done;){var u=i.value;u instanceof Ur&&t.repeated?u.validate(e):u.validate(a)}}catch(e){o.e(e)}finally{o.f()}}}catch(e){n.e(e)}finally{n.f()}}},{key:"checkTypes",value:function(e,t){if(t.repeated&&!Array.isArray(e))throw new TypeError("Value must be Array");if("number"==typeof t.type){var r,n=_createForOfIteratorHelper(Array.isArray(e)?e:[e]);try{for(n.s();!(r=n.n()).done;){xr(r.value,t.type)}}catch(e){n.e(e)}finally{n.f()}}}},{key:"getSchemaByName",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Rr;return _objectSpread(_objectSpread({},e.names[Rr]),e.names[t])}}]),e}(),Tr=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,null,[{key:"serialize",value:function(e,t,r,n){var i=this.toJSON(e,t);return JSON.stringify(i,r,n)}},{key:"toJSON",value:function(e){var t,r=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=n.targetSchema,a=n.schemaName||Rr;if(Br(e))return e.toJSON();if(Array.isArray(e)){t=[];var o,u=_createForOfIteratorHelper(e);try{for(u.s();!(o=u.n()).done;){var s=o.value;t.push(this.toJSON(s,n))}}catch(e){u.e(e)}finally{u.f()}}else if("object"===_typeof(e)){if(i&&!Kr.has(i))throw new br("Cannot get schema for `targetSchema` param");if(i=i||e.constructor,Kr.has(i)){var c=Kr.get(i);t={};var l=this.getSchemaByName(c,a),h=function(){try{var n,o=l[f],u=e[f];if(o.optional&&void 0===u||void 0!==o.defaultValue&&u===o.defaultValue)return"continue";if(!o.optional&&void 0===u)throw new Sr(i.name,"Property '".concat(f,"' is required."));n="number"==typeof o.type?o.converter?o.repeated?u.map((function(t){return o.converter.toJSON(t,e)})):o.converter.toJSON(u,e):u:o.repeated?u.map((function(e){return r.toJSON(e,{schemaName:a})})):r.toJSON(u,{schemaName:a}),r.checkTypes(n,o),r.checkValues(n,o),t[o.name||f]=n}catch(e){throw e instanceof Sr?e:new Sr(c.target.name,"Property '".concat(f,"' is wrong. ").concat(e.message),e)}};for(var f in l)h()}else for(var p in t={},e)t[p]=this.toJSON(e[p],{schemaName:a})}else t=e;return t}}]),r}(Lr),jr=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,null,[{key:"parse",value:function(e,t){var r=JSON.parse(e);return this.fromJSON(r,t)}},{key:"fromJSON",value:function(e,t){var n=this,i=t.targetSchema,a=t.schemaName||Rr,o=new i;if(Br(o))return o.fromJSON(e);var u=Kr.get(i),s=this.getSchemaByName(u,a),c={};t.strictProperty&&!Array.isArray(e)&&r.checkStrictProperty(e,s,u);var l=function(){try{var r=s[h],i=r.name||h,l=e[i];if(void 0===l&&(r.optional||void 0!==r.defaultValue))return"continue";if(!r.optional&&void 0===l)throw new _r(u,"Property '".concat(i,"' is required."));if(n.checkTypes(l,r),n.checkValues(l,r),"number"==typeof r.type)r.converter?r.repeated?o[h]=l.map((function(e){return r.converter.fromJSON(e,o)})):o[h]=r.converter.fromJSON(l,o):o[h]=l;else{var f=_objectSpread(_objectSpread({},t),{},{targetSchema:r.type,schemaName:a});r.repeated?o[h]=l.map((function(e){return n.fromJSON(e,f)})):o[h]=n.fromJSON(l,f)}}catch(e){if(e instanceof _r||(e=new _r(u,"Property '".concat(h,"' is wrong. ").concat(e.message),e)),!t.strictAllKeys)throw e;c[h]=e}};for(var h in s)l();var f=Object.keys(c);if(f.length)throw new Ar(u,f,c);return o}},{key:"checkStrictProperty",value:function(e,t,r){for(var n=Object.keys(e),i=Object.keys(t),a=[],o=0,u=n;o<u.length;o++){var s=u[o];-1===i.indexOf(s)&&a.push(s)}if(a.length)throw new Ar(r,a)}}]),r}(Lr);var Hr=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t,r){var n,i="Cannot set type for ".concat(r," property of ").concat(t.constructor.name," schema");Kr.has(t.constructor)?(n=Kr.get(t.constructor)).target!==t.constructor&&(n=Kr.create(t.constructor),Kr.set(t.constructor,n)):(n=Kr.create(t.constructor),Kr.set(t.constructor,n));var a,o,u={type:wr.Any,validations:[]},s=Object.assign(u,e);if(s.validations=(o=[],(a=s).pattern&&o.push(new Or(a.pattern)),a.type!==wr.Number&&a.type!==wr.Any||(void 0===a.minInclusive&&void 0===a.maxInclusive||o.push(new Nr(a.minInclusive,a.maxInclusive)),void 0===a.minExclusive&&void 0===a.maxExclusive||o.push(new Pr(a.minExclusive,a.maxExclusive)),void 0!==a.enumeration&&o.push(new Ir(a.enumeration))),(a.type===wr.String||a.repeated||a.type===wr.Any)&&(void 0===a.length&&void 0===a.minLength&&void 0===a.maxLength||o.push(new Ur(a.length,a.minLength,a.maxLength))),o),"number"!=typeof s.type&&!Kr.has(s.type)&&!Br(s.type))throw new Error("".concat(i,". Assigning type doesn't have schema."));var c,l=_createForOfIteratorHelper(Array.isArray(e.schema)?e.schema:[e.schema||Rr]);try{for(l.s();!(c=l.n()).done;){var h=c.value;n.names[h]||(n.names[h]={}),n.names[h][r]=s}}catch(e){l.e(e)}finally{l.f()}}},Vr=function(e){_inherits(r,_wrapNativeSuper(Error));var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r)}(),Dr=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r)}(Vr),Mr=function(e){_inherits(r,e);var t=_createSuper(r);function r(e){return _classCallCheck(this,r),t.call(this,"Unsupported operation: ".concat(e?"".concat(e):""))}return _createClass(r)}(Vr),Fr=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r)}(Vr),Jr=function(e){_inherits(r,e);var t=_createSuper(r);function r(e){return _classCallCheck(this,r),t.call(this,"".concat(e,": Missing required property"))}return _createClass(r)}(Vr);function Gr(e){return"object"===_typeof(e)&&"kty"in e}var zr=function(){function e(){_classCallCheck(this,e)}var t,r,n,i,a,o,u,c,l,h,f,p,v,y,g,d,m,k;return _createClass(e,[{key:"digest",value:(k=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n,i=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=i.length,r=new Array(t),n=0;n<t;n++)r[n]=i[n];return this.checkDigest.apply(this,r),e.abrupt("return",this.onDigest.apply(this,r));case 3:case"end":return e.stop()}}),e,this)}))),function(){return k.apply(this,arguments)})},{key:"checkDigest",value:function(e,t){this.checkAlgorithmName(e)}},{key:"onDigest",value:(m=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Mr("digest");case 1:case"end":return e.stop()}}),e)}))),function(e,t){return m.apply(this,arguments)})},{key:"generateKey",value:(d=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n,i=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=i.length,r=new Array(t),n=0;n<t;n++)r[n]=i[n];return this.checkGenerateKey.apply(this,r),e.abrupt("return",this.onGenerateKey.apply(this,r));case 3:case"end":return e.stop()}}),e,this)}))),function(){return d.apply(this,arguments)})},{key:"checkGenerateKey",value:function(e,t,r){if(this.checkAlgorithmName(e),this.checkGenerateKeyParams(e),!r||!r.length)throw new TypeError("Usages cannot be empty when creating a key.");var n;n=Array.isArray(this.usages)?this.usages:this.usages.privateKey.concat(this.usages.publicKey),this.checkKeyUsages(r,n)}},{key:"checkGenerateKeyParams",value:function(e){}},{key:"onGenerateKey",value:(g=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r,n){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Mr("generateKey");case 1:case"end":return e.stop()}}),e)}))),function(e,t,r){return g.apply(this,arguments)})},{key:"sign",value:(y=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n,i=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=i.length,r=new Array(t),n=0;n<t;n++)r[n]=i[n];return this.checkSign.apply(this,r),e.abrupt("return",this.onSign.apply(this,r));case 3:case"end":return e.stop()}}),e,this)}))),function(){return y.apply(this,arguments)})},{key:"checkSign",value:function(e,t,r){this.checkAlgorithmName(e),this.checkAlgorithmParams(e),this.checkCryptoKey(t,"sign")}},{key:"onSign",value:(v=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r,n){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Mr("sign");case 1:case"end":return e.stop()}}),e)}))),function(e,t,r){return v.apply(this,arguments)})},{key:"verify",value:(p=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n,i=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=i.length,r=new Array(t),n=0;n<t;n++)r[n]=i[n];return this.checkVerify.apply(this,r),e.abrupt("return",this.onVerify.apply(this,r));case 3:case"end":return e.stop()}}),e,this)}))),function(){return p.apply(this,arguments)})},{key:"checkVerify",value:function(e,t,r,n){this.checkAlgorithmName(e),this.checkAlgorithmParams(e),this.checkCryptoKey(t,"verify")}},{key:"onVerify",value:(f=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r,n,i){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Mr("verify");case 1:case"end":return e.stop()}}),e)}))),function(e,t,r,n){return f.apply(this,arguments)})},{key:"encrypt",value:(h=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n,i=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=i.length,r=new Array(t),n=0;n<t;n++)r[n]=i[n];return this.checkEncrypt.apply(this,r),e.abrupt("return",this.onEncrypt.apply(this,r));case 3:case"end":return e.stop()}}),e,this)}))),function(){return h.apply(this,arguments)})},{key:"checkEncrypt",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this.checkAlgorithmName(e),this.checkAlgorithmParams(e),this.checkCryptoKey(t,n.keyUsage?"encrypt":void 0)}},{key:"onEncrypt",value:(l=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r,n){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Mr("encrypt");case 1:case"end":return e.stop()}}),e)}))),function(e,t,r){return l.apply(this,arguments)})},{key:"decrypt",value:(c=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n,i=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=i.length,r=new Array(t),n=0;n<t;n++)r[n]=i[n];return this.checkDecrypt.apply(this,r),e.abrupt("return",this.onDecrypt.apply(this,r));case 3:case"end":return e.stop()}}),e,this)}))),function(){return c.apply(this,arguments)})},{key:"checkDecrypt",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this.checkAlgorithmName(e),this.checkAlgorithmParams(e),this.checkCryptoKey(t,n.keyUsage?"decrypt":void 0)}},{key:"onDecrypt",value:(u=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r,n){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Mr("decrypt");case 1:case"end":return e.stop()}}),e)}))),function(e,t,r){return u.apply(this,arguments)})},{key:"deriveBits",value:(o=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n,i=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=i.length,r=new Array(t),n=0;n<t;n++)r[n]=i[n];return this.checkDeriveBits.apply(this,r),e.abrupt("return",this.onDeriveBits.apply(this,r));case 3:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"checkDeriveBits",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(this.checkAlgorithmName(e),this.checkAlgorithmParams(e),this.checkCryptoKey(t,n.keyUsage?"deriveBits":void 0),r%8!=0)throw new Fr("length: Is not multiple of 8")}},{key:"onDeriveBits",value:(a=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r,n){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Mr("deriveBits");case 1:case"end":return e.stop()}}),e)}))),function(e,t,r){return a.apply(this,arguments)})},{key:"exportKey",value:(i=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n,i=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=i.length,r=new Array(t),n=0;n<t;n++)r[n]=i[n];return this.checkExportKey.apply(this,r),e.abrupt("return",this.onExportKey.apply(this,r));case 3:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"checkExportKey",value:function(e,t){if(this.checkKeyFormat(e),this.checkCryptoKey(t),!t.extractable)throw new Vr("key: Is not extractable")}},{key:"onExportKey",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Mr("exportKey");case 1:case"end":return e.stop()}}),e)}))),function(e,t){return n.apply(this,arguments)})},{key:"importKey",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n,i=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=i.length,r=new Array(t),n=0;n<t;n++)r[n]=i[n];return this.checkImportKey.apply(this,r),e.abrupt("return",this.onImportKey.apply(this,r));case 3:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"checkImportKey",value:function(e,t,r,n,i){this.checkKeyFormat(e),this.checkKeyData(e,t),this.checkAlgorithmName(r),this.checkImportParams(r),Array.isArray(this.usages)&&this.checkKeyUsages(i,this.usages)}},{key:"onImportKey",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r,n,i,a){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Mr("importKey");case 1:case"end":return e.stop()}}),e)}))),function(e,r,n,i,a){return t.apply(this,arguments)})},{key:"checkAlgorithmName",value:function(e){if(e.name.toLowerCase()!==this.name.toLowerCase())throw new Dr("Unrecognized name")}},{key:"checkAlgorithmParams",value:function(e){}},{key:"checkDerivedKeyParams",value:function(e){}},{key:"checkKeyUsages",value:function(e,t){var r,n=_createForOfIteratorHelper(e);try{for(n.s();!(r=n.n()).done;){var i=r.value;if(-1===t.indexOf(i))throw new TypeError("Cannot create a key using the specified key usages")}}catch(e){n.e(e)}finally{n.f()}}},{key:"checkCryptoKey",value:function(e,t){if(this.checkAlgorithmName(e.algorithm),t&&-1===e.usages.indexOf(t))throw new Vr("key does not match that of operation")}},{key:"checkRequiredProperty",value:function(e,t){if(!(t in e))throw new Jr(t)}},{key:"checkHashAlgorithm",value:function(e,t){var r,n=_createForOfIteratorHelper(t);try{for(n.s();!(r=n.n()).done;){if(r.value.toLowerCase()===e.name.toLowerCase())return}}catch(e){n.e(e)}finally{n.f()}throw new Fr("hash: Must be one of ".concat(t.join(", ")))}},{key:"checkImportParams",value:function(e){}},{key:"checkKeyFormat",value:function(e){switch(e){case"raw":case"pkcs8":case"spki":case"jwk":break;default:throw new TypeError("format: Is invalid value. Must be 'jwk', 'raw', 'spki', or 'pkcs8'")}}},{key:"checkKeyData",value:function(e,t){if(!t)throw new TypeError("keyData: Cannot be empty on empty on key importing");if("jwk"===e){if(!Gr(t))throw new TypeError("keyData: Is not JsonWebToken")}else if(!s.isBufferSource(t))throw new TypeError("keyData: Is not ArrayBufferView or ArrayBuffer")}},{key:"prepareData",value:function(e){return s.toArrayBuffer(e)}}]),e}(),qr=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,[{key:"checkGenerateKeyParams",value:function(e){if(this.checkRequiredProperty(e,"length"),"number"!=typeof e.length)throw new TypeError("length: Is not of type Number");switch(e.length){case 128:case 192:case 256:break;default:throw new TypeError("length: Must be 128, 192, or 256")}}},{key:"checkDerivedKeyParams",value:function(e){this.checkGenerateKeyParams(e)}}]),r}(zr),Wr=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).name="AES-CBC",e.usages=["encrypt","decrypt","wrapKey","unwrapKey"],e}return _createClass(r,[{key:"checkAlgorithmParams",value:function(e){if(this.checkRequiredProperty(e,"iv"),!(e.iv instanceof ArrayBuffer||ArrayBuffer.isView(e.iv)))throw new TypeError("iv: Is not of type '(ArrayBuffer or ArrayBufferView)'");if(16!==e.iv.byteLength)throw new TypeError("iv: Must have length 16 bytes")}}]),r}(qr),Xr=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).name="AES-CTR",e.usages=["encrypt","decrypt","wrapKey","unwrapKey"],e}return _createClass(r,[{key:"checkAlgorithmParams",value:function(e){if(this.checkRequiredProperty(e,"counter"),!(e.counter instanceof ArrayBuffer||ArrayBuffer.isView(e.counter)))throw new TypeError("counter: Is not of type '(ArrayBuffer or ArrayBufferView)'");if(16!==e.counter.byteLength)throw new TypeError("iv: Must have length 16 bytes");if(this.checkRequiredProperty(e,"length"),"number"!=typeof e.length)throw new TypeError("length: Is not a Number");if(e.length<1)throw new Fr("length: Must be more than 0")}}]),r}(qr),Zr=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).name="AES-ECB",e.usages=["encrypt","decrypt","wrapKey","unwrapKey"],e}return _createClass(r)}(qr),$r=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).name="AES-GCM",e.usages=["encrypt","decrypt","wrapKey","unwrapKey"],e}return _createClass(r,[{key:"checkAlgorithmParams",value:function(e){if(this.checkRequiredProperty(e,"iv"),!(e.iv instanceof ArrayBuffer||ArrayBuffer.isView(e.iv)))throw new TypeError("iv: Is not of type '(ArrayBuffer or ArrayBufferView)'");if(e.iv.byteLength<1)throw new Fr("iv: Must have length more than 0 and less than 2^64 - 1");switch("tagLength"in e||(e.tagLength=128),e.tagLength){case 32:case 64:case 96:case 104:case 112:case 120:case 128:break;default:throw new Fr("tagLength: Must be one of 32, 64, 96, 104, 112, 120 or 128")}}}]),r}(qr),Yr=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).name="AES-KW",e.usages=["wrapKey","unwrapKey"],e}return _createClass(r)}(qr),Qr=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).usages=["encrypt","decrypt","wrapKey","unwrapKey"],e}return _createClass(r,[{key:"checkAlgorithmParams",value:function(e){if(this.ivSize){if(this.checkRequiredProperty(e,"iv"),!(e.iv instanceof ArrayBuffer||ArrayBuffer.isView(e.iv)))throw new TypeError("iv: Is not of type '(ArrayBuffer or ArrayBufferView)'");if(e.iv.byteLength!==this.ivSize)throw new TypeError("iv: Must have length ".concat(this.ivSize," bytes"))}}},{key:"checkGenerateKeyParams",value:function(e){if(this.checkRequiredProperty(e,"length"),"number"!=typeof e.length)throw new TypeError("length: Is not of type Number");if(e.length!==this.keySizeBits)throw new Fr("algorithm.length: Must be ".concat(this.keySizeBits))}},{key:"checkDerivedKeyParams",value:function(e){this.checkGenerateKeyParams(e)}}]),r}(zr),en=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).hashAlgorithms=["SHA-1","SHA-256","SHA-384","SHA-512"],e}return _createClass(r,[{key:"checkGenerateKeyParams",value:function(e){if(this.checkRequiredProperty(e,"hash"),this.checkHashAlgorithm(e.hash,this.hashAlgorithms),this.checkRequiredProperty(e,"publicExponent"),!(e.publicExponent&&e.publicExponent instanceof Uint8Array))throw new TypeError("publicExponent: Missing or not a Uint8Array");var t=h.ToBase64(e.publicExponent);if("Aw=="!==t&&"AQAB"!==t)throw new TypeError("publicExponent: Must be [3] or [1,0,1]");if(this.checkRequiredProperty(e,"modulusLength"),e.modulusLength%8||e.modulusLength<256||e.modulusLength>16384)throw new TypeError("The modulus length must be a multiple of 8 bits and >= 256 and <= 16384")}},{key:"checkImportParams",value:function(e){this.checkRequiredProperty(e,"hash"),this.checkHashAlgorithm(e.hash,this.hashAlgorithms)}}]),r}(zr),tn=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).name="RSASSA-PKCS1-v1_5",e.usages={privateKey:["sign"],publicKey:["verify"]},e}return _createClass(r)}(en),rn=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).name="RSA-PSS",e.usages={privateKey:["sign"],publicKey:["verify"]},e}return _createClass(r,[{key:"checkAlgorithmParams",value:function(e){if(this.checkRequiredProperty(e,"saltLength"),"number"!=typeof e.saltLength)throw new TypeError("saltLength: Is not a Number");if(e.saltLength<0)throw new RangeError("saltLength: Must be positive number")}}]),r}(en),nn=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).name="RSA-OAEP",e.usages={privateKey:["decrypt","unwrapKey"],publicKey:["encrypt","wrapKey"]},e}return _createClass(r,[{key:"checkAlgorithmParams",value:function(e){if(e.label&&!(e.label instanceof ArrayBuffer||ArrayBuffer.isView(e.label)))throw new TypeError("label: Is not of type '(ArrayBuffer or ArrayBufferView)'")}}]),r}(en),an=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,[{key:"checkGenerateKeyParams",value:function(e){this.checkRequiredProperty(e,"namedCurve"),this.checkNamedCurve(e.namedCurve)}},{key:"checkNamedCurve",value:function(e){var t,r=_createForOfIteratorHelper(this.namedCurves);try{for(r.s();!(t=r.n()).done;){if(t.value.toLowerCase()===e.toLowerCase())return}}catch(e){r.e(e)}finally{r.f()}throw new Fr("namedCurve: Must be one of ".concat(this.namedCurves.join(", ")))}}]),r}(zr),on=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).name="ECDSA",e.hashAlgorithms=["SHA-1","SHA-256","SHA-384","SHA-512"],e.usages={privateKey:["sign"],publicKey:["verify"]},e.namedCurves=["P-256","P-384","P-521","K-256"],e}return _createClass(r,[{key:"checkAlgorithmParams",value:function(e){this.checkRequiredProperty(e,"hash"),this.checkHashAlgorithm(e.hash,this.hashAlgorithms)}}]),r}(an),un=["secret","private","public"],sn=function(e){function t(){_classCallCheck(this,t)}return _createClass(t,[{key:Symbol.toStringTag,get:function(){return"CryptoKey"}}],[{key:"create",value:function(e,t,r,n){var i=new this;return i.algorithm=e,i.type=t,i.extractable=r,i.usages=n,i}},{key:"isKeyType",value:function(e){return-1!==un.indexOf(e)}}]),t}(),cn=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).name="ECDH",e.usages={privateKey:["deriveBits","deriveKey"],publicKey:[]},e.namedCurves=["P-256","P-384","P-521","K-256"],e}return _createClass(r,[{key:"checkAlgorithmParams",value:function(e){if(this.checkRequiredProperty(e,"public"),!(e.public instanceof sn))throw new TypeError("public: Is not a CryptoKey");if("public"!==e.public.type)throw new Fr("public: Is not a public key");if(e.public.algorithm.name!==this.name)throw new Fr("public: Is not ".concat(this.name," key"))}}]),r}(an),ln=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).name="ECDH-ES",e.namedCurves=["X25519","X448"],e}return _createClass(r)}(cn),hn=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).name="EdDSA",e.usages={privateKey:["sign"],publicKey:["verify"]},e.namedCurves=["Ed25519","Ed448"],e}return _createClass(r)}(an),fn=_createClass((function e(t){_classCallCheck(this,e),t&&(this.value=t)}));mr([pr({type:Ut.ObjectIdentifier})],fn.prototype,"value",void 0),fn=mr([fr({type:Pt.Choice})],fn);var pn=_createClass((function e(t){_classCallCheck(this,e),Object.assign(this,t)}));mr([pr({type:Ut.ObjectIdentifier})],pn.prototype,"algorithm",void 0),mr([pr({type:Ut.Any,optional:!0})],pn.prototype,"parameters",void 0);var vn=_createClass((function e(){_classCallCheck(this,e),this.version=0,this.privateKeyAlgorithm=new pn,this.privateKey=new ArrayBuffer(0)}));mr([pr({type:Ut.Integer})],vn.prototype,"version",void 0),mr([pr({type:pn})],vn.prototype,"privateKeyAlgorithm",void 0),mr([pr({type:Ut.OctetString})],vn.prototype,"privateKey",void 0),mr([pr({type:Ut.Any,optional:!0})],vn.prototype,"attributes",void 0);var yn=_createClass((function e(){_classCallCheck(this,e),this.publicKeyAlgorithm=new pn,this.publicKey=new ArrayBuffer(0)}));mr([pr({type:pn})],yn.prototype,"publicKeyAlgorithm",void 0),mr([pr({type:Ut.BitString})],yn.prototype,"publicKey",void 0);var gn={fromJSON:function(e){return h.FromBase64Url(e)},toJSON:function(e){return h.ToBase64Url(new Uint8Array(e))}},dn={fromASN:function(e){var t=e.valueBlock.valueHex;return new Uint8Array(t)[0]?e.valueBlock.valueHex:e.valueBlock.valueHex.slice(1)},toASN:function(e){var t=new Uint8Array(e)[0]>127?f(new Uint8Array([0]).buffer,e):e;return new Se({valueHex:t})}},mn=_createClass((function e(){_classCallCheck(this,e),this.version=0,this.modulus=new ArrayBuffer(0),this.publicExponent=new ArrayBuffer(0),this.privateExponent=new ArrayBuffer(0),this.prime1=new ArrayBuffer(0),this.prime2=new ArrayBuffer(0),this.exponent1=new ArrayBuffer(0),this.exponent2=new ArrayBuffer(0),this.coefficient=new ArrayBuffer(0)}));mr([pr({type:Ut.Integer,converter:jt})],mn.prototype,"version",void 0),mr([pr({type:Ut.Integer,converter:dn}),Hr({name:"n",converter:gn})],mn.prototype,"modulus",void 0),mr([pr({type:Ut.Integer,converter:dn}),Hr({name:"e",converter:gn})],mn.prototype,"publicExponent",void 0),mr([pr({type:Ut.Integer,converter:dn}),Hr({name:"d",converter:gn})],mn.prototype,"privateExponent",void 0),mr([pr({type:Ut.Integer,converter:dn}),Hr({name:"p",converter:gn})],mn.prototype,"prime1",void 0),mr([pr({type:Ut.Integer,converter:dn}),Hr({name:"q",converter:gn})],mn.prototype,"prime2",void 0),mr([pr({type:Ut.Integer,converter:dn}),Hr({name:"dp",converter:gn})],mn.prototype,"exponent1",void 0),mr([pr({type:Ut.Integer,converter:dn}),Hr({name:"dq",converter:gn})],mn.prototype,"exponent2",void 0),mr([pr({type:Ut.Integer,converter:dn}),Hr({name:"qi",converter:gn})],mn.prototype,"coefficient",void 0),mr([pr({type:Ut.Any,optional:!0})],mn.prototype,"otherPrimeInfos",void 0);var kn=_createClass((function e(){_classCallCheck(this,e),this.modulus=new ArrayBuffer(0),this.publicExponent=new ArrayBuffer(0)}));mr([pr({type:Ut.Integer,converter:dn}),Hr({name:"n",converter:gn})],kn.prototype,"modulus",void 0),mr([pr({type:Ut.Integer,converter:dn}),Hr({name:"e",converter:gn})],kn.prototype,"publicExponent",void 0);var wn=function(){function e(t){_classCallCheck(this,e),this.value=new ArrayBuffer(0),t&&(this.value=t)}return _createClass(e,[{key:"toJSON",value:function(){var e=new Uint8Array(this.value);if(4!==e[0])throw new Vr("Wrong ECPoint. Current version supports only Uncompressed (0x04) point");var t=(e=new Uint8Array(this.value.slice(1))).length/2;return{x:h.ToBase64Url(e.buffer.slice(0,0+t)),y:h.ToBase64Url(e.buffer.slice(0+t,0+t+t))}}},{key:"fromJSON",value:function(e){if(!("x"in e))throw new Error("x: Missing required property");if(!("y"in e))throw new Error("y: Missing required property");var t=h.FromBase64Url(e.x),r=h.FromBase64Url(e.y),n=f(new Uint8Array([4]).buffer,t,r);return this.value=new Uint8Array(n).buffer,this}}]),e}();mr([pr({type:Ut.OctetString})],wn.prototype,"value",void 0),wn=mr([fr({type:Pt.Choice})],wn);var bn=function(){function e(){_classCallCheck(this,e),this.version=1,this.privateKey=new ArrayBuffer(0)}return _createClass(e,[{key:"fromJSON",value:function(e){if(!("d"in e))throw new Error("d: Missing required property");if(this.privateKey=h.FromBase64Url(e.d),"x"in e){var t=new wn;t.fromJSON(e);var r=gr.toASN(t);"valueHex"in r.valueBlock&&(this.publicKey=r.valueBlock.valueHex)}return this}},{key:"toJSON",value:function(){var e={};return e.d=h.ToBase64Url(this.privateKey),this.publicKey&&Object.assign(e,new wn(this.publicKey).toJSON()),e}}]),e}();mr([pr({type:Ut.Integer,converter:jt})],bn.prototype,"version",void 0),mr([pr({type:Ut.OctetString})],bn.prototype,"privateKey",void 0),mr([pr({context:0,type:Ut.Any,optional:!0})],bn.prototype,"parameters",void 0),mr([pr({context:1,type:Ut.BitString,optional:!0})],bn.prototype,"publicKey",void 0);var _n={fromASN:function(e){var t=new Uint8Array(e.valueBlock.valueHex);return 0===t[0]?t.buffer.slice(1):t.buffer},toASN:function(e){var t=new Uint8Array(e);if(t[0]>127){var r=new Uint8Array(t.length+1);return r.set(t,1),new Se({valueHex:r.buffer})}return new Se({valueHex:e})}},Cn=Object.freeze({__proto__:null,AsnIntegerWithoutPaddingConverter:_n}),Sn=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"decodePoint",value:function(e,t){var r=s.toUint8Array(e);if(0===r.length||4!==r[0])throw new Error("Only uncompressed point format supported");var n=(r.length-1)/2;if(n!==Math.ceil(t/8))throw new Error("Point does not match field size");return{x:r.slice(1,n+1),y:r.slice(n+1,n+1+n)}}},{key:"encodePoint",value:function(e,t){var r=Math.ceil(t/8);if(e.x.byteLength!==r||e.y.byteLength!==r)throw new Error("X,Y coordinates don't match point size criteria");var n=s.toUint8Array(e.x),i=s.toUint8Array(e.y),a=new Uint8Array(2*r+1);return a[0]=4,a.set(n,1),a.set(i,r+1),a}},{key:"getSize",value:function(e){return Math.ceil(e/8)}},{key:"encodeSignature",value:function(e,t){var r=this.getSize(t),n=s.toUint8Array(e.r),i=s.toUint8Array(e.s),a=new Uint8Array(2*r);return a.set(this.padStart(n,r)),a.set(this.padStart(i,r),r),a}},{key:"decodeSignature",value:function(e,t){var r=this.getSize(t),n=s.toUint8Array(e);if(n.length!==2*r)throw new Error("Incorrect size of the signature");var i=n.slice(0,r),a=n.slice(r);return{r:this.trimStart(i),s:this.trimStart(a)}}},{key:"trimStart",value:function(e){for(var t=0;t<e.length-1&&0===e[t];)t++;return 0===t?e:e.slice(t,e.length)}},{key:"padStart",value:function(e,t){if(t===e.length)return e;var r=new Uint8Array(t);return r.set(e,t-e.length),r}}]),e}(),An=function(){function e(){_classCallCheck(this,e),this.r=new ArrayBuffer(0),this.s=new ArrayBuffer(0)}return _createClass(e,[{key:"toWebCryptoSignature",value:function(e){return null!=e||(e=8*Math.max(this.r.byteLength,this.s.byteLength)),Sn.encodeSignature(this,e).buffer}}],[{key:"fromWebCryptoSignature",value:function(t){var r=t.byteLength/2,n=Sn.decodeSignature(t,8*r),i=new e;return i.r=s.toArrayBuffer(n.r),i.s=s.toArrayBuffer(n.s),i}}]),e}();mr([pr({type:Ut.Integer,converter:_n})],An.prototype,"r",void 0),mr([pr({type:Ut.Integer,converter:_n})],An.prototype,"s",void 0);var xn=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r)}(vn);mr([pr({context:1,implicit:!0,type:Ut.BitString,optional:!0})],xn.prototype,"publicKey",void 0);var Bn=function(){function e(){_classCallCheck(this,e),this.value=new ArrayBuffer(0)}return _createClass(e,[{key:"fromJSON",value:function(e){if(!e.d)throw new Error("d: Missing required property");return this.value=h.FromBase64Url(e.d),this}},{key:"toJSON",value:function(){return{d:h.ToBase64Url(this.value)}}}]),e}();mr([pr({type:Ut.OctetString})],Bn.prototype,"value",void 0),Bn=mr([fr({type:Pt.Choice})],Bn);var En=function(){function e(t){_classCallCheck(this,e),this.value=new ArrayBuffer(0),t&&(this.value=t)}return _createClass(e,[{key:"toJSON",value:function(){return{x:h.ToBase64Url(this.value)}}},{key:"fromJSON",value:function(e){if(!("x"in e))throw new Error("x: Missing required property");return this.value=h.FromBase64Url(e.x),this}}]),e}();mr([pr({type:Ut.BitString})],En.prototype,"value",void 0),En=mr([fr({type:Pt.Choice})],En);var Rn=_createClass((function e(){_classCallCheck(this,e)}));mr([pr({type:Ut.OctetString}),Hr({type:wr.String,converter:gn})],Rn.prototype,"d",void 0),Rn=mr([fr({type:Pt.Choice})],Rn);var Kn="1.2.840.10045.3.1.7",On="1.3.132.0",Nn="".concat(On,".34"),Pn="".concat(On,".35"),Un="".concat(On,".10"),In="1.3.36.3.3.2.8.1.1",Ln="".concat(In,".1"),Tn="".concat(In,".2"),jn="".concat(In,".3"),Hn="".concat(In,".4"),Vn="".concat(In,".5"),Dn="".concat(In,".6"),Mn="".concat(In,".7"),Fn="".concat(In,".8"),Jn="".concat(In,".9"),Gn="".concat(In,".10"),zn="".concat(In,".11"),qn="".concat(In,".12"),Wn="".concat(In,".13"),Xn="".concat(In,".14"),Zn=Object.freeze({__proto__:null,AlgorithmIdentifier:pn,get CurvePrivateKey(){return Rn},EcDsaSignature:An,EcPrivateKey:bn,get EcPublicKey(){return wn},get EdPrivateKey(){return Bn},get EdPublicKey(){return En},get ObjectIdentifier(){return fn},OneAsymmetricKey:xn,PrivateKeyInfo:vn,PublicKeyInfo:yn,RsaPrivateKey:mn,RsaPublicKey:kn,converters:Cn,idBrainpoolP160r1:Ln,idBrainpoolP160t1:Tn,idBrainpoolP192r1:jn,idBrainpoolP192t1:Hn,idBrainpoolP224r1:Vn,idBrainpoolP224t1:Dn,idBrainpoolP256r1:Mn,idBrainpoolP256t1:Fn,idBrainpoolP320r1:Jn,idBrainpoolP320t1:Gn,idBrainpoolP384r1:zn,idBrainpoolP384t1:qn,idBrainpoolP512r1:Wn,idBrainpoolP512t1:Xn,idEd25519:"1.3.101.112",idEd448:"1.3.101.113",idEllipticCurve:On,idSecp256k1:Un,idSecp256r1:Kn,idSecp384r1:Nn,idSecp521r1:Pn,idVersionOne:In,idX25519:"1.3.101.110",idX448:"1.3.101.111"}),$n=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"register",value:function(e){var t=new fn;t.value=e.id;var r=dr.serialize(t);this.items.push(_objectSpread(_objectSpread({},e),{},{raw:r})),this.names.push(e.name)}},{key:"find",value:function(e){e=e.toUpperCase();var t,r=_createForOfIteratorHelper(this.items);try{for(r.s();!(t=r.n()).done;){var n=t.value;if(n.name.toUpperCase()===e||n.id.toUpperCase()===e)return n}}catch(e){r.e(e)}finally{r.f()}return null}},{key:"get",value:function(e){var t=this.find(e);if(!t)throw new Error("Unsupported EC named curve '".concat(e,"'"));return t}}]),e}();$n.items=[],$n.names=[],$n.register({name:"P-256",id:Kn,size:256}),$n.register({name:"P-384",id:Nn,size:384}),$n.register({name:"P-521",id:Pn,size:521}),$n.register({name:"K-256",id:Un,size:256}),$n.register({name:"brainpoolP160r1",id:Ln,size:160}),$n.register({name:"brainpoolP160t1",id:Tn,size:160}),$n.register({name:"brainpoolP192r1",id:jn,size:192}),$n.register({name:"brainpoolP192t1",id:Hn,size:192}),$n.register({name:"brainpoolP224r1",id:Vn,size:224}),$n.register({name:"brainpoolP224t1",id:Dn,size:224}),$n.register({name:"brainpoolP256r1",id:Mn,size:256}),$n.register({name:"brainpoolP256t1",id:Fn,size:256}),$n.register({name:"brainpoolP320r1",id:Jn,size:320}),$n.register({name:"brainpoolP320t1",id:Gn,size:320}),$n.register({name:"brainpoolP384r1",id:zn,size:384}),$n.register({name:"brainpoolP384t1",id:qn,size:384}),$n.register({name:"brainpoolP512r1",id:Wn,size:512}),$n.register({name:"brainpoolP512t1",id:Xn,size:512});var Yn,Qn=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).name="HMAC",e.hashAlgorithms=["SHA-1","SHA-256","SHA-384","SHA-512"],e.usages=["sign","verify"],e}return _createClass(r,[{key:"getDefaultLength",value:function(e){switch(e.toUpperCase()){case"SHA-1":case"SHA-256":case"SHA-384":case"SHA-512":return 512;default:throw new Error("Unknown algorithm name '".concat(e,"'"))}}},{key:"checkGenerateKeyParams",value:function(e){if(this.checkRequiredProperty(e,"hash"),this.checkHashAlgorithm(e.hash,this.hashAlgorithms),"length"in e){if("number"!=typeof e.length)throw new TypeError("length: Is not a Number");if(e.length<1)throw new RangeError("length: Number is out of range")}}},{key:"checkImportParams",value:function(e){this.checkRequiredProperty(e,"hash"),this.checkHashAlgorithm(e.hash,this.hashAlgorithms)}}]),r}(zr),ei=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).name="PBKDF2",e.hashAlgorithms=["SHA-1","SHA-256","SHA-384","SHA-512"],e.usages=["deriveBits","deriveKey"],e}return _createClass(r,[{key:"checkAlgorithmParams",value:function(e){if(this.checkRequiredProperty(e,"hash"),this.checkHashAlgorithm(e.hash,this.hashAlgorithms),this.checkRequiredProperty(e,"salt"),!(e.salt instanceof ArrayBuffer||ArrayBuffer.isView(e.salt)))throw new TypeError("salt: Is not of type '(ArrayBuffer or ArrayBufferView)'");if(this.checkRequiredProperty(e,"iterations"),"number"!=typeof e.iterations)throw new TypeError("iterations: Is not a Number");if(e.iterations<1)throw new TypeError("iterations: Is less than 1")}},{key:"checkImportKey",value:function(e,t,n,i,a){if(_get(_getPrototypeOf(r.prototype),"checkImportKey",this).call(this,e,t,n,i,a),i)throw new SyntaxError("extractable: Must be 'false'")}}]),r}(zr),ti=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).usages=[],e.defaultLength=0,e}return _createClass(r,[{key:"digest",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t[0]=_objectSpread({length:this.defaultLength},t[0]),_get(_getPrototypeOf(r.prototype),"digest",this).apply(this,t)}},{key:"checkDigest",value:function(e,t){_get(_getPrototypeOf(r.prototype),"checkDigest",this).call(this,e,t);var n=e.length||0;if("number"!=typeof n)throw new TypeError("length: Is not a Number");if(n<0)throw new TypeError("length: Is negative")}}]),r}(zr),ri=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).name="shake128",e.defaultLength=16,e}return _createClass(r)}(ti),ni=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).name="shake256",e.defaultLength=32,e}return _createClass(r)}(ti),ii=function(e){function t(){_classCallCheck(this,t)}return _createClass(t,[{key:Symbol.toStringTag,get:function(){return"Crypto"}},{key:"randomUUID",value:function(){var e=this.getRandomValues(new Uint8Array(16));e[6]=15&e[6]|64,e[8]=63&e[8]|128;var t=h.ToHex(e).toLowerCase();return"".concat(t.substring(0,8),"-").concat(t.substring(8,12),"-").concat(t.substring(12,16),"-").concat(t.substring(16,20),"-").concat(t.substring(20))}}]),t}(),ai=function(){function e(){_classCallCheck(this,e),this.items={}}return _createClass(e,[{key:"get",value:function(e){return this.items[e.toLowerCase()]||null}},{key:"set",value:function(e){this.items[e.name.toLowerCase()]=e}},{key:"removeAt",value:function(e){var t=this.get(e.toLowerCase());return t&&delete this.items[e],t}},{key:"has",value:function(e){return!!this.get(e)}},{key:"length",get:function(){return Object.keys(this.items).length}},{key:"algorithms",get:function(){var e=[];for(var t in this.items){var r=this.items[t];e.push(r.name)}return e.sort()}}]),e}(),oi=function(e){function t(){_classCallCheck(this,t),this.providers=new ai}var r,n,i,a,o,u,c,l,f,p,v,y;return _createClass(t,[{key:Symbol.toStringTag,get:function(){return"SubtleCrypto"}},{key:"digest",value:(y=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n,i,a,o,u,c,l,h,f=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=f.length,r=new Array(t),n=0;n<t;n++)r[n]=f[n];return this.checkRequiredArguments(r,2,"digest"),i=r[0],a=r[1],o=r.slice(2),u=this.prepareAlgorithm(i),c=s.toArrayBuffer(a),l=this.getProvider(u.name),e.next=8,l.digest.apply(l,[u,c].concat(_toConsumableArray(o)));case 8:return h=e.sent,e.abrupt("return",h);case 10:case"end":return e.stop()}}),e,this)}))),function(){return y.apply(this,arguments)})},{key:"generateKey",value:(v=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n,i,a,o,u,s,c,l,h=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=h.length,r=new Array(t),n=0;n<t;n++)r[n]=h[n];return this.checkRequiredArguments(r,3,"generateKey"),i=r[0],a=r[1],o=r[2],u=r.slice(3),s=this.prepareAlgorithm(i),c=this.getProvider(s.name),e.next=7,c.generateKey.apply(c,[_objectSpread(_objectSpread({},s),{},{name:c.name}),a,o].concat(_toConsumableArray(u)));case 7:return l=e.sent,e.abrupt("return",l);case 9:case"end":return e.stop()}}),e,this)}))),function(){return v.apply(this,arguments)})},{key:"sign",value:(p=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n,i,a,o,u,c,l,h,f,p=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=p.length,r=new Array(t),n=0;n<t;n++)r[n]=p[n];return this.checkRequiredArguments(r,3,"sign"),i=r[0],a=r[1],o=r[2],u=r.slice(3),this.checkCryptoKey(a),c=this.prepareAlgorithm(i),l=s.toArrayBuffer(o),h=this.getProvider(c.name),e.next=9,h.sign.apply(h,[_objectSpread(_objectSpread({},c),{},{name:h.name}),a,l].concat(_toConsumableArray(u)));case 9:return f=e.sent,e.abrupt("return",f);case 11:case"end":return e.stop()}}),e,this)}))),function(){return p.apply(this,arguments)})},{key:"verify",value:(f=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n,i,a,o,u,c,l,h,f,p,v,y=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=y.length,r=new Array(t),n=0;n<t;n++)r[n]=y[n];return this.checkRequiredArguments(r,4,"verify"),i=r[0],a=r[1],o=r[2],u=r[3],c=r.slice(4),this.checkCryptoKey(a),l=this.prepareAlgorithm(i),h=s.toArrayBuffer(u),f=s.toArrayBuffer(o),p=this.getProvider(l.name),e.next=10,p.verify.apply(p,[_objectSpread(_objectSpread({},l),{},{name:p.name}),a,f,h].concat(_toConsumableArray(c)));case 10:return v=e.sent,e.abrupt("return",v);case 12:case"end":return e.stop()}}),e,this)}))),function(){return f.apply(this,arguments)})},{key:"encrypt",value:(l=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n,i,a,o,u,c,l,h,f,p=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=p.length,r=new Array(t),n=0;n<t;n++)r[n]=p[n];return this.checkRequiredArguments(r,3,"encrypt"),i=r[0],a=r[1],o=r[2],u=r.slice(3),this.checkCryptoKey(a),c=this.prepareAlgorithm(i),l=s.toArrayBuffer(o),h=this.getProvider(c.name),e.next=9,h.encrypt.apply(h,[_objectSpread(_objectSpread({},c),{},{name:h.name}),a,l,{keyUsage:!0}].concat(_toConsumableArray(u)));case 9:return f=e.sent,e.abrupt("return",f);case 11:case"end":return e.stop()}}),e,this)}))),function(){return l.apply(this,arguments)})},{key:"decrypt",value:(c=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n,i,a,o,u,c,l,h,f,p=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=p.length,r=new Array(t),n=0;n<t;n++)r[n]=p[n];return this.checkRequiredArguments(r,3,"decrypt"),i=r[0],a=r[1],o=r[2],u=r.slice(3),this.checkCryptoKey(a),c=this.prepareAlgorithm(i),l=s.toArrayBuffer(o),h=this.getProvider(c.name),e.next=9,h.decrypt.apply(h,[_objectSpread(_objectSpread({},c),{},{name:h.name}),a,l,{keyUsage:!0}].concat(_toConsumableArray(u)));case 9:return f=e.sent,e.abrupt("return",f);case 11:case"end":return e.stop()}}),e,this)}))),function(){return c.apply(this,arguments)})},{key:"deriveBits",value:(u=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n,i,a,o,u,s,c,l,h=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=h.length,r=new Array(t),n=0;n<t;n++)r[n]=h[n];return this.checkRequiredArguments(r,3,"deriveBits"),i=r[0],a=r[1],o=r[2],u=r.slice(3),this.checkCryptoKey(a),s=this.prepareAlgorithm(i),c=this.getProvider(s.name),e.next=8,c.deriveBits.apply(c,[_objectSpread(_objectSpread({},s),{},{name:c.name}),a,o,{keyUsage:!0}].concat(_toConsumableArray(u)));case 8:return l=e.sent,e.abrupt("return",l);case 10:case"end":return e.stop()}}),e,this)}))),function(){return u.apply(this,arguments)})},{key:"deriveKey",value:(o=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n,i,a,o,u,s,c,l,h,f,p,v=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=v.length,r=new Array(t),n=0;n<t;n++)r[n]=v[n];return this.checkRequiredArguments(r,5,"deriveKey"),i=r[0],a=r[1],o=r[2],u=r[3],s=r[4],c=r.slice(5),l=this.prepareAlgorithm(o),this.getProvider(l.name).checkDerivedKeyParams(l),h=this.prepareAlgorithm(i),(f=this.getProvider(h.name)).checkCryptoKey(a,"deriveKey"),e.next=11,f.deriveBits.apply(f,[_objectSpread(_objectSpread({},h),{},{name:f.name}),a,o.length||512,{keyUsage:!1}].concat(_toConsumableArray(c)));case 11:return p=e.sent,e.abrupt("return",this.importKey.apply(this,["raw",p,o,u,s].concat(_toConsumableArray(c))));case 13:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"exportKey",value:(a=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n,i,a,o,u,s,c=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=c.length,r=new Array(t),n=0;n<t;n++)r[n]=c[n];return this.checkRequiredArguments(r,2,"exportKey"),i=r[0],a=r[1],o=r.slice(2),this.checkCryptoKey(a),u=this.getProvider(a.algorithm.name),e.next=7,u.exportKey.apply(u,[i,a].concat(_toConsumableArray(o)));case 7:return s=e.sent,e.abrupt("return",s);case 9:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"importKey",value:(i=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n,i,a,o,u,c,l,h,f,p,v=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=v.length,r=new Array(t),n=0;n<t;n++)r[n]=v[n];if(this.checkRequiredArguments(r,5,"importKey"),i=r[0],a=r[1],o=r[2],u=r[3],c=r[4],l=r.slice(5),h=this.prepareAlgorithm(o),f=this.getProvider(h.name),-1===["pkcs8","spki","raw"].indexOf(i)){e.next=10;break}return p=s.toArrayBuffer(a),e.abrupt("return",f.importKey.apply(f,[i,p,_objectSpread(_objectSpread({},h),{},{name:f.name}),u,c].concat(_toConsumableArray(l))));case 10:if(a.kty){e.next=12;break}throw new TypeError("keyData: Is not JSON");case 12:return e.abrupt("return",f.importKey.apply(f,[i,a,_objectSpread(_objectSpread({},h),{},{name:f.name}),u,c].concat(_toConsumableArray(l))));case 13:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"wrapKey",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r,n,i){var a,o,u,c,l,f,p,v,y=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a=y.length,o=new Array(a>4?a-4:0),u=4;u<a;u++)o[u-4]=y[u];return e.next=3,this.exportKey.apply(this,[t,r].concat(o));case 3:return c=e.sent,"jwk"===t&&(l=JSON.stringify(c),c=h.FromUtf8String(l)),f=this.prepareAlgorithm(i),p=s.toArrayBuffer(c),v=this.getProvider(f.name),e.abrupt("return",v.encrypt.apply(v,[_objectSpread(_objectSpread({},f),{},{name:v.name}),n,p,{keyUsage:!1}].concat(o)));case 9:case"end":return e.stop()}}),e,this)}))),function(e,t,r,i){return n.apply(this,arguments)})},{key:"unwrapKey",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r,n,i,a,o,u){var c,l,f,p,v,y,g,d,m=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(c=this.prepareAlgorithm(i),l=s.toArrayBuffer(r),f=this.getProvider(c.name),p=m.length,v=new Array(p>7?p-7:0),y=7;y<p;y++)v[y-7]=m[y];return e.next=6,f.decrypt.apply(f,[_objectSpread(_objectSpread({},c),{},{name:f.name}),n,l,{keyUsage:!1}].concat(v));case 6:if(g=e.sent,"jwk"!==t){e.next=17;break}e.prev=8,g=JSON.parse(h.ToUtf8String(g)),e.next=17;break;case 12:throw e.prev=12,e.t0=e.catch(8),(d=new TypeError("wrappedKey: Is not a JSON")).internal=e.t0,d;case 17:return e.abrupt("return",this.importKey.apply(this,[t,g,a,o,u].concat(v)));case 18:case"end":return e.stop()}}),e,this,[[8,12]])}))),function(e,t,n,i,a,o,u){return r.apply(this,arguments)})},{key:"checkRequiredArguments",value:function(e,t,r){if(e.length<t)throw new TypeError("Failed to execute '".concat(r,"' on 'SubtleCrypto': ").concat(t," arguments required, but only ").concat(e.length," present"))}},{key:"prepareAlgorithm",value:function(e){if("string"==typeof e)return{name:e};if(t.isHashedAlgorithm(e)){var r=_objectSpread({},e);return r.hash=this.prepareAlgorithm(e.hash),r}return _objectSpread({},e)}},{key:"getProvider",value:function(e){var t=this.providers.get(e);if(!t)throw new Dr("Unrecognized name");return t}},{key:"checkCryptoKey",value:function(e){if(!(e instanceof sn))throw new TypeError("Key is not of type 'CryptoKey'")}}],[{key:"isHashedAlgorithm",value:function(e){return!!(e&&"object"===_typeof(e)&&"name"in e&&"hash"in e)}}]),t}(),ui=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"enabled",get:function(){return"undefined"!=typeof self&&self.PV_WEBCRYPTO_LINER_LOG}},{key:"log",value:function(){if(this.enabled){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];console.log.apply(console,t)}}},{key:"error",value:function(){if(this.enabled){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];console.error.apply(console,t)}}},{key:"info",value:function(){if(this.enabled){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];console.info.apply(console,t)}}},{key:"warn",value:function(){if(this.enabled){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];console.warn.apply(console,t)}}},{key:"trace",value:function(){if(this.enabled){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];console.trace.apply(console,t)}}}]),e}();function si(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=new Uint8Array(t.map((function(e){return e.length})).reduce((function(e,t){return e+t}))),i=0;return t.forEach((function(e,t){for(var r=0;r<e.length;r++)n[i+r]=e[r];i+=e.length})),n}!function(e){e.Unknown="Unknown",e.IE="Internet Explorer",e.Safari="Safari",e.Edge="Edge",e.Chrome="Chrome",e.Firefox="Firefox Mozilla",e.Mobile="Mobile"}(Yn||(Yn={}));var ci=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,n,i,a){var o;return _classCallCheck(this,r),(o=t.call(this)).extractable=n,o.type=i,o.usages=a,o.algorithm=Object.assign({},e),o}return _createClass(r)}(sn);function li(e,t){return e.name.toUpperCase()===t.toUpperCase()}var hi=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,n,i,a){var o;return _classCallCheck(this,r),(o=t.call(this,e,n,"secret",i)).raw=a,o}return _createClass(r,[{key:"toJSON",value:function(){return{kty:"oct",alg:this.getJwkAlgorithm(),k:h.ToBase64Url(this.raw),ext:this.extractable,key_ops:this.usages}}},{key:"getJwkAlgorithm",value:function(){switch(this.algorithm.name.toUpperCase()){case"AES-CBC":return"A".concat(this.algorithm.length,"CBC");case"AES-CTR":return"A".concat(this.algorithm.length,"CTR");case"AES-GCM":return"A".concat(this.algorithm.length,"GCM");case"AES-ECB":return"A".concat(this.algorithm.length,"ECB");default:throw new Dr("Unsupported algorithm name")}}}]),r}(ci),fi=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"checkCryptoKey",value:function(e){if(!(e instanceof hi))throw new TypeError("key: Is not AesCryptoKey")}},{key:"generateKey",value:function(t,r,n){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function i(){var a;return _regeneratorRuntime().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return a=e.nativeCrypto.getRandomValues(new Uint8Array(t.length/8)),i.abrupt("return",new hi(t,r,n,a));case 2:case"end":return i.stop()}}),i)})))}},{key:"encrypt",value:function(e,t,r){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function n(){return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",this.cipher(e,t,s.toUint8Array(r),!0));case 1:case"end":return n.stop()}}),n,this)})))}},{key:"decrypt",value:function(e,t,r){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function n(){return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",this.cipher(e,t,s.toUint8Array(r),!1));case 1:case"end":return n.stop()}}),n,this)})))}},{key:"exportKey",value:function(e,t){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function r(){return _regeneratorRuntime().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:r.t0=e,r.next="jwk"===r.t0?3:"raw"===r.t0?4:5;break;case 3:return r.abrupt("return",t.toJSON());case 4:return r.abrupt("return",t.raw.buffer);case 5:throw new Fr("format: Must be 'jwk' or 'raw'");case 6:case"end":return r.stop()}}),r)})))}},{key:"importKey",value:function(e,t,r,n,i){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function e(){var a,o;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=Gr(t)?h.FromBase64Url(t.k):s.toArrayBuffer(t),e.t0=a.byteLength<<3,e.next=128===e.t0||192===e.t0||256===e.t0?4:5;break;case 4:return e.abrupt("break",6);case 5:throw new Fr("keyData: Is wrong key length");case 6:return o=new hi({name:r.name,length:a.byteLength<<3},n,i,new Uint8Array(a)),e.abrupt("return",o);case 8:case"end":return e.stop()}}),e)})))}},{key:"cipher",value:function(e,r,n,i){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function o(){var u,c,l,h,f,p;return _regeneratorRuntime().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(u=i?"encrypt":"decrypt",!li(e,t.AesCBC)){o.next=6;break}l=s.toUint8Array(e.iv),c=a.AES_CBC[u](n,r.raw,void 0,l),o.next=18;break;case 6:if(!li(e,t.AesGCM)){o.next=13;break}h=s.toUint8Array(e.iv),e.additionalData&&(f=s.toUint8Array(e.additionalData)),p=(e.tagLength||128)/8,c=a.AES_GCM[u](n,r.raw,h,f,p),o.next=18;break;case 13:if(!li(e,t.AesECB)){o.next=17;break}c=a.AES_ECB[u](n,r.raw,!0),o.next=18;break;case 17:throw new Fr("algorithm: Is not recognized");case 18:return o.abrupt("return",s.toArrayBuffer(c));case 19:case"end":return o.stop()}}),o)})))}}]),t}();fi.AesCBC="AES-CBC",fi.AesECB="AES-ECB",fi.AesGCM="AES-GCM";var pi=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,[{key:"onGenerateKey",value:function(e,t,r){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function n(){return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",fi.generateKey(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onEncrypt",value:function(e,t,r){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function n(){return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",fi.encrypt(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onDecrypt",value:function(e,t,r){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function n(){return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",fi.decrypt(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onExportKey",value:function(e,t){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function r(){return _regeneratorRuntime().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",fi.exportKey(e,t));case 1:case"end":return r.stop()}}),r)})))}},{key:"onImportKey",value:function(e,t,r,n,i){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function a(){return _regeneratorRuntime().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",fi.importKey(e,t,r,n,i));case 1:case"end":return a.stop()}}),a)})))}},{key:"checkCryptoKey",value:function(e,t){_get(_getPrototypeOf(r.prototype),"checkCryptoKey",this).call(this,e,t),fi.checkCryptoKey(e)}}]),r}(Wr),vi=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,[{key:"onGenerateKey",value:function(e,t,r){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function n(){return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",fi.generateKey(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onEncrypt",value:function(e,t,r){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function n(){return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",fi.encrypt(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onDecrypt",value:function(e,t,r){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function n(){return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",fi.decrypt(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onExportKey",value:function(e,t){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function r(){return _regeneratorRuntime().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",fi.exportKey(e,t));case 1:case"end":return r.stop()}}),r)})))}},{key:"onImportKey",value:function(e,t,r,n,i){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function a(){return _regeneratorRuntime().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",fi.importKey(e,t,r,n,i));case 1:case"end":return a.stop()}}),a)})))}},{key:"checkCryptoKey",value:function(e,t){_get(_getPrototypeOf(r.prototype),"checkCryptoKey",this).call(this,e,t),fi.checkCryptoKey(e)}}]),r}(Zr),yi=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,[{key:"onGenerateKey",value:function(e,t,r){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function n(){return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",fi.generateKey(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onEncrypt",value:function(e,t,r){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function n(){return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",fi.encrypt(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onDecrypt",value:function(e,t,r){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function n(){return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",fi.decrypt(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onExportKey",value:function(e,t){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function r(){return _regeneratorRuntime().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",fi.exportKey(e,t));case 1:case"end":return r.stop()}}),r)})))}},{key:"onImportKey",value:function(e,t,r,n,i){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function a(){return _regeneratorRuntime().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",fi.importKey(e,t,r,n,i));case 1:case"end":return a.stop()}}),a)})))}},{key:"checkCryptoKey",value:function(e,t){_get(_getPrototypeOf(r.prototype),"checkCryptoKey",this).call(this,e,t),fi.checkCryptoKey(e)}}]),r}($r),gi=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,[{key:"onEncrypt",value:function(e,t,r){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function n(){var i;return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return i=new a.AES_CTR(t.raw,s.toUint8Array(e.counter)).encrypt(s.toUint8Array(r)),n.abrupt("return",s.toArrayBuffer(i));case 2:case"end":return n.stop()}}),n)})))}},{key:"onDecrypt",value:function(e,t,r){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function n(){var i;return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return i=new a.AES_CTR(t.raw,s.toUint8Array(e.counter)).decrypt(s.toUint8Array(r)),n.abrupt("return",s.toArrayBuffer(i));case 2:case"end":return n.stop()}}),n)})))}},{key:"onGenerateKey",value:function(e,t,r){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function n(){return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",fi.generateKey(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onExportKey",value:function(e,t){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function r(){return _regeneratorRuntime().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",fi.exportKey(e,t));case 1:case"end":return r.stop()}}),r)})))}},{key:"onImportKey",value:function(e,t,r,n,i){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function a(){return _regeneratorRuntime().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",fi.importKey(e,t,r,n,i));case 1:case"end":return a.stop()}}),a)})))}},{key:"checkCryptoKey",value:function(e,t){_get(_getPrototypeOf(r.prototype),"checkCryptoKey",this).call(this,e,t),fi.checkCryptoKey(e)}}]),r}(Xr),di=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,[{key:"onEncrypt",value:function(e,t,r){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return e.stop()}}),e)})))}},{key:"onDecrypt",value:function(e,t,r){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return e.stop()}}),e)})))}},{key:"onGenerateKey",value:function(e,t,r){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return e.stop()}}),e)})))}},{key:"onExportKey",value:function(e,t){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return e.stop()}}),e)})))}},{key:"onImportKey",value:function(e,t,r,n,i){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return e.stop()}}),e)})))}},{key:"checkCryptoKey",value:function(e,t){_get(_getPrototypeOf(r.prototype),"checkCryptoKey",this).call(this,e,t),fi.checkCryptoKey(e)}}]),r}(Yr),mi=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,n,i,a,o){var u;return _classCallCheck(this,r),(u=t.call(this,e,n,i,a)).data=o,u}return _createClass(r)}(ci),ki=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"checkCryptoKey",value:function(e){if(!(e instanceof mi))throw new TypeError("key: Is not RsaCryptoKey")}},{key:"generateKey",value:function(t,r,n){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function i(){var a,o,u,s,c,l,h,f=this;return _regeneratorRuntime().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return a={name:"RSA-PSS",hash:"SHA-256",publicExponent:t.publicExponent,modulusLength:t.modulusLength},i.next=3,e.nativeSubtle.generateKey(a,!0,["sign","verify"]);case 3:return o=i.sent,u=new Ro,i.next=7,u.subtle.exportKey("pkcs8",o.privateKey);case 7:return s=i.sent,i.next=10,u.subtle.importKey("pkcs8",s,t,r,n.filter((function(e){return f.privateUsages.includes(e)})));case 10:return c=i.sent,i.next=13,u.subtle.exportKey("spki",o.publicKey);case 13:return l=i.sent,i.next=16,u.subtle.importKey("spki",l,t,!0,n.filter((function(e){return f.publicUsages.includes(e)})));case 16:return h=i.sent,i.abrupt("return",{privateKey:c,publicKey:h});case 18:case"end":return i.stop()}}),i)})))}},{key:"exportKey",value:function(e,t){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function r(){return _regeneratorRuntime().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:r.t0=e,r.next="pkcs8"===r.t0?3:"spki"===r.t0?4:"jwk"===r.t0?5:6;break;case 3:return r.abrupt("return",this.exportPkcs8Key(t));case 4:return r.abrupt("return",this.exportSpkiKey(t));case 5:return r.abrupt("return",this.exportJwkKey(t));case 6:throw new Fr("format: Must be 'jwk', 'pkcs8' or 'spki'");case 7:case"end":return r.stop()}}),r,this)})))}},{key:"importKey",value:function(e,t,r,n,i){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function a(){var o,u;return _regeneratorRuntime().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:a.t0=e,a.next="pkcs8"===a.t0?3:"spki"===a.t0?5:"jwk"===a.t0?7:9;break;case 3:return o=this.importPkcs8Key(t),a.abrupt("break",10);case 5:return o=this.importSpkiKey(t),a.abrupt("break",10);case 7:return o=this.importJwkKey(t),a.abrupt("break",10);case 9:throw new Fr("format: Must be 'jwk', 'pkcs8' or 'spki'");case 10:return u=new mi(Object.assign({publicExponent:1===o[1][1]?o[1].slice(1):o[1].slice(3),modulusLength:o[0].byteLength<<3},r),n,2===o.length?"public":"private",i,o),a.abrupt("return",u);case 12:case"end":return a.stop()}}),a,this)})))}},{key:"randomNonZeroValues",value:function(t){return(t=e.nativeCrypto.getRandomValues(t)).map((function(t){for(;!t;)t=e.nativeCrypto.getRandomValues(new Uint8Array(1))[0];return t}))}},{key:"exportPkcs8Key",value:function(e){var t=new Zn.PrivateKeyInfo;return t.privateKeyAlgorithm.algorithm="1.2.840.113549.1.1.1",t.privateKeyAlgorithm.parameters=null,t.privateKey=dr.serialize(this.exportAsmKey(e.data)),dr.serialize(t)}},{key:"importPkcs8Key",value:function(e){var t=dr.parse(e,Zn.PrivateKeyInfo),r=dr.parse(t.privateKey,Zn.RsaPrivateKey);return this.importAsmKey(r)}},{key:"importSpkiKey",value:function(e){var t=dr.parse(e,Zn.PublicKeyInfo),r=dr.parse(t.publicKey,Zn.RsaPublicKey);return this.importAsmKey(r)}},{key:"exportSpkiKey",value:function(e){var t=new Zn.RsaPublicKey;t.modulus=e.data[0].buffer,t.publicExponent=1===e.data[1][1]?e.data[1].buffer.slice(1):e.data[1].buffer.slice(3);var r=new Zn.PublicKeyInfo;return r.publicKeyAlgorithm.algorithm="1.2.840.113549.1.1.1",r.publicKeyAlgorithm.parameters=null,r.publicKey=dr.serialize(t),dr.serialize(r)}},{key:"importJwkKey",value:function(e){var t;return t=e.d?jr.fromJSON(e,{targetSchema:Zn.RsaPrivateKey}):jr.fromJSON(e,{targetSchema:Zn.RsaPublicKey}),this.importAsmKey(t)}},{key:"exportJwkKey",value:function(e){var t=this.exportAsmKey(e.data),r=Tr.toJSON(t);return r.ext=!0,r.key_ops=e.usages,r.kty="RSA",r.alg=this.getJwkAlgorithm(e.algorithm),r}},{key:"getJwkAlgorithm",value:function(e){switch(e.name.toUpperCase()){case"RSA-OAEP":var t=/(\d+)$/.exec(e.hash.name)[1];return"RSA-OAEP".concat("1"!==t?"-".concat(t):"");case"RSASSA-PKCS1-V1_5":return"RS".concat(/(\d+)$/.exec(e.hash.name)[1]);case"RSA-PSS":return"PS".concat(/(\d+)$/.exec(e.hash.name)[1]);case"RSAES-PKCS1-V1_5":return"PS1";default:throw new Fr("algorithm: Is not recognized")}}},{key:"exportAsmKey",value:function(e){var t;if(e.length>2){var r=new Zn.RsaPrivateKey;r.privateExponent=e[2].buffer,r.prime1=e[3].buffer,r.prime2=e[4].buffer,r.exponent1=e[5].buffer,r.exponent2=e[6].buffer,r.coefficient=e[7].buffer,t=r}else t=new Zn.RsaPublicKey;return t.modulus=e[0].buffer,t.publicExponent=1===e[1][1]?e[1].buffer.slice(1):e[1].buffer.slice(3),t}},{key:"importAsmKey",value:function(e){var t=new Uint8Array(4-e.publicExponent.byteLength),r=[new Uint8Array(e.modulus),si(t,new Uint8Array(e.publicExponent))];return e instanceof Zn.RsaPrivateKey&&(r.push(new Uint8Array(e.privateExponent)),r.push(new Uint8Array(e.prime1)),r.push(new Uint8Array(e.prime2)),r.push(new Uint8Array(e.exponent1)),r.push(new Uint8Array(e.exponent2)),r.push(new Uint8Array(e.coefficient))),r}}]),t}();ki.RsaSsa="RSASSA-PKCS1-v1_5",ki.RsaPss="RSA-PSS",ki.RsaOaep="RSA-OAEP",ki.privateUsages=["sign","decrypt","unwrapKey"],ki.publicUsages=["verify","encrypt","wrapKey"];var wi=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"getDigest",value:function(e){switch(e){case"SHA-1":return new a.Sha1;case"SHA-256":return new a.Sha256;case"SHA-512":return new a.Sha512;default:throw new Dr("keyAlgorithm.hash: Is not recognized")}}},{key:"digest",value:function(e,t){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function r(){var n,i;return _regeneratorRuntime().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=this.getDigest(e.name),i=n.process(s.toUint8Array(t)).finish().result,r.abrupt("return",s.toArrayBuffer(i));case 3:case"end":return r.stop()}}),r,this)})))}}]),e}(),bi=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,[{key:"onGenerateKey",value:function(e,t,r){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function n(){return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",ki.generateKey(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onExportKey",value:function(e,t){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function r(){return _regeneratorRuntime().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",ki.exportKey(e,t));case 1:case"end":return r.stop()}}),r)})))}},{key:"onImportKey",value:function(e,t,r,n,i){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function a(){return _regeneratorRuntime().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",ki.importKey(e,t,r,n,i));case 1:case"end":return a.stop()}}),a)})))}},{key:"onEncrypt",value:function(e,t,r){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function n(){return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",this.cipher(e,t,r));case 1:case"end":return n.stop()}}),n,this)})))}},{key:"onDecrypt",value:function(e,t,r){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function n(){return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",this.cipher(e,t,r));case 1:case"end":return n.stop()}}),n,this)})))}},{key:"checkCryptoKey",value:function(e,t){_get(_getPrototypeOf(r.prototype),"checkCryptoKey",this).call(this,e,t),ki.checkCryptoKey(e)}},{key:"cipher",value:function(e,t,r){var n,i=wi.getDigest(t.algorithm.hash.name);e.label&&(n=s.toUint8Array(e.label));var o,u=new a.RSA_OAEP(t.data,i,n),c=s.toUint8Array(r);return o="public"===t.type?u.encrypt(c):u.decrypt(c),s.toArrayBuffer(o)}}]),r}(nn),_i=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,[{key:"onGenerateKey",value:function(e,t,r){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function n(){return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",ki.generateKey(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onExportKey",value:function(e,t){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function r(){return _regeneratorRuntime().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",ki.exportKey(e,t));case 1:case"end":return r.stop()}}),r)})))}},{key:"onImportKey",value:function(e,t,r,n,i){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function a(){return _regeneratorRuntime().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",ki.importKey(e,t,r,n,i));case 1:case"end":return a.stop()}}),a)})))}},{key:"onSign",value:function(e,t,r){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function n(){var i,o;return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return i=new a.RSA_PSS(t.data,wi.getDigest(t.algorithm.hash.name),e.saltLength),o=i.sign(s.toUint8Array(r)),n.abrupt("return",s.toArrayBuffer(o));case 3:case"end":return n.stop()}}),n)})))}},{key:"onVerify",value:function(e,t,r,n){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function i(){var o;return _regeneratorRuntime().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:o=new a.RSA_PSS(t.data,wi.getDigest(t.algorithm.hash.name),e.saltLength),i.prev=1,o.verify(s.toUint8Array(r),s.toUint8Array(n)),i.next=8;break;case 5:return i.prev=5,i.t0=i.catch(1),i.abrupt("return",!1);case 8:return i.abrupt("return",!0);case 9:case"end":return i.stop()}}),i,null,[[1,5]])})))}},{key:"checkCryptoKey",value:function(e,t){_get(_getPrototypeOf(r.prototype),"checkCryptoKey",this).call(this,e,t),ki.checkCryptoKey(e)}}]),r}(rn),Ci=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,[{key:"onGenerateKey",value:function(e,t,r){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function n(){return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",ki.generateKey(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onExportKey",value:function(e,t){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function r(){return _regeneratorRuntime().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",ki.exportKey(e,t));case 1:case"end":return r.stop()}}),r)})))}},{key:"onImportKey",value:function(e,t,r,n,i){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function a(){return _regeneratorRuntime().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",ki.importKey(e,t,r,n,i));case 1:case"end":return a.stop()}}),a)})))}},{key:"onSign",value:function(e,t,r){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function e(){var n,i;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new a.RSA_PKCS1_v1_5(t.data,wi.getDigest(t.algorithm.hash.name)),i=n.sign(s.toUint8Array(r)),e.abrupt("return",s.toArrayBuffer(i));case 3:case"end":return e.stop()}}),e)})))}},{key:"onVerify",value:function(e,t,r,n){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function e(){var i;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=new a.RSA_PKCS1_v1_5(t.data,wi.getDigest(t.algorithm.hash.name)),e.prev=1,i.verify(s.toUint8Array(r),s.toUint8Array(n)),e.next=8;break;case 5:return e.prev=5,e.t0=e.catch(1),e.abrupt("return",!1);case 8:return e.abrupt("return",!0);case 9:case"end":return e.stop()}}),e,null,[[1,5]])})))}},{key:"checkCryptoKey",value:function(e,t){_get(_getPrototypeOf(r.prototype),"checkCryptoKey",this).call(this,e,t),ki.checkCryptoKey(e)}}]),r}(tn),Si=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).name="RSAES-PKCS1-v1_5",e.usages={publicKey:["encrypt","wrapKey"],privateKey:["decrypt","unwrapKey"]},e.hashAlgorithms=["SHA-1","SHA-256","SHA-384","SHA-512"],e}return _createClass(r,[{key:"onGenerateKey",value:function(e,t,r){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function n(){return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",ki.generateKey(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"checkGenerateKeyParams",value:function(e){if(this.checkRequiredProperty(e,"publicExponent"),!(e.publicExponent&&e.publicExponent instanceof Uint8Array))throw new TypeError("publicExponent: Missing or not a Uint8Array");var t=h.ToBase64(e.publicExponent);if("Aw=="!==t&&"AQAB"!==t)throw new TypeError("publicExponent: Must be [3] or [1,0,1]");switch(this.checkRequiredProperty(e,"modulusLength"),e.modulusLength){case 1024:case 2048:case 4096:break;default:throw new TypeError("modulusLength: Must be 1024, 2048, or 4096")}}},{key:"onDecrypt",value:function(e,t,r){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function e(){var n,i,o;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=new a.RSA(t.data).decrypt(new a.BigNumber(s.toUint8Array(r))).result,i=t.algorithm.modulusLength>>3,r.byteLength===i){e.next=4;break}throw new Vr("Decryption error. Encrypted message size doesn't match to key length");case 4:if(o=0,!n[o++]&&2===n[o++]){e.next=7;break}throw new Vr("Decryption error");case 7:if(0!==n[o++]){e.next=9;break}return e.abrupt("break",10);case 9:if(o<n.length){e.next=7;break}case 10:if(!(o<11)){e.next=12;break}throw new Vr("Decryption error. PS is less than 8 octets.");case 12:if(o!==n.length){e.next=14;break}throw new Vr("Decryption error. There is no octet with hexadecimal value 0x00 to separate PS from M");case 14:return e.abrupt("return",n.buffer.slice(o));case 15:case"end":return e.stop()}}),e)})))}},{key:"onEncrypt",value:function(e,t,r){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function e(){var n,i,o,u,c;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.algorithm.modulusLength>>3,!(r.byteLength>n-11)){e.next=3;break}throw new Vr("Message too long");case 3:return i=n-r.byteLength-3,o=ki.randomNonZeroValues(new Uint8Array(i)),(u=new Uint8Array(n))[0]=0,u[1]=2,u.set(o,2),u[2+i]=0,u.set(new Uint8Array(r),3+i),c=new a.RSA(t.data).encrypt(new a.BigNumber(u)).result,e.abrupt("return",s.toArrayBuffer(c));case 13:case"end":return e.stop()}}),e)})))}},{key:"onExportKey",value:function(e,t){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function r(){return _regeneratorRuntime().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",ki.exportKey(e,t));case 1:case"end":return r.stop()}}),r)})))}},{key:"onImportKey",value:function(e,t,r,n,i){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function a(){var o;return _regeneratorRuntime().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,ki.importKey(e,t,Object.assign(Object.assign({},r),{name:this.name}),n,i);case 2:return o=a.sent,a.abrupt("return",o);case 4:case"end":return a.stop()}}),a,this)})))}},{key:"checkCryptoKey",value:function(e,t){_get(_getPrototypeOf(r.prototype),"checkCryptoKey",this).call(this,e,t),ki.checkCryptoKey(e)}},{key:"prepareSignData",value:function(e,t){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function r(){var n;return _regeneratorRuntime().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=new Ro,r.abrupt("return",n.subtle.digest(e.hash,t));case 2:case"end":return r.stop()}}),r)})))}}]),r}(zr),Ai={"1.2.840.10045.3.1.7":"P-256","P-256":"1.2.840.10045.3.1.7","1.3.132.0.34":"P-384","P-384":"1.3.132.0.34","1.3.132.0.35":"P-521","P-521":"1.3.132.0.35","1.3.132.0.10":"K-256","K-256":"1.3.132.0.10","1.3.36.3.3.2.8.1.1.7":"brainpoolP256r1",brainpoolP256r1:"1.3.36.3.3.2.8.1.1.7","1.3.36.3.3.2.8.1.1.11":"brainpoolP384r1",brainpoolP384r1:"1.3.36.3.3.2.8.1.1.11","1.3.36.3.3.2.8.1.1.13":"brainpoolP512r1",brainpoolP512r1:"1.3.36.3.3.2.8.1.1.13"};function xi(e){var t=Ai[e];if(!t)throw new Fr("Cannot convert WebCrypto named curve '".concat(e,"' to OID"));return t}var Bi=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,n,i,a,o){var u;return _classCallCheck(this,r),(u=t.call(this,e,n,i,a)).data=o,u}return _createClass(r)}(ci),Ei=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"checkLib",value:function(){if(void 0===o)throw new Fr("Cannot implement EC mechanism. Add 'https://peculiarventures.github.io/pv-webcrypto-tests/src/elliptic.js' script to your project")}},{key:"generateKey",value:function(e,t,r){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function n(){var i,a,o,u,s=this;return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return this.checkLib(),i=this.initEcKey(e.namedCurve),(a=i.genKeyPair()).getPublic(),o=new Bi(Object.assign({},e),t,"private",r.filter((function(e){return~s.privateUsages.indexOf(e)})),a),u=new Bi(Object.assign({},e),!0,"public",r.filter((function(e){return~s.publicUsages.indexOf(e)})),a),n.abrupt("return",{privateKey:o,publicKey:u});case 7:case"end":return n.stop()}}),n,this)})))}},{key:"checkCryptoKey",value:function(e){if(!(e instanceof Bi))throw new TypeError("key: Is not EcCryptoKey")}},{key:"concat",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=new Uint8Array(t.map((function(e){return e.length})).reduce((function(e,t){return e+t}))),i=0;return t.forEach((function(e,t){for(var r=0;r<e.length;r++)n[i+r]=e[r];i+=e.length})),n}},{key:"exportKey",value:function(e,t){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function r(){return _regeneratorRuntime().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:this.checkLib(),r.t0=e,r.next="pkcs8"===r.t0?4:"spki"===r.t0?5:"jwk"===r.t0?6:"raw"===r.t0?7:8;break;case 4:return r.abrupt("return",this.exportPkcs8Key(t));case 5:return r.abrupt("return",this.exportSpkiKey(t));case 6:return r.abrupt("return",this.exportJwkKey(t));case 7:return r.abrupt("return",new Uint8Array(t.data.getPublic("der")).buffer);case 8:throw new Fr("format: Must be 'jwk', 'raw, 'pkcs8' or 'spki'");case 9:case"end":return r.stop()}}),r,this)})))}},{key:"importKey",value:function(e,t,r,n,i){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function a(){var o,u;return _regeneratorRuntime().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:this.checkLib(),a.t0=e,a.next="pkcs8"===a.t0?4:"spki"===a.t0?6:"raw"===a.t0?8:"jwk"===a.t0?10:12;break;case 4:return o=this.importPkcs8Key(t,r.namedCurve),a.abrupt("break",13);case 6:return o=this.importSpkiKey(t,r.namedCurve),a.abrupt("break",13);case 8:return o=this.importEcKey(new Zn.EcPublicKey(t),r.namedCurve),a.abrupt("break",13);case 10:return o=this.importJwkKey(t),a.abrupt("break",13);case 12:throw new Fr("format: Must be 'jwk', 'raw', 'pkcs8' or 'spki'");case 13:return u=new Bi(Object.assign({},r),n,o.priv?"private":"public",i,o),a.abrupt("return",u);case 15:case"end":return a.stop()}}),a,this)})))}},{key:"getNamedCurve",value:function(e){var t=e.toUpperCase(),r="";if(["P-256","P-384","P-521"].indexOf(t)>-1)r=t.replace("-","").toLowerCase();else if("K-256"===t)r="secp256k1";else{if(!["brainpoolP256r1","brainpoolP384r1","brainpoolP512r1"].includes(e))throw new Fr("Unsupported named curve '".concat(e,"'"));r=e}return r}},{key:"initEcKey",value:function(e){return o.ec(this.getNamedCurve(e))}},{key:"exportPkcs8Key",value:function(e){var t=new Zn.PrivateKeyInfo;return t.privateKeyAlgorithm.algorithm=this.ASN_ALGORITHM,t.privateKeyAlgorithm.parameters=dr.serialize(new Zn.ObjectIdentifier(xi(e.algorithm.namedCurve))),t.privateKey=dr.serialize(this.exportEcKey(e)),dr.serialize(t)}},{key:"importPkcs8Key",value:function(e,t){var r=dr.parse(e,Zn.PrivateKeyInfo),n=dr.parse(r.privateKey,Zn.EcPrivateKey);return this.importEcKey(n,t)}},{key:"importSpkiKey",value:function(e,t){var r=dr.parse(e,Zn.PublicKeyInfo),n=new Zn.EcPublicKey(r.publicKey);return this.importEcKey(n,t)}},{key:"exportSpkiKey",value:function(e){var t=new Zn.EcPublicKey(new Uint8Array(e.data.getPublic("der")).buffer),r=new Zn.PublicKeyInfo;return r.publicKeyAlgorithm.algorithm=this.ASN_ALGORITHM,r.publicKeyAlgorithm.parameters=dr.serialize(new Zn.ObjectIdentifier(xi(e.algorithm.namedCurve))),r.publicKey=t.value,dr.serialize(r)}},{key:"importJwkKey",value:function(e){var t;return t=e.d?jr.fromJSON(e,{targetSchema:Zn.EcPrivateKey}):jr.fromJSON(e,{targetSchema:Zn.EcPublicKey}),this.importEcKey(t,e.crv)}},{key:"exportJwkKey",value:function(e){var t=this.exportEcKey(e),r=Tr.toJSON(t);return r.ext=!0,r.key_ops=e.usages,r.crv=e.algorithm.namedCurve,r.kty="EC",r}},{key:"exportEcKey",value:function(e){if("private"===e.type){var t=new Zn.EcPrivateKey,r=new Uint8Array(e.data.getPrivate("der").toArray()),n=new Uint8Array(this.getPointSize(e.algorithm.namedCurve)-r.length);return t.privateKey=si(n,r),t.publicKey=new Uint8Array(e.data.getPublic("der")),t}if(e.data.pub)return new Zn.EcPublicKey(new Uint8Array(e.data.getPublic("der")).buffer);throw new Error("Cannot get private or public key")}},{key:"importEcKey",value:function(e,t){var r=this.initEcKey(t);return e instanceof Zn.EcPublicKey?r.keyFromPublic(new Uint8Array(e.value)):r.keyFromPrivate(new Uint8Array(e.privateKey))}},{key:"getPointSize",value:function(e){switch(e){case"P-256":case"K-256":return 32;case"P-384":return 48;case"P-521":return 66}throw new Error("namedCurve: Is not recognized")}}]),e}();Ei.privateUsages=["sign","deriveKey","deriveBits"],Ei.publicUsages=["verify"],Ei.ASN_ALGORITHM="1.2.840.10045.2.1";var Ri=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).namedCurves=["P-256","P-384","P-521","K-256","brainpoolP256r1","brainpoolP384r1","brainpoolP512r1"],e}return _createClass(r,[{key:"onGenerateKey",value:function(e,t,r){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function n(){return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",Ei.generateKey(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onExportKey",value:function(e,t){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function r(){return _regeneratorRuntime().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",Ei.exportKey(e,t));case 1:case"end":return r.stop()}}),r)})))}},{key:"onImportKey",value:function(e,t,r,n,i){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function a(){return _regeneratorRuntime().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",Ei.importKey(e,t,r,n,i));case 1:case"end":return a.stop()}}),a)})))}},{key:"onDeriveBits",value:function(e,t,r){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function n(){var i,a,o,u;return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return Ei.checkLib(),i=t.data.derive(e.public.data.getPublic()),a=new Uint8Array(i.toArray()),o=(o=a.length)>32?o>48?66:48:32,a.length<o&&(a=Ei.concat(new Uint8Array(o-a.length),a)),u=a.slice(0,r/8).buffer,n.abrupt("return",u);case 8:case"end":return n.stop()}}),n)})))}},{key:"checkCryptoKey",value:function(e,t){_get(_getPrototypeOf(r.prototype),"checkCryptoKey",this).call(this,e,t),Ei.checkCryptoKey(e)}}]),r}(cn);function Ki(e){for(var t=new Uint8Array(e),r=[],n=0;n<t.length;n++)r.push(t[n]);return r}var Oi=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).hashAlgorithms=["SHA-1","SHA-256","SHA-384","SHA-512","SHA3-256","SHA3-384","SHA3-512"],e.namedCurves=["P-256","P-384","P-521","K-256","brainpoolP256r1","brainpoolP384r1","brainpoolP512r1"],e}return _createClass(r,[{key:"onGenerateKey",value:function(e,t,r){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function n(){return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",Ei.generateKey(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onExportKey",value:function(e,t){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function r(){return _regeneratorRuntime().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",Ei.exportKey(e,t));case 1:case"end":return r.stop()}}),r)})))}},{key:"onImportKey",value:function(e,t,r,n,i){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function a(){return _regeneratorRuntime().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",Ei.importKey(e,t,r,n,i));case 1:case"end":return a.stop()}}),a)})))}},{key:"onSign",value:function(e,t,r){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function n(){var i,a,o,u,s;return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return Ei.checkLib(),i=new Ro,n.next=4,i.subtle.digest(e.hash,r);case 4:return o=n.sent,a=Ki(o),n.next=8,t.data.sign(a);case 8:return u=n.sent,(s=new Zn.EcDsaSignature).r=new Uint8Array(u.r.toArray()).buffer,s.s=new Uint8Array(u.s.toArray()).buffer,n.abrupt("return",s.toWebCryptoSignature());case 13:case"end":return n.stop()}}),n)})))}},{key:"onVerify",value:function(e,t,r,n){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function i(){var a,o,u,s;return _regeneratorRuntime().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return Ei.checkLib(),a=new Ro,o={r:new Uint8Array(r.slice(0,r.byteLength/2)),s:new Uint8Array(r.slice(r.byteLength/2))},i.next=5,a.subtle.digest(e.hash,n);case 5:return u=i.sent,s=Ki(u),i.abrupt("return",t.data.verify(s,o));case 8:case"end":return i.stop()}}),i)})))}},{key:"checkCryptoKey",value:function(e,t){_get(_getPrototypeOf(r.prototype),"checkCryptoKey",this).call(this,e,t),Ei.checkCryptoKey(e)}}]),r}(on),Ni=(_defineProperty(n={},Zn.idEd448,"Ed448"),_defineProperty(n,"ed448",Zn.idEd448),_defineProperty(n,Zn.idX448,"X448"),_defineProperty(n,"x448",Zn.idX448),_defineProperty(n,Zn.idEd25519,"Ed25519"),_defineProperty(n,"ed25519",Zn.idEd25519),_defineProperty(n,Zn.idX25519,"X25519"),_defineProperty(n,"x25519",Zn.idX25519),n);function Pi(e){var t=Ni[e.toLowerCase()];if(!t)throw new Fr("Cannot convert WebCrypto named curve '".concat(e,"' to OID"));return t}var Ui=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,n,i,a){var o;return _classCallCheck(this,r),(o=t.call(this,e,n,"private",i)).data=a,o}return _createClass(r,[{key:"toJSON",value:function(){var e={kty:"OKP",crv:this.algorithm.namedCurve,key_ops:this.usages,ext:this.extractable};return Object.assign(e,{d:h.ToBase64Url(h.FromHex(/^ed/i.test(e.crv)?this.data.getSecret("hex"):this.data.getPrivate("hex")))})}},{key:"fromJSON",value:function(e){if(!e.d)throw new Fr("Cannot get private data from JWK. Property 'd' is required");if(!e.crv)throw new Fr("Cannot get named curve from JWK. Property 'crv' is required");var t=h.ToHex(h.FromBase64Url(e.d)),r=new o.eddsa("ed25519");return this.data=r.keyFromSecret(t),this}}]),r}(ci),Ii=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,n,i,a){var o;return _classCallCheck(this,r),(o=t.call(this,e,n,"public",i)).data=a,o}return _createClass(r,[{key:"toJSON",value:function(){var e={kty:"OKP",crv:this.algorithm.namedCurve,key_ops:this.usages,ext:this.extractable};return Object.assign(e,{x:h.ToBase64Url(h.FromHex(this.data.getPublic("hex")))})}},{key:"fromJSON",value:function(e){if(!e.crv)throw new Fr("Cannot get named curve from JWK. Property 'crv' is required");if(!e.x)throw new Fr("Cannot get property from JWK. Property 'x' is required");var t=h.ToHex(h.FromBase64Url(e.x));if(/^ed/i.test(e.crv)){var r=new o.eddsa(e.crv.toLowerCase());this.data=r.keyFromPublic(t,"hex")}else{var n=o.ec(e.crv.replace(/^x/i,"curve"));this.data=n.keyFromPublic(t,"hex")}return this}}]),r}(ci),Li=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"checkLib",value:function(){if(void 0===o)throw new Fr("Cannot implement EC mechanism. Add 'https://peculiarventures.github.io/pv-webcrypto-tests/src/elliptic.js' script to your project")}},{key:"concat",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=new Uint8Array(t.map((function(e){return e.length})).reduce((function(e,t){return e+t}))),i=0;return t.forEach((function(e,t){for(var r=0;r<e.length;r++)n[i+r]=e[r];i+=e.length})),n}},{key:"generateKey",value:function(t,r,n){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function i(){var a,u,s,c,l,h=this;return _regeneratorRuntime().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return this.checkLib(),"ed25519",u=e.nativeCrypto.getRandomValues(new Uint8Array(32)),s=new o.eddsa("ed25519"),a=s.keyFromSecret(u),c=new Ui(t,r,n.filter((function(e){return-1!==h.privateKeyUsages.indexOf(e)})),a),l=new Ii(t,!0,n.filter((function(e){return-1!==h.publicKeyUsages.indexOf(e)})),a),i.abrupt("return",{privateKey:c,publicKey:l});case 8:case"end":return i.stop()}}),i,this)})))}},{key:"sign",value:function(e,t,r){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function e(){var n,i;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.checkLib(),n=Ki(r),i=t.data.sign(n).toHex(),e.abrupt("return",h.FromHex(i));case 4:case"end":return e.stop()}}),e,this)})))}},{key:"verify",value:function(e,t,r,n){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function e(){var i,a;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.checkLib(),i=Ki(n),a=t.data.verify(i,h.ToHex(r)),e.abrupt("return",a);case 4:case"end":return e.stop()}}),e,this)})))}},{key:"deriveBits",value:function(e,r,n){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function i(){var a,u,s,c,l,f,p,v,y;return _regeneratorRuntime().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return this.checkLib(),a=new Uint8Array(h.FromHex(r.data.getSecret("hex"))),u=new o.ec("curve25519"),s=u.keyFromPrivate(h.ToHex(a),"hex"),c=e.public.data.getPublic("hex"),new Uint8Array(h.FromHex(c)),l=e.public.data.getPublic(),f=s.derive(l),p=new Uint8Array(f.toArray()),v=(v=p.length)>32?v>48?66:48:32,p.length<v&&(p=t.concat(new Uint8Array(v-p.length),p)),y=p.slice(0,n/8).buffer,i.abrupt("return",y);case 14:case"end":return i.stop()}}),i,this)})))}},{key:"exportKey",value:function(e,t){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function r(){var n,i,a,o;return _regeneratorRuntime().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:this.checkLib(),r.t0=e.toLowerCase(),r.next="jwk"===r.t0?4:"pkcs8"===r.t0?5:"spki"===r.t0?10:"raw"===r.t0?15:16;break;case 4:return r.abrupt("return",Tr.toJSON(t));case 5:return n=h.FromHex(t.data.getSecret("hex")),(i=new Zn.PrivateKeyInfo).privateKeyAlgorithm.algorithm=Pi(t.algorithm.namedCurve),i.privateKey=dr.serialize(new Lt(n)),r.abrupt("return",dr.serialize(i));case 10:return a=h.FromHex(t.data.getPublic("hex")),(o=new Zn.PublicKeyInfo).publicKeyAlgorithm.algorithm=Pi(t.algorithm.namedCurve),o.publicKey=a,r.abrupt("return",dr.serialize(o));case 15:return r.abrupt("return",h.FromHex(t.data.getPublic("hex")));case 16:throw new Fr("format: Must be 'jwk', 'raw', pkcs8' or 'spki'");case 17:case"end":return r.stop()}}),r,this)})))}},{key:"importKey",value:function(e,t,r,n,i){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function a(){var o,u,s,c,l;return _regeneratorRuntime().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:this.checkLib(),a.t0=e.toLowerCase(),a.next="jwk"===a.t0?4:"raw"===a.t0?13:"spki"===a.t0?14:"pkcs8"===a.t0?16:19;break;case 4:if(!(o=t).d){a.next=10;break}return u=jr.fromJSON(t,{targetSchema:Zn.CurvePrivateKey}),a.abrupt("return",this.importPrivateKey(u,r,n,i));case 10:if(o.x){a.next=12;break}throw new TypeError("keyData: Cannot get required 'x' field");case 12:return a.abrupt("return",this.importPublicKey(h.FromBase64Url(o.x),r,n,i));case 13:return a.abrupt("return",this.importPublicKey(t,r,n,i));case 14:return s=dr.parse(new Uint8Array(t),Zn.PublicKeyInfo),a.abrupt("return",this.importPublicKey(s.publicKey,r,n,i));case 16:return c=dr.parse(new Uint8Array(t),Zn.PrivateKeyInfo),l=dr.parse(c.privateKey,Zn.CurvePrivateKey),a.abrupt("return",this.importPrivateKey(l,r,n,i));case 19:throw new Fr("format: Must be 'jwk', 'raw', 'pkcs8' or 'spki'");case 20:case"end":return a.stop()}}),a,this)})))}},{key:"importPrivateKey",value:function(e,t,r,n){var i=new Ui(Object.assign({},t),r,n,null);return i.fromJSON({crv:t.namedCurve,d:h.ToBase64Url(e.d)}),i}},{key:"importPublicKey",value:function(e,t,r,n){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function i(){var a;return _regeneratorRuntime().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return(a=new Ii(Object.assign({},t),r,n,null)).fromJSON({crv:t.namedCurve,x:h.ToBase64Url(e)}),i.abrupt("return",a);case 3:case"end":return i.stop()}}),i)})))}}]),t}();Li.publicKeyUsages=["verify"],Li.privateKeyUsages=["sign","deriveKey","deriveBits"];var Ti=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).namedCurves=["Ed25519"],e}return _createClass(r,[{key:"onGenerateKey",value:function(e,t,r){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function n(){var i;return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Li.generateKey({name:this.name,namedCurve:e.namedCurve.replace(/^ed/i,"Ed")},t,r);case 2:return i=n.sent,n.abrupt("return",i);case 4:case"end":return n.stop()}}),n,this)})))}},{key:"onSign",value:function(e,t,r){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function n(){return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",Li.sign(e,t,new Uint8Array(r)));case 1:case"end":return n.stop()}}),n)})))}},{key:"onVerify",value:function(e,t,r,n){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function i(){return _regeneratorRuntime().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",Li.verify(e,t,new Uint8Array(r),new Uint8Array(n)));case 1:case"end":return i.stop()}}),i)})))}},{key:"onExportKey",value:function(e,t){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function r(){return _regeneratorRuntime().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",Li.exportKey(e,t));case 1:case"end":return r.stop()}}),r)})))}},{key:"onImportKey",value:function(e,t,r,n,i){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function a(){var o;return _regeneratorRuntime().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,Li.importKey(e,t,Object.assign(Object.assign({},r),{name:this.name}),n,i);case 2:return o=a.sent,a.abrupt("return",o);case 4:case"end":return a.stop()}}),a,this)})))}}]),r}(hn),ji=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).namedCurves=["X25519"],e}return _createClass(r,[{key:"onGenerateKey",value:function(e,t,r){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function n(){var i;return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Li.generateKey({name:this.name,namedCurve:e.namedCurve.replace(/^x/i,"X")},t,r);case 2:return i=n.sent,n.abrupt("return",i);case 4:case"end":return n.stop()}}),n,this)})))}},{key:"onDeriveBits",value:function(e,t,r){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function n(){var i;return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Li.deriveBits(Object.assign(Object.assign({},e),{public:e.public}),t,r);case 2:return i=n.sent,n.abrupt("return",i);case 4:case"end":return n.stop()}}),n)})))}},{key:"onExportKey",value:function(e,t){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function r(){return _regeneratorRuntime().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",Li.exportKey(e,t));case 1:case"end":return r.stop()}}),r)})))}},{key:"onImportKey",value:function(e,t,r,n,i){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function a(){var o;return _regeneratorRuntime().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,Li.importKey(e,t,Object.assign(Object.assign({},r),{name:this.name}),n,i);case 2:return o=a.sent,a.abrupt("return",o);case 4:case"end":return a.stop()}}),a,this)})))}}]),r}(ln),Hi=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).name="SHA-1",e.usages=[],e}return _createClass(r,[{key:"onDigest",value:function(e,t){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function r(){return _regeneratorRuntime().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",wi.digest(e,t));case 1:case"end":return r.stop()}}),r)})))}}]),r}(zr),Vi=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).name="SHA-256",e}return _createClass(r)}(Hi),Di=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).name="SHA-512",e}return _createClass(r)}(Hi),Mi="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},Fi={},Ji={},Gi={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.mul=Math.imul||function(e,t){var r=65535&e,n=65535&t;return r*n+((e>>>16&65535)*n+r*(t>>>16&65535)<<16>>>0)|0},e.add=function(e,t){return e+t|0},e.sub=function(e,t){return e-t|0},e.rotl=function(e,t){return e<<t|e>>>32-t},e.rotr=function(e,t){return e<<32-t|e>>>t},e.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},e.MAX_SAFE_INTEGER=9007199254740991,e.isSafeInteger=function(t){return e.isInteger(t)&&t>=-e.MAX_SAFE_INTEGER&&t<=e.MAX_SAFE_INTEGER}}(Gi),Object.defineProperty(Ji,"__esModule",{value:!0});var zi=Gi;function qi(e,t,r){return void 0===t&&(t=new Uint8Array(2)),void 0===r&&(r=0),t[r+0]=e>>>8,t[r+1]=e>>>0,t}function Wi(e,t,r){return void 0===t&&(t=new Uint8Array(2)),void 0===r&&(r=0),t[r+0]=e>>>0,t[r+1]=e>>>8,t}function Xi(e,t){return void 0===t&&(t=0),e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}function Zi(e,t){return void 0===t&&(t=0),(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}function $i(e,t){return void 0===t&&(t=0),e[t+3]<<24|e[t+2]<<16|e[t+1]<<8|e[t]}function Yi(e,t){return void 0===t&&(t=0),(e[t+3]<<24|e[t+2]<<16|e[t+1]<<8|e[t])>>>0}function Qi(e,t,r){return void 0===t&&(t=new Uint8Array(4)),void 0===r&&(r=0),t[r+0]=e>>>24,t[r+1]=e>>>16,t[r+2]=e>>>8,t[r+3]=e>>>0,t}function ea(e,t,r){return void 0===t&&(t=new Uint8Array(4)),void 0===r&&(r=0),t[r+0]=e>>>0,t[r+1]=e>>>8,t[r+2]=e>>>16,t[r+3]=e>>>24,t}function ta(e,t,r){return void 0===t&&(t=new Uint8Array(8)),void 0===r&&(r=0),Qi(e/4294967296>>>0,t,r),Qi(e>>>0,t,r+4),t}function ra(e,t,r){return void 0===t&&(t=new Uint8Array(8)),void 0===r&&(r=0),ea(e>>>0,t,r),ea(e/4294967296>>>0,t,r+4),t}Ji.readInt16BE=function(e,t){return void 0===t&&(t=0),(e[t+0]<<8|e[t+1])<<16>>16},Ji.readUint16BE=function(e,t){return void 0===t&&(t=0),(e[t+0]<<8|e[t+1])>>>0},Ji.readInt16LE=function(e,t){return void 0===t&&(t=0),(e[t+1]<<8|e[t])<<16>>16},Ji.readUint16LE=function(e,t){return void 0===t&&(t=0),(e[t+1]<<8|e[t])>>>0},Ji.writeUint16BE=qi,Ji.writeInt16BE=qi,Ji.writeUint16LE=Wi,Ji.writeInt16LE=Wi,Ji.readInt32BE=Xi,Ji.readUint32BE=Zi,Ji.readInt32LE=$i,Ji.readUint32LE=Yi,Ji.writeUint32BE=Qi,Ji.writeInt32BE=Qi,Ji.writeUint32LE=ea,Ji.writeInt32LE=ea,Ji.readInt64BE=function(e,t){void 0===t&&(t=0);var r=Xi(e,t),n=Xi(e,t+4);return 4294967296*r+n-4294967296*(n>>31)},Ji.readUint64BE=function(e,t){return void 0===t&&(t=0),4294967296*Zi(e,t)+Zi(e,t+4)},Ji.readInt64LE=function(e,t){void 0===t&&(t=0);var r=$i(e,t);return 4294967296*$i(e,t+4)+r-4294967296*(r>>31)},Ji.readUint64LE=function(e,t){void 0===t&&(t=0);var r=Yi(e,t);return 4294967296*Yi(e,t+4)+r},Ji.writeUint64BE=ta,Ji.writeInt64BE=ta,Ji.writeUint64LE=ra,Ji.writeInt64LE=ra,Ji.readUintBE=function(e,t,r){if(void 0===r&&(r=0),e%8!=0)throw new Error("readUintBE supports only bitLengths divisible by 8");if(e/8>t.length-r)throw new Error("readUintBE: array is too short for the given bitLength");for(var n=0,i=1,a=e/8+r-1;a>=r;a--)n+=t[a]*i,i*=256;return n},Ji.readUintLE=function(e,t,r){if(void 0===r&&(r=0),e%8!=0)throw new Error("readUintLE supports only bitLengths divisible by 8");if(e/8>t.length-r)throw new Error("readUintLE: array is too short for the given bitLength");for(var n=0,i=1,a=r;a<r+e/8;a++)n+=t[a]*i,i*=256;return n},Ji.writeUintBE=function(e,t,r,n){if(void 0===r&&(r=new Uint8Array(e/8)),void 0===n&&(n=0),e%8!=0)throw new Error("writeUintBE supports only bitLengths divisible by 8");if(!zi.isSafeInteger(t))throw new Error("writeUintBE value must be an integer");for(var i=1,a=e/8+n-1;a>=n;a--)r[a]=t/i&255,i*=256;return r},Ji.writeUintLE=function(e,t,r,n){if(void 0===r&&(r=new Uint8Array(e/8)),void 0===n&&(n=0),e%8!=0)throw new Error("writeUintLE supports only bitLengths divisible by 8");if(!zi.isSafeInteger(t))throw new Error("writeUintLE value must be an integer");for(var i=1,a=n;a<n+e/8;a++)r[a]=t/i&255,i*=256;return r},Ji.readFloat32BE=function(e,t){return void 0===t&&(t=0),new DataView(e.buffer,e.byteOffset,e.byteLength).getFloat32(t)},Ji.readFloat32LE=function(e,t){return void 0===t&&(t=0),new DataView(e.buffer,e.byteOffset,e.byteLength).getFloat32(t,!0)},Ji.readFloat64BE=function(e,t){return void 0===t&&(t=0),new DataView(e.buffer,e.byteOffset,e.byteLength).getFloat64(t)},Ji.readFloat64LE=function(e,t){return void 0===t&&(t=0),new DataView(e.buffer,e.byteOffset,e.byteLength).getFloat64(t,!0)},Ji.writeFloat32BE=function(e,t,r){return void 0===t&&(t=new Uint8Array(4)),void 0===r&&(r=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setFloat32(r,e),t},Ji.writeFloat32LE=function(e,t,r){return void 0===t&&(t=new Uint8Array(4)),void 0===r&&(r=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setFloat32(r,e,!0),t},Ji.writeFloat64BE=function(e,t,r){return void 0===t&&(t=new Uint8Array(8)),void 0===r&&(r=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setFloat64(r,e),t},Ji.writeFloat64LE=function(e,t,r){return void 0===t&&(t=new Uint8Array(8)),void 0===r&&(r=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setFloat64(r,e,!0),t};var na={};Object.defineProperty(na,"__esModule",{value:!0}),na.wipe=function(e){for(var t=0;t<e.length;t++)e[t]=0;return e};var ia,aa=Mi&&Mi.__extends||(ia=function(e,t){return ia=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},ia(e,t)},function(e,t){function r(){this.constructor=e}ia(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(Fi,"__esModule",{value:!0});var oa=Ji,ua=na,sa=function(){function e(e){if(void 0===e&&(e=32),this.capacity=e,this._sh=new Int32Array(25),this._sl=new Int32Array(25),this._state=new Uint8Array(200),this._pos=0,this._finished=!1,this.clean=this.reset,e<=0||e>128)throw new Error("SHA3: incorrect capacity");this.blockSize=200-e}return e.prototype.reset=function(){return ua.wipe(this._sh),ua.wipe(this._sl),ua.wipe(this._state),this._pos=0,this._finished=!1,this},e.prototype.update=function(e){if(this._finished)throw new Error("SHA3: can't update because hash was finished");for(var t=0;t<e.length;t++)this._state[this._pos++]^=e[t],this._pos>=this.blockSize&&(Aa(this._sh,this._sl,this._state),this._pos=0);return this},e.prototype._padAndPermute=function(e){this._state[this._pos]^=e,this._state[this.blockSize-1]^=128,Aa(this._sh,this._sl,this._state),this._finished=!0,this._pos=0},e.prototype._squeeze=function(e){if(!this._finished)throw new Error("SHA3: squeezing before padAndPermute");for(var t=0;t<e.length;t++)this._pos===this.blockSize&&(Aa(this._sh,this._sl,this._state),this._pos=0),e[t]=this._state[this._pos++]},e}();Fi.Keccak=sa;var ca=function(e){function t(t){void 0===t&&(t=32);var r=e.call(this,2*t)||this;return r.digestLength=t,r}return aa(t,e),t.prototype.finish=function(e){return this._finished?this._pos=0:this._padAndPermute(6),this._squeeze(e),this},t.prototype.digest=function(){var e=new Uint8Array(this.digestLength);return this.finish(e),e},t.prototype.saveState=function(){if(this._finished)throw new Error("SHA3: cannot save finished state");return new Uint8Array(this._state.subarray(0,this._pos))},t.prototype.restoreState=function(e){return this._state.set(e),this._pos=e.length,this._finished=!1,this},t.prototype.cleanSavedState=function(e){ua.wipe(e)},t}(sa);Fi.SHA3=ca;var la=function(e){function t(){return e.call(this,28)||this}return aa(t,e),t}(ca);Fi.SHA3224=la;var ha=function(e){function t(){return e.call(this,32)||this}return aa(t,e),t}(ca);Fi.SHA3256=ha;var fa=function(e){function t(){return e.call(this,48)||this}return aa(t,e),t}(ca);Fi.SHA3384=fa;var pa=function(e){function t(){return e.call(this,64)||this}return aa(t,e),t}(ca);function va(e,t){var r=new ca(e);r.update(t);var n=r.digest();return r.clean(),n}Fi.SHA3512=pa,Fi.hash=va,Fi.hash224=function(e){return va(28,e)};var ya=Fi.hash256=function(e){return va(32,e)},ga=Fi.hash384=function(e){return va(48,e)},da=Fi.hash512=function(e){return va(64,e)},ma=function(e){function t(t){var r=e.call(this,t/8*2)||this;return r.bitSize=t,r}return aa(t,e),t.prototype.stream=function(e){this._finished||this._padAndPermute(31),this._squeeze(e)},t}(sa);Fi.SHAKE=ma;var ka=function(e){function t(){return e.call(this,128)||this}return aa(t,e),t}(ma),wa=Fi.SHAKE128=ka,ba=function(e){function t(){return e.call(this,256)||this}return aa(t,e),t}(ma),_a=Fi.SHAKE256=ba,Ca=new Int32Array([0,0,2147483648,2147483648,0,0,2147483648,2147483648,0,0,0,0,0,2147483648,2147483648,2147483648,2147483648,2147483648,0,2147483648,2147483648,2147483648,0,2147483648]),Sa=new Int32Array([1,32898,32906,2147516416,32907,2147483649,2147516545,32777,138,136,2147516425,2147483658,2147516555,139,32905,32771,32770,128,32778,2147483658,2147516545,32896,2147483649,2147516424]);function Aa(e,t,r){for(var n,i,a,o,u,s,c,l,h,f,p,v,y=0;y<25;y++)t[y]=oa.readUint32LE(r,8*y),e[y]=oa.readUint32LE(r,8*y+4);for(var g=0;g<24;g++)n=e[0]^e[5]^e[10]^e[15]^e[20],i=e[1]^e[6]^e[11]^e[16]^e[21],a=e[2]^e[7]^e[12]^e[17]^e[22],o=e[3]^e[8]^e[13]^e[18]^e[23],u=e[4]^e[9]^e[14]^e[19]^e[24],s=t[0]^t[5]^t[10]^t[15]^t[20],c=t[1]^t[6]^t[11]^t[16]^t[21],l=t[2]^t[7]^t[12]^t[17]^t[22],h=t[3]^t[8]^t[13]^t[18]^t[23],p=u^(i<<1|c>>>31),v=(f=t[4]^t[9]^t[14]^t[19]^t[24])^(c<<1|i>>>31),e[0]^=p,e[5]^=p,e[10]^=p,e[15]^=p,e[20]^=p,t[0]^=v,t[5]^=v,t[10]^=v,t[15]^=v,t[20]^=v,p=n^(a<<1|l>>>31),v=s^(l<<1|a>>>31),e[1]^=p,e[6]^=p,e[11]^=p,e[16]^=p,e[21]^=p,t[1]^=v,t[6]^=v,t[11]^=v,t[16]^=v,t[21]^=v,p=i^(o<<1|h>>>31),v=c^(h<<1|o>>>31),e[2]^=p,e[7]^=p,e[12]^=p,e[17]^=p,e[22]^=p,t[2]^=v,t[7]^=v,t[12]^=v,t[17]^=v,t[22]^=v,p=a^(u<<1|f>>>31),v=l^(f<<1|u>>>31),e[3]^=p,t[3]^=v,e[8]^=p,t[8]^=v,e[13]^=p,t[13]^=v,e[18]^=p,t[18]^=v,e[23]^=p,t[23]^=v,p=o^(n<<1|s>>>31),v=h^(s<<1|n>>>31),e[4]^=p,e[9]^=p,e[14]^=p,e[19]^=p,e[24]^=p,t[4]^=v,t[9]^=v,t[14]^=v,t[19]^=v,t[24]^=v,p=e[1],v=t[1],n=e[10],s=t[10],e[10]=p<<1|v>>>31,t[10]=v<<1|p>>>31,p=n,v=s,n=e[7],s=t[7],e[7]=p<<3|v>>>29,t[7]=v<<3|p>>>29,p=n,v=s,n=e[11],s=t[11],e[11]=p<<6|v>>>26,t[11]=v<<6|p>>>26,p=n,v=s,n=e[17],s=t[17],e[17]=p<<10|v>>>22,t[17]=v<<10|p>>>22,p=n,v=s,n=e[18],s=t[18],e[18]=p<<15|v>>>17,t[18]=v<<15|p>>>17,p=n,v=s,n=e[3],s=t[3],e[3]=p<<21|v>>>11,t[3]=v<<21|p>>>11,p=n,v=s,n=e[5],s=t[5],e[5]=p<<28|v>>>4,t[5]=v<<28|p>>>4,p=n,v=s,n=e[16],s=t[16],e[16]=v<<4|p>>>28,t[16]=p<<4|v>>>28,p=n,v=s,n=e[8],s=t[8],e[8]=v<<13|p>>>19,t[8]=p<<13|v>>>19,p=n,v=s,n=e[21],s=t[21],e[21]=v<<23|p>>>9,t[21]=p<<23|v>>>9,p=n,v=s,n=e[24],s=t[24],e[24]=p<<2|v>>>30,t[24]=v<<2|p>>>30,p=n,v=s,n=e[4],s=t[4],e[4]=p<<14|v>>>18,t[4]=v<<14|p>>>18,p=n,v=s,n=e[15],s=t[15],e[15]=p<<27|v>>>5,t[15]=v<<27|p>>>5,p=n,v=s,n=e[23],s=t[23],e[23]=v<<9|p>>>23,t[23]=p<<9|v>>>23,p=n,v=s,n=e[19],s=t[19],e[19]=v<<24|p>>>8,t[19]=p<<24|v>>>8,p=n,v=s,n=e[13],s=t[13],e[13]=p<<8|v>>>24,t[13]=v<<8|p>>>24,p=n,v=s,n=e[12],s=t[12],e[12]=p<<25|v>>>7,t[12]=v<<25|p>>>7,p=n,v=s,n=e[2],s=t[2],e[2]=v<<11|p>>>21,t[2]=p<<11|v>>>21,p=n,v=s,n=e[20],s=t[20],e[20]=v<<30|p>>>2,t[20]=p<<30|v>>>2,p=n,v=s,n=e[14],s=t[14],e[14]=p<<18|v>>>14,t[14]=v<<18|p>>>14,p=n,v=s,n=e[22],s=t[22],e[22]=v<<7|p>>>25,t[22]=p<<7|v>>>25,p=n,v=s,n=e[9],s=t[9],e[9]=v<<29|p>>>3,t[9]=p<<29|v>>>3,p=n,v=s,n=e[6],s=t[6],e[6]=p<<20|v>>>12,t[6]=v<<20|p>>>12,p=n,v=s,n=e[1],s=t[1],e[1]=v<<12|p>>>20,t[1]=p<<12|v>>>20,p=n,v=s,n=e[0],i=e[1],a=e[2],o=e[3],u=e[4],e[0]^=~i&a,e[1]^=~a&o,e[2]^=~o&u,e[3]^=~u&n,e[4]^=~n&i,s=t[0],c=t[1],l=t[2],h=t[3],f=t[4],t[0]^=~c&l,t[1]^=~l&h,t[2]^=~h&f,t[3]^=~f&s,t[4]^=~s&c,n=e[5],i=e[6],a=e[7],o=e[8],u=e[9],e[5]^=~i&a,e[6]^=~a&o,e[7]^=~o&u,e[8]^=~u&n,e[9]^=~n&i,s=t[5],c=t[6],l=t[7],h=t[8],f=t[9],t[5]^=~c&l,t[6]^=~l&h,t[7]^=~h&f,t[8]^=~f&s,t[9]^=~s&c,n=e[10],i=e[11],a=e[12],o=e[13],u=e[14],e[10]^=~i&a,e[11]^=~a&o,e[12]^=~o&u,e[13]^=~u&n,e[14]^=~n&i,s=t[10],c=t[11],l=t[12],h=t[13],f=t[14],t[10]^=~c&l,t[11]^=~l&h,t[12]^=~h&f,t[13]^=~f&s,t[14]^=~s&c,n=e[15],i=e[16],a=e[17],o=e[18],u=e[19],e[15]^=~i&a,e[16]^=~a&o,e[17]^=~o&u,e[18]^=~u&n,e[19]^=~n&i,s=t[15],c=t[16],l=t[17],h=t[18],f=t[19],t[15]^=~c&l,t[16]^=~l&h,t[17]^=~h&f,t[18]^=~f&s,t[19]^=~s&c,n=e[20],i=e[21],a=e[22],o=e[23],u=e[24],e[20]^=~i&a,e[21]^=~a&o,e[22]^=~o&u,e[23]^=~u&n,e[24]^=~n&i,s=t[20],c=t[21],l=t[22],h=t[23],f=t[24],t[20]^=~c&l,t[21]^=~l&h,t[22]^=~h&f,t[23]^=~f&s,t[24]^=~s&c,e[0]^=Ca[g],t[0]^=Sa[g];for(y=0;y<25;y++)oa.writeUint32LE(t[y],r,8*y),oa.writeUint32LE(e[y],r,8*y+4)}var xa=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).name="SHA3-256",e.usages=[],e}return _createClass(r,[{key:"onDigest",value:function(e,t){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",ya(new Uint8Array(t)).buffer);case 1:case"end":return e.stop()}}),e)})))}}]),r}(zr),Ba=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).name="SHA3-384",e.usages=[],e}return _createClass(r,[{key:"onDigest",value:function(e,t){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",ga(new Uint8Array(t)).buffer);case 1:case"end":return e.stop()}}),e)})))}}]),r}(zr),Ea=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).name="SHA3-512",e.usages=[],e}return _createClass(r,[{key:"onDigest",value:function(e,t){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",da(new Uint8Array(t)).buffer);case 1:case"end":return e.stop()}}),e)})))}}]),r}(zr),Ra=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,[{key:"onDigest",value:function(e,t){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function r(){var n;return _regeneratorRuntime().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=new Uint8Array(e.length),(new wa).update(new Uint8Array(t)).stream(n),r.abrupt("return",n.buffer);case 3:case"end":return r.stop()}}),r)})))}}]),r}(ri),Ka=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,[{key:"onDigest",value:function(e,t){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function r(){var n;return _regeneratorRuntime().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=new Uint8Array(e.length),(new _a).update(new Uint8Array(t)).stream(n),r.abrupt("return",n.buffer);case 3:case"end":return r.stop()}}),r)})))}}]),r}(ni),Oa=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,n,i,a){var o;return _classCallCheck(this,r),(o=t.call(this,e,n,"secret",i)).raw=a,o}return _createClass(r)}(ci),Na=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,[{key:"onImportKey",value:function(e,t,r,n,i){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Oa(r,n,i,s.toUint8Array(t)));case 1:case"end":return e.stop()}}),e)})))}},{key:"onDeriveBits",value:function(e,t,r){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function n(){var i,o,u;return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:o=s.toUint8Array(e.salt),u=t.raw,n.t0=e.hash.name.toUpperCase(),n.next="SHA-1"===n.t0?5:"SHA-256"===n.t0?7:"SHA-512"===n.t0?9:11;break;case 5:return i=a.Pbkdf2HmacSha1(u,o,e.iterations,r>>3),n.abrupt("break",12);case 7:return i=a.Pbkdf2HmacSha256(u,o,e.iterations,r>>3),n.abrupt("break",12);case 9:return i=a.Pbkdf2HmacSha512(u,o,e.iterations,r>>3),n.abrupt("break",12);case 11:throw new Fr("algorithm.hash: '".concat(e.hash.name,"' hash algorithm is not supported"));case 12:return n.abrupt("return",s.toArrayBuffer(i));case 13:case"end":return n.stop()}}),n)})))}},{key:"checkCryptoKey",value:function(e,t){if(_get(_getPrototypeOf(r.prototype),"checkCryptoKey",this).call(this,e,t),!(e instanceof Oa))throw new TypeError("key: Is not PbkdfCryptoKey")}}]),r}(ei),Pa={},Ua={readUInt32BE:function(e,t){return(e[0+t]<<24|e[1+t]<<16|e[2+t]<<8|e[3+t])>>>0},writeUInt32BE:function(e,t,r){e[0+r]=t>>>24,e[1+r]=t>>>16&255,e[2+r]=t>>>8&255,e[3+r]=255&t},ip:function(e,t,r,n){for(var i=0,a=0,o=6;o>=0;o-=2){for(var u=0;u<=24;u+=8)i<<=1,i|=t>>>u+o&1;for(u=0;u<=24;u+=8)i<<=1,i|=e>>>u+o&1}for(o=6;o>=0;o-=2){for(u=1;u<=25;u+=8)a<<=1,a|=t>>>u+o&1;for(u=1;u<=25;u+=8)a<<=1,a|=e>>>u+o&1}r[n+0]=i>>>0,r[n+1]=a>>>0},rip:function(e,t,r,n){for(var i=0,a=0,o=0;o<4;o++)for(var u=24;u>=0;u-=8)i<<=1,i|=t>>>u+o&1,i<<=1,i|=e>>>u+o&1;for(o=4;o<8;o++)for(u=24;u>=0;u-=8)a<<=1,a|=t>>>u+o&1,a<<=1,a|=e>>>u+o&1;r[n+0]=i>>>0,r[n+1]=a>>>0},pc1:function(e,t,r,n){for(var i=0,a=0,o=7;o>=5;o--){for(var u=0;u<=24;u+=8)i<<=1,i|=t>>u+o&1;for(u=0;u<=24;u+=8)i<<=1,i|=e>>u+o&1}for(u=0;u<=24;u+=8)i<<=1,i|=t>>u+o&1;for(o=1;o<=3;o++){for(u=0;u<=24;u+=8)a<<=1,a|=t>>u+o&1;for(u=0;u<=24;u+=8)a<<=1,a|=e>>u+o&1}for(u=0;u<=24;u+=8)a<<=1,a|=e>>u+o&1;r[n+0]=i>>>0,r[n+1]=a>>>0},r28shl:function(e,t){return e<<t&268435455|e>>>28-t}},Ia=[14,11,17,4,27,23,25,0,13,22,7,18,5,9,16,24,2,20,12,21,1,8,15,26,15,4,25,19,9,1,26,16,5,11,23,8,12,7,17,0,22,3,10,14,6,20,27,24];Ua.pc2=function(e,t,r,n){for(var i=0,a=0,o=Ia.length>>>1,u=0;u<o;u++)i<<=1,i|=e>>>Ia[u]&1;for(u=o;u<Ia.length;u++)a<<=1,a|=t>>>Ia[u]&1;r[n+0]=i>>>0,r[n+1]=a>>>0},Ua.expand=function(e,t,r){var n=0,i=0;n=(1&e)<<5|e>>>27;for(var a=23;a>=15;a-=4)n<<=6,n|=e>>>a&63;for(a=11;a>=3;a-=4)i|=e>>>a&63,i<<=6;i|=(31&e)<<1|e>>>31,t[r+0]=n>>>0,t[r+1]=i>>>0};var La=[14,0,4,15,13,7,1,4,2,14,15,2,11,13,8,1,3,10,10,6,6,12,12,11,5,9,9,5,0,3,7,8,4,15,1,12,14,8,8,2,13,4,6,9,2,1,11,7,15,5,12,11,9,3,7,14,3,10,10,0,5,6,0,13,15,3,1,13,8,4,14,7,6,15,11,2,3,8,4,14,9,12,7,0,2,1,13,10,12,6,0,9,5,11,10,5,0,13,14,8,7,10,11,1,10,3,4,15,13,4,1,2,5,11,8,6,12,7,6,12,9,0,3,5,2,14,15,9,10,13,0,7,9,0,14,9,6,3,3,4,15,6,5,10,1,2,13,8,12,5,7,14,11,12,4,11,2,15,8,1,13,1,6,10,4,13,9,0,8,6,15,9,3,8,0,7,11,4,1,15,2,14,12,3,5,11,10,5,14,2,7,12,7,13,13,8,14,11,3,5,0,6,6,15,9,0,10,3,1,4,2,7,8,2,5,12,11,1,12,10,4,14,15,9,10,3,6,15,9,0,0,6,12,10,11,1,7,13,13,8,15,9,1,4,3,5,14,11,5,12,2,7,8,2,4,14,2,14,12,11,4,2,1,12,7,4,10,7,11,13,6,1,8,5,5,0,3,15,15,10,13,3,0,9,14,8,9,6,4,11,2,8,1,12,11,7,10,1,13,14,7,2,8,13,15,6,9,15,12,0,5,9,6,10,3,4,0,5,14,3,12,10,1,15,10,4,15,2,9,7,2,12,6,9,8,5,0,6,13,1,3,13,4,14,14,0,7,11,5,3,11,8,9,4,14,3,15,2,5,12,2,9,8,5,12,15,3,10,7,11,0,14,4,1,10,7,1,6,13,0,11,8,6,13,4,13,11,0,2,11,14,7,15,4,0,9,8,1,13,10,3,14,12,3,9,5,7,12,5,2,10,15,6,8,1,6,1,6,4,11,11,13,13,8,12,1,3,4,7,10,14,7,10,9,15,5,6,0,8,15,0,14,5,2,9,3,2,12,13,1,2,15,8,13,4,8,6,10,15,3,11,7,1,4,10,12,9,5,3,6,14,11,5,0,0,14,12,9,7,2,7,2,11,1,4,14,1,7,9,4,12,10,14,8,2,13,0,15,6,12,10,9,13,0,15,3,3,5,5,6,8,11];Ua.substitute=function(e,t){for(var r=0,n=0;n<4;n++){r<<=4,r|=La[64*n+(e>>>18-6*n&63)]}for(n=0;n<4;n++){r<<=4,r|=La[256+64*n+(t>>>18-6*n&63)]}return r>>>0};var Ta=[16,25,12,11,3,20,4,15,31,17,9,6,27,14,1,22,30,24,8,18,0,5,29,23,13,19,2,26,10,21,28,7];Ua.permute=function(e){for(var t=0,r=0;r<Ta.length;r++)t<<=1,t|=e>>>Ta[r]&1;return t>>>0},Ua.padSplit=function(e,t,r){for(var n=e.toString(2);n.length<t;)n="0"+n;for(var i=[],a=0;a<t;a+=r)i.push(n.slice(a,a+r));return i.join(" ")};var ja=Ha;function Ha(e,t){if(!e)throw new Error(t||"Assertion failed")}Ha.equal=function(e,t,r){if(e!=t)throw new Error(r||"Assertion failed: "+e+" != "+t)};var Va=ja;function Da(e){this.options=e,this.type=this.options.type,this.blockSize=8,this._init(),this.buffer=new Array(this.blockSize),this.bufferOff=0}var Ma=Da;Da.prototype._init=function(){},Da.prototype.update=function(e){return 0===e.length?[]:"decrypt"===this.type?this._updateDecrypt(e):this._updateEncrypt(e)},Da.prototype._buffer=function(e,t){for(var r=Math.min(this.buffer.length-this.bufferOff,e.length-t),n=0;n<r;n++)this.buffer[this.bufferOff+n]=e[t+n];return this.bufferOff+=r,r},Da.prototype._flushBuffer=function(e,t){return this._update(this.buffer,0,e,t),this.bufferOff=0,this.blockSize},Da.prototype._updateEncrypt=function(e){var t=0,r=0,n=(this.bufferOff+e.length)/this.blockSize|0,i=new Array(n*this.blockSize);0!==this.bufferOff&&(t+=this._buffer(e,t),this.bufferOff===this.buffer.length&&(r+=this._flushBuffer(i,r)));for(var a=e.length-(e.length-t)%this.blockSize;t<a;t+=this.blockSize)this._update(e,t,i,r),r+=this.blockSize;for(;t<e.length;t++,this.bufferOff++)this.buffer[this.bufferOff]=e[t];return i},Da.prototype._updateDecrypt=function(e){for(var t=0,r=0,n=Math.ceil((this.bufferOff+e.length)/this.blockSize)-1,i=new Array(n*this.blockSize);n>0;n--)t+=this._buffer(e,t),r+=this._flushBuffer(i,r);return t+=this._buffer(e,t),i},Da.prototype.final=function(e){var t,r;return e&&(t=this.update(e)),r="encrypt"===this.type?this._finalEncrypt():this._finalDecrypt(),t?t.concat(r):r},Da.prototype._pad=function(e,t){if(0===t)return!1;for(;t<e.length;)e[t++]=0;return!0},Da.prototype._finalEncrypt=function(){if(!this._pad(this.buffer,this.bufferOff))return[];var e=new Array(this.blockSize);return this._update(this.buffer,0,e,0),e},Da.prototype._unpad=function(e){return e},Da.prototype._finalDecrypt=function(){Va.equal(this.bufferOff,this.blockSize,"Not enough data to decrypt");var e=new Array(this.blockSize);return this._flushBuffer(e,0),this._unpad(e)};var Fa,Ja={},Ga={},za={get exports(){return Ga},set exports(e){Ga=e}};!function(e){try{var t=require("util");if("function"!=typeof t.inherits)throw"";e.exports=t.inherits}catch(t){e.exports=(Fa||(Fa=1,"function"==typeof Object.create?za.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:za.exports=function(e,t){if(t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}}),Ga)}}({get exports(){return Ja},set exports(e){Ja=e}});var qa=ja,Wa=Ua,Xa=Ma;function Za(){this.tmp=new Array(2),this.keys=null}function $a(e){Xa.call(this,e);var t=new Za;this._desState=t,this.deriveKeys(t,e.key)}Ja($a,Xa);var Ya=$a;$a.create=function(e){return new $a(e)};var Qa=[1,1,2,2,2,2,2,2,1,2,2,2,2,2,2,1];$a.prototype.deriveKeys=function(e,t){e.keys=new Array(32),qa.equal(t.length,this.blockSize,"Invalid key length");var r=Wa.readUInt32BE(t,0),n=Wa.readUInt32BE(t,4);Wa.pc1(r,n,e.tmp,0),r=e.tmp[0],n=e.tmp[1];for(var i=0;i<e.keys.length;i+=2){var a=Qa[i>>>1];r=Wa.r28shl(r,a),n=Wa.r28shl(n,a),Wa.pc2(r,n,e.keys,i)}},$a.prototype._update=function(e,t,r,n){var i=this._desState,a=Wa.readUInt32BE(e,t),o=Wa.readUInt32BE(e,t+4);Wa.ip(a,o,i.tmp,0),a=i.tmp[0],o=i.tmp[1],"encrypt"===this.type?this._encrypt(i,a,o,i.tmp,0):this._decrypt(i,a,o,i.tmp,0),a=i.tmp[0],o=i.tmp[1],Wa.writeUInt32BE(r,a,n),Wa.writeUInt32BE(r,o,n+4)},$a.prototype._pad=function(e,t){for(var r=e.length-t,n=t;n<e.length;n++)e[n]=r;return!0},$a.prototype._unpad=function(e){for(var t=e[e.length-1],r=e.length-t;r<e.length;r++)qa.equal(e[r],t);return e.slice(0,e.length-t)},$a.prototype._encrypt=function(e,t,r,n,i){for(var a=t,o=r,u=0;u<e.keys.length;u+=2){var s=e.keys[u],c=e.keys[u+1];Wa.expand(o,e.tmp,0),s^=e.tmp[0],c^=e.tmp[1];var l=Wa.substitute(s,c),h=o;o=(a^Wa.permute(l))>>>0,a=h}Wa.rip(o,a,n,i)},$a.prototype._decrypt=function(e,t,r,n,i){for(var a=r,o=t,u=e.keys.length-2;u>=0;u-=2){var s=e.keys[u],c=e.keys[u+1];Wa.expand(a,e.tmp,0),s^=e.tmp[0],c^=e.tmp[1];var l=Wa.substitute(s,c),h=a;a=(o^Wa.permute(l))>>>0,o=h}Wa.rip(a,o,n,i)};var eo={},to=ja,ro=Ja,no={};function io(e){to.equal(e.length,8,"Invalid IV length"),this.iv=new Array(8);for(var t=0;t<this.iv.length;t++)this.iv[t]=e[t]}eo.instantiate=function(e){function t(t){e.call(this,t),this._cbcInit()}ro(t,e);for(var r=Object.keys(no),n=0;n<r.length;n++){var i=r[n];t.prototype[i]=no[i]}return t.create=function(e){return new t(e)},t},no._cbcInit=function(){var e=new io(this.options.iv);this._cbcState=e},no._update=function(e,t,r,n){var i=this._cbcState,a=this.constructor.super_.prototype,o=i.iv;if("encrypt"===this.type){for(var u=0;u<this.blockSize;u++)o[u]^=e[t+u];a._update.call(this,o,0,r,n);for(u=0;u<this.blockSize;u++)o[u]=r[n+u]}else{a._update.call(this,e,t,r,n);for(u=0;u<this.blockSize;u++)r[n+u]^=o[u];for(u=0;u<this.blockSize;u++)o[u]=e[t+u]}};var ao=ja,oo=Ma,uo=Ya;function so(e,t){ao.equal(t.length,24,"Invalid key length");var r=t.slice(0,8),n=t.slice(8,16),i=t.slice(16,24);this.ciphers="encrypt"===e?[uo.create({type:"encrypt",key:r}),uo.create({type:"decrypt",key:n}),uo.create({type:"encrypt",key:i})]:[uo.create({type:"decrypt",key:i}),uo.create({type:"encrypt",key:n}),uo.create({type:"decrypt",key:r})]}function co(e){oo.call(this,e);var t=new so(this.type,this.options.key);this._edeState=t}Ja(co,oo);var lo=co;co.create=function(e){return new co(e)},co.prototype._update=function(e,t,r,n){var i=this._edeState;i.ciphers[0]._update(e,t,r,n),i.ciphers[1]._update(r,n,r,n),i.ciphers[2]._update(r,n,r,n)},co.prototype._pad=uo.prototype._pad,co.prototype._unpad=uo.prototype._unpad;var ho,fo=Pa.utils=Ua,po=Pa.Cipher=Ma,vo=Pa.DES=Ya,yo=Pa.CBC=eo,go=Pa.EDE=lo,mo=(ho={__proto__:null,CBC:yo,Cipher:po,DES:vo,EDE:go,default:Pa,utils:fo},[Pa].forEach((function(e){e&&"string"!=typeof e&&!Array.isArray(e)&&Object.keys(e).forEach((function(t){if("default"!==t&&!(t in ho)){var r=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(ho,t,r.get?r:{enumerable:!0,get:function(){return e[t]}})}}))})),Object.freeze(ho)),ko=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,n,i,a){var o;return _classCallCheck(this,r),(o=t.call(this,e,n,"secret",i)).raw=a,o}return _createClass(r,[{key:"toJSON",value:function(){return{kty:"oct",alg:this.getJwkAlgorithm(),k:h.ToBase64Url(this.raw),ext:this.extractable,key_ops:this.usages}}},{key:"getJwkAlgorithm",value:function(){switch(this.algorithm.name.toUpperCase()){case"DES-CBC":return"DES-CBC";case"DES-EDE3-CBC":return"3DES-CBC";default:throw new Dr("Unsupported algorithm name")}}}]),r}(ci),wo=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"checkLib",value:function(){if(void 0===mo)throw new Fr("Cannot implement DES mechanism. Add 'https://peculiarventures.github.io/pv-webcrypto-tests/src/des.js' script to your project")}},{key:"checkCryptoKey",value:function(e){if(!(e instanceof ko))throw new TypeError("key: Is not DesCryptoKey")}},{key:"generateKey",value:function(t,r,n){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function i(){var a;return _regeneratorRuntime().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return this.checkLib(),a=e.nativeCrypto.getRandomValues(new Uint8Array(t.length/8)),i.abrupt("return",new ko(t,r,n,a));case 3:case"end":return i.stop()}}),i,this)})))}},{key:"exportKey",value:function(e,t){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function r(){return _regeneratorRuntime().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:this.checkLib(),r.t0=e,r.next="jwk"===r.t0?4:"raw"===r.t0?5:6;break;case 4:return r.abrupt("return",t.toJSON());case 5:return r.abrupt("return",t.raw.buffer);case 6:throw new Fr("format: Must be 'jwk' or 'raw'");case 7:case"end":return r.stop()}}),r,this)})))}},{key:"importKey",value:function(e,t,r,n,i){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function e(){var a,o;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.checkLib(),a=Gr(t)?h.FromBase64Url(t.k):s.toArrayBuffer(t),!("DES-CBC"===r.name&&8!==a.byteLength||"DES-EDE3-CBC"===r.name&&24!==a.byteLength)){e.next=4;break}throw new Fr("keyData: Is wrong key length");case 4:return o=new ko({name:r.name,length:a.byteLength<<3},n,i,new Uint8Array(a)),e.abrupt("return",o);case 6:case"end":return e.stop()}}),e,this)})))}},{key:"encrypt",value:function(e,t,r){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function n(){return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",this.cipher(e,t,r,!0));case 1:case"end":return n.stop()}}),n,this)})))}},{key:"decrypt",value:function(e,t,r){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function n(){return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",this.cipher(e,t,r,!1));case 1:case"end":return n.stop()}}),n,this)})))}},{key:"cipher",value:function(e,t,r,n){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function i(){var a,o,u,c;return _regeneratorRuntime().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:this.checkLib(),a=n?"encrypt":"decrypt",u=s.toUint8Array(e.iv),i.t0=e.name.toUpperCase(),i.next="DES-CBC"===i.t0?6:"DES-EDE3-CBC"===i.t0?8:10;break;case 6:return o=yo.instantiate(vo).create({key:t.raw,type:a,iv:u}),i.abrupt("break",11);case 8:return o=yo.instantiate(go).create({key:t.raw,type:a,iv:u}),i.abrupt("break",11);case 10:throw new Fr("algorithm: Is not recognized");case 11:return c=o.update(new Uint8Array(r)).concat(o.final()),i.abrupt("return",new Uint8Array(c).buffer);case 13:case"end":return i.stop()}}),i,this)})))}}]),t}(),bo=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).keySizeBits=64,e.ivSize=8,e.name="DES-CBC",e}return _createClass(r,[{key:"onGenerateKey",value:function(e,t,r){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function n(){return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",wo.generateKey(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onExportKey",value:function(e,t){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function r(){return _regeneratorRuntime().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",wo.exportKey(e,t));case 1:case"end":return r.stop()}}),r)})))}},{key:"onImportKey",value:function(e,t,r,n,i){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function a(){return _regeneratorRuntime().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",wo.importKey(e,t,r,n,i));case 1:case"end":return a.stop()}}),a)})))}},{key:"onEncrypt",value:function(e,t,r){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function n(){return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",wo.encrypt(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onDecrypt",value:function(e,t,r){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function n(){return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",wo.decrypt(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"checkCryptoKey",value:function(e,t){_get(_getPrototypeOf(r.prototype),"checkCryptoKey",this).call(this,e,t),wo.checkCryptoKey(e)}}]),r}(Qr),_o=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).keySizeBits=192,e.ivSize=8,e.name="DES-EDE3-CBC",e}return _createClass(r,[{key:"onGenerateKey",value:function(e,t,r){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function n(){return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",wo.generateKey(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onExportKey",value:function(e,t){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function r(){return _regeneratorRuntime().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",wo.exportKey(e,t));case 1:case"end":return r.stop()}}),r)})))}},{key:"onImportKey",value:function(e,t,r,n,i){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function a(){return _regeneratorRuntime().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",wo.importKey(e,t,r,n,i));case 1:case"end":return a.stop()}}),a)})))}},{key:"onEncrypt",value:function(e,t,r){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function n(){return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",wo.encrypt(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onDecrypt",value:function(e,t,r){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function n(){return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",wo.decrypt(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"checkCryptoKey",value:function(e,t){_get(_getPrototypeOf(r.prototype),"checkCryptoKey",this).call(this,e,t),wo.checkCryptoKey(e)}}]),r}(Qr),Co={fromJSON:function(e){return Buffer.from(h.FromBase64Url(e))},toJSON:function(e){return h.ToBase64Url(e)}},So=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{name:"HMAC"},i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Uint8Array(0);return _classCallCheck(this,r),(e=t.call(this,n,i,"secret",a)).kty="oct",e.data=o,e}return _createClass(r,[{key:"alg",get:function(){var e=this.algorithm.hash.name.toUpperCase();return"HS".concat(e.replace("SHA-",""))},set:function(e){}}]),r}(ci);mr([Hr({name:"ext",type:wr.Boolean,optional:!0})],So.prototype,"extractable",void 0),mr([Hr({name:"key_ops",type:wr.String,repeated:!0,optional:!0})],So.prototype,"usages",void 0),mr([Hr({name:"k",converter:Co})],So.prototype,"data",void 0),mr([Hr({type:wr.String})],So.prototype,"kty",void 0),mr([Hr({type:wr.String})],So.prototype,"alg",null);var Ao,xo=function(t){_inherits(n,t);var r=_createSuper(n);function n(){return _classCallCheck(this,n),r.apply(this,arguments)}return _createClass(n,[{key:"onGenerateKey",value:function(t,r,n){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function i(){var a,o,u;return _regeneratorRuntime().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return a=t.length||this.getDefaultLength(t.hash.name),o=e.nativeCrypto.getRandomValues(new Uint8Array(a>>3)),u=new So(t,r,n,o),i.abrupt("return",u);case 4:case"end":return i.stop()}}),i,this)})))}},{key:"onSign",value:function(e,t,r){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function e(){var n,i;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.algorithm.hash.name.toUpperCase(),e.next="SHA-1"===e.t0?3:"SHA-256"===e.t0?5:"SHA-512"===e.t0?7:9;break;case 3:return n=a.HmacSha1,e.abrupt("break",10);case 5:return n=a.HmacSha256,e.abrupt("break",10);case 7:return n=a.HmacSha512,e.abrupt("break",10);case 9:throw new Fr("key.algorithm.hash: Is not recognized");case 10:return i=new n(t.data).process(s.toUint8Array(r)).finish().result,e.abrupt("return",s.toArrayBuffer(i));case 12:case"end":return e.stop()}}),e)})))}},{key:"onVerify",value:function(e,t,r,n){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function i(){var a;return _regeneratorRuntime().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,this.onSign(e,t,n);case 2:return a=i.sent,i.abrupt("return",h.ToHex(a)===h.ToHex(r));case 4:case"end":return i.stop()}}),i,this)})))}},{key:"onImportKey",value:function(e,t,r,n,i){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function a(){var o;return _regeneratorRuntime().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:a.t0=e.toLowerCase(),a.next="jwk"===a.t0?3:"raw"===a.t0?5:9;break;case 3:return o=jr.fromJSON(t,{targetSchema:So}),a.abrupt("break",10);case 5:if(s.isBufferSource(t)){a.next=7;break}throw new TypeError("keyData: Is not ArrayBuffer or ArrayBufferView");case 7:return o=new So(r,n,i,s.toUint8Array(t)),a.abrupt("break",10);case 9:throw new Fr("format: Must be 'jwk' or 'raw'");case 10:return o.algorithm={hash:{name:r.hash.name},name:this.name,length:o.data.length<<3},o.extractable=n,o.usages=i,a.abrupt("return",o);case 14:case"end":return a.stop()}}),a,this)})))}},{key:"onExportKey",value:function(e,t){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function r(){var n;return _regeneratorRuntime().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:r.t0=e.toLowerCase(),r.next="jwk"===r.t0?3:"raw"===r.t0?5:6;break;case 3:return n=Tr.toJSON(t),r.abrupt("return",n);case 5:return r.abrupt("return",new Uint8Array(t.data).buffer);case 6:throw new Fr("format: Must be 'jwk' or 'raw'");case 7:case"end":return r.stop()}}),r)})))}},{key:"checkCryptoKey",value:function(e,t){if(_get(_getPrototypeOf(n.prototype),"checkCryptoKey",this).call(this,e,t),!(e instanceof So))throw new TypeError("key: Is not HMAC CryptoKey")}}]),n}(Qn),Bo=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,n,i,a,o){var u;return _classCallCheck(this,r),u=t.call(this,e,n,i,a),Ao.set(_assertThisInitialized(u),void 0),function(e,t,r,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");"a"===n?i.call(e,r):i?i.value=r:t.set(e,r)}(_assertThisInitialized(u),Ao,o,"f"),u}return _createClass(r,[{key:"getNative",value:function(){return function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)}(this,Ao,"f")}}]),r}(ci);Ao=new WeakMap;var Eo=function(t){_inherits(n,t);var r=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=r.call(this)).browserInfo=function(){var e={name:Yn.Unknown,version:"0"};if("undefined"==typeof self)return e;var t,r=self.navigator.userAgent;return(t=/edge\/([\d\.]+)/i.exec(r))?(e.name=Yn.Edge,e.version=t[1]):/msie/i.test(r)?(e.name=Yn.IE,e.version=/msie ([\d\.]+)/i.exec(r)[1]):/Trident/i.test(r)?(e.name=Yn.IE,e.version=/rv:([\d\.]+)/i.exec(r)[1]):/chrome/i.test(r)?(e.name=Yn.Chrome,e.version=/chrome\/([\d\.]+)/i.exec(r)[1]):/firefox/i.test(r)?(e.name=Yn.Firefox,e.version=/firefox\/([\d\.]+)/i.exec(r)[1]):/mobile/i.test(r)?(e.name=Yn.Mobile,e.version=/mobile\/([\w]+)/i.exec(r)[1]):/safari/i.test(r)&&(e.name=Yn.Safari,e.version=/version\/([\d\.]+)/i.exec(r)[1]),e}(),e.providers.set(new pi),e.providers.set(new gi),e.providers.set(new vi),e.providers.set(new yi),e.providers.set(new di),e.providers.set(new bo),e.providers.set(new _o),e.providers.set(new Ci),e.providers.set(new _i),e.providers.set(new bi),e.providers.set(new Si),e.providers.set(new Oi),e.providers.set(new Ri),e.providers.set(new Hi),e.providers.set(new Vi),e.providers.set(new Di),e.providers.set(new Na),e.providers.set(new xo),e.providers.set(new Ti),e.providers.set(new ji),e.providers.set(new xa),e.providers.set(new Ba),e.providers.set(new Ea),e.providers.set(new Ra),e.providers.set(new Ka),e}return _createClass(n,[{key:"digest",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return kr(this,void 0,void 0,_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.wrapNative.apply(this,["digest"].concat(t)));case 1:case"end":return e.stop()}}),e,this)})))}},{key:"importKey",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return kr(this,void 0,void 0,_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.fixFirefoxEcImportPkcs8(t),e.abrupt("return",this.wrapNative.apply(this,["importKey"].concat(t)));case 2:case"end":return e.stop()}}),e,this)})))}},{key:"exportKey",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return kr(this,void 0,void 0,_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fixFirefoxEcExportPkcs8(t);case 2:if(e.t0=e.sent,e.t0){e.next=7;break}return e.next=6,this.wrapNative.apply(this,["exportKey"].concat(t));case 6:e.t0=e.sent;case 7:return e.abrupt("return",e.t0);case 8:case"end":return e.stop()}}),e,this)})))}},{key:"generateKey",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return kr(this,void 0,void 0,_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.wrapNative.apply(this,["generateKey"].concat(t)));case 1:case"end":return e.stop()}}),e,this)})))}},{key:"sign",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return kr(this,void 0,void 0,_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.wrapNative.apply(this,["sign"].concat(t)));case 1:case"end":return e.stop()}}),e,this)})))}},{key:"verify",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return kr(this,void 0,void 0,_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.wrapNative.apply(this,["verify"].concat(t)));case 1:case"end":return e.stop()}}),e,this)})))}},{key:"encrypt",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return kr(this,void 0,void 0,_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.wrapNative.apply(this,["encrypt"].concat(t)));case 1:case"end":return e.stop()}}),e,this)})))}},{key:"decrypt",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return kr(this,void 0,void 0,_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.wrapNative.apply(this,["decrypt"].concat(t)));case 1:case"end":return e.stop()}}),e,this)})))}},{key:"wrapKey",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return kr(this,void 0,void 0,_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.wrapNative.apply(this,["wrapKey"].concat(t)));case 1:case"end":return e.stop()}}),e,this)})))}},{key:"unwrapKey",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return kr(this,void 0,void 0,_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.wrapNative.apply(this,["unwrapKey"].concat(t)));case 1:case"end":return e.stop()}}),e,this)})))}},{key:"deriveBits",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return kr(this,void 0,void 0,_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.wrapNative.apply(this,["deriveBits"].concat(t)));case 1:case"end":return e.stop()}}),e,this)})))}},{key:"deriveKey",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return kr(this,void 0,void 0,_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.wrapNative.apply(this,["deriveKey"].concat(t)));case 1:case"end":return e.stop()}}),e,this)})))}},{key:"wrapNative",value:function(t){for(var r=this,i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];return kr(this,void 0,void 0,_regeneratorRuntime().mark((function i(){var o,u,s,c,l,f,p,v,y,g,d,m,k,w,b,_;return _regeneratorRuntime().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(~["generateKey","unwrapKey","deriveKey","importKey"].indexOf(t)&&this.fixAlgorithmName(a),i.prev=1,"digest"===t&&a.some((function(e){return e instanceof ci}))){i.next=9;break}return o=this.fixNativeArguments(t,a),ui.info("Call native '".concat(t,"' method"),o),i.next=7,e.nativeSubtle[t].apply(e.nativeSubtle,o);case 7:return u=i.sent,i.abrupt("return",this.fixNativeResult(t,a,u));case 9:i.next=14;break;case 11:i.prev=11,i.t0=i.catch(1),ui.warn("Error on native '".concat(t,"' calling. ").concat(i.t0.message),i.t0);case 14:if("wrapKey"!==t){i.next=30;break}return i.prev=15,ui.info("Trying to wrap key by using native functions",a),i.next=19,this.exportKey(a[0],a[1]);case 19:return s=i.sent,c="jwk"===a[0]?h.FromUtf8String(JSON.stringify(s)):s,i.next=23,this.encrypt(a[3],a[2],c);case 23:return l=i.sent,i.abrupt("return",l);case 27:i.prev=27,i.t1=i.catch(15),ui.warn("Cannot wrap key by native functions. ".concat(i.t1.message),i.t1);case 30:if("unwrapKey"!==t){i.next=46;break}return i.prev=31,ui.info("Trying to unwrap key by using native functions",a),i.next=35,this.decrypt(a[3],a[2],a[1]);case 35:return f=i.sent,p="jwk"===a[0]?JSON.parse(h.ToUtf8String(f)):f,i.next=39,this.importKey(a[0],p,a[4],a[5],a[6]);case 39:return v=i.sent,i.abrupt("return",v);case 43:i.prev=43,i.t2=i.catch(31),ui.warn("Cannot unwrap key by native functions. ".concat(i.t2.message),i.t2);case 46:if("deriveKey"!==t){i.next=61;break}return i.prev=47,ui.info("Trying to derive key by using native functions",a),i.next=51,this.deriveBits(a[0],a[1],a[2].length);case 51:return y=i.sent,i.next=54,this.importKey("raw",y,a[2],a[3],a[4]);case 54:return g=i.sent,i.abrupt("return",g);case 58:i.prev=58,i.t3=i.catch(47),ui.warn("Cannot derive key by native functions. ".concat(i.t3.message),i.t3);case 61:if("deriveBits"!==t&&"deriveKey"!==t){i.next=72;break}d=0,m=a;case 63:if(!(d<m.length)){i.next=72;break}if("object"!==_typeof(k=m[d])||!k.public||!n.isAnotherKey(k.public)){i.next=69;break}return i.next=68,this.castKey(k.public);case 68:k.public=i.sent;case 69:d++,i.next=63;break;case 72:w=0;case 73:if(!(w<a.length)){i.next=82;break}if(b=a[w],!n.isAnotherKey(b)){i.next=79;break}return i.next=78,this.castKey(b);case 78:a[w]=i.sent;case 79:w++,i.next=73;break;case 82:if(C=t,"function"!=typeof(_=_get(_getPrototypeOf(n.prototype),C,r))){i.next=85;break}return i.abrupt("return",_.apply(this,a));case 85:throw new Error("Incorrect type of 'method'. Must be 'function'.");case 86:case"end":return i.stop()}var C}),i,this,[[1,11],[15,27],[31,43],[47,58]])})))}},{key:"fixNativeArguments",value:function(e,t){var r,n,i,a,o,u,c,l,f=_toConsumableArray(t);if("importKey"===e&&(this.browserInfo.name!==Yn.IE||"jwk"!==(null===(n=null===(r=f[0])||void 0===r?void 0:r.toLowerCase)||void 0===n?void 0:n.call(r))||s.isBufferSource(f[1])||(f[1]=h.FromUtf8String(JSON.stringify(f[1])))),this.browserInfo.name===Yn.IE&&t[1]instanceof Bo)switch(e){case"sign":case"verify":case"encrypt":case"decrypt":f[0]=Object.assign(Object.assign({},this.prepareAlgorithm(f[0])),{hash:null===(o=null===(a=null===(i=f[1])||void 0===i?void 0:i.algorithm)||void 0===a?void 0:a.hash)||void 0===o?void 0:o.name});break;case"wrapKey":case"unwrapKey":f[4]=Object.assign(Object.assign({},this.prepareAlgorithm(f[4])),{hash:null===(l=null===(c=null===(u=f[3])||void 0===u?void 0:u.algorithm)||void 0===c?void 0:c.hash)||void 0===l?void 0:l.name})}for(var p=0;p<f.length;p++){var v=f[p];v instanceof Bo&&(f[p]=v.getNative())}return f}},{key:"fixNativeResult",value:function(e,t,r){var n,i;if(this.browserInfo.name===Yn.IE){if("exportKey"===e&&"jwk"===(null===(i=null===(n=t[0])||void 0===n?void 0:n.toLowerCase)||void 0===i?void 0:i.call(n))&&r instanceof ArrayBuffer)return JSON.parse(h.ToUtf8String(r));if("privateKey"in r){var a=["sign","decrypt","unwrapKey","deriveKey","deriveBits"],o=["verify","encrypt","wrapKey"];return{privateKey:this.wrapNativeKey(r.privateKey,t[0],t[1],t[2].filter((function(e){return a.includes(e)}))),publicKey:this.wrapNativeKey(r.publicKey,t[0],t[1],t[2].filter((function(e){return o.includes(e)})))}}if("extractable"in r){var u,s;switch(e){case"importKey":u=t[2],s=t[4];break;case"unwrapKey":u=t[4],s=t[6];break;case"generateKey":u=t[0],s=t[2];break;default:throw new Fr("Cannot wrap native key. Unsupported method in use")}return this.wrapNativeKey(r,u,r.extractable,s)}}return r}},{key:"wrapNativeKey",value:function(e,t,r,n){if(this.browserInfo.name===Yn.IE){var i=["RSASSA-PKCS1-v1_5","RSA-PSS","RSA-OAEP","AES-CBC","AES-CTR","AES-KW","HMAC"],a=i.map((function(e){return e.toLowerCase()})).indexOf(e.algorithm.name.toLowerCase());if(-1!==a){var o=this.prepareAlgorithm(t),u=Object.assign(Object.assign({},e.algorithm),{name:i[a]});return oi.isHashedAlgorithm(o)&&(u.hash={name:o.hash.name.toUpperCase()}),ui.info("Wrapping ".concat(i[a]," crypto key to WrappedNativeCryptoKey")),new Bo(u,r,e.type,n,e)}}return e}},{key:"castKey",value:function(e){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function t(){var r,n;return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(ui.info("Cast native CryptoKey to linter key.",e),e.extractable){t.next=3;break}throw new Error("Cannot cast unextractable crypto key");case 3:return r=this.getProvider(e.algorithm.name),t.next=6,this.exportKey("jwk",e);case 6:return n=t.sent,t.abrupt("return",r.importKey("jwk",n,e.algorithm,!0,e.usages));case 8:case"end":return t.stop()}}),t,this)})))}},{key:"fixAlgorithmName",value:function(e){if(this.browserInfo.name===Yn.Edge)for(var t=0;t<e.length;t++){var r=e[0];if("string"==typeof r){var n,i=_createForOfIteratorHelper(this.providers.algorithms);try{for(i.s();!(n=i.n()).done;){var a=n.value;if(a.toLowerCase()===r.toLowerCase()){e[t]=a;break}}}catch(e){i.e(e)}finally{i.f()}}else if("object"===_typeof(r)&&"string"==typeof r.name){var o,u=_createForOfIteratorHelper(this.providers.algorithms);try{for(u.s();!(o=u.n()).done;){var s=o.value;s.toLowerCase()===r.name.toLowerCase()&&(r.name=s),("string"==typeof r.hash&&s.toLowerCase()===r.hash.toLowerCase()||"object"===_typeof(r.hash)&&"string"==typeof r.hash.name&&s.toLowerCase()===r.hash.name.toLowerCase())&&(r.hash={name:s})}}catch(e){u.e(e)}finally{u.f()}}}}},{key:"fixFirefoxEcImportPkcs8",value:function(e){var t=this.prepareAlgorithm(e[2]),r=t.name.toUpperCase();if(this.browserInfo.name===Yn.Firefox&&"pkcs8"===e[0]&&~["ECDSA","ECDH"].indexOf(r)&&~["P-256","P-384","P-521"].indexOf(t.namedCurve)){if(!s.isBufferSource(e[1]))throw new TypeError("data: Is not ArrayBuffer or ArrayBufferView");var n=s.toArrayBuffer(e[1]),i=dr.parse(n,Zn.PrivateKeyInfo),a=dr.parse(i.privateKey,Zn.EcPrivateKey),o=Tr.toJSON(a);o.ext=!0,o.key_ops=e[4],o.crv=t.namedCurve,o.kty="EC",e[0]="jwk",e[1]=o}}},{key:"fixFirefoxEcExportPkcs8",value:function(e){return kr(this,void 0,void 0,_regeneratorRuntime().mark((function t(){var r,n,i;return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,this.browserInfo.name!==Yn.Firefox||"pkcs8"!==e[0]||!~["ECDSA","ECDH"].indexOf(e[1].algorithm.name)||!~["P-256","P-384","P-521"].indexOf(e[1].algorithm.namedCurve)){t.next=11;break}return t.next=4,this.exportKey("jwk",e[1]);case 4:return r=t.sent,n=jr.fromJSON(r,{targetSchema:Zn.EcPrivateKey}),(i=new Zn.PrivateKeyInfo).privateKeyAlgorithm.algorithm=Ei.ASN_ALGORITHM,i.privateKeyAlgorithm.parameters=dr.serialize(new Zn.ObjectIdentifier(xi(e[1].algorithm.namedCurve))),i.privateKey=dr.serialize(n),t.abrupt("return",dr.serialize(i));case 11:t.next=17;break;case 13:return t.prev=13,t.t0=t.catch(0),ui.error(t.t0),t.abrupt("return",null);case 17:case"end":return t.stop()}}),t,this,[[0,13]])})))}}],[{key:"isAnotherKey",value:function(e){return"object"===_typeof(e)&&"string"==typeof e.type&&"boolean"==typeof e.extractable&&"object"===_typeof(e.algorithm)&&!(e instanceof ci)}}]),n}(oi);Eo.methods=["digest","importKey","exportKey","sign","verify","generateKey","encrypt","decrypt","deriveBits","deriveKey","wrapKey","unwrapKey"];var Ro=function(t){_inherits(n,t);var r=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=r.apply(this,arguments)).subtle=new Eo,e}return _createClass(n,[{key:"nativeCrypto",get:function(){return e.nativeCrypto}},{key:"getRandomValues",value:function(t){return e.nativeCrypto.getRandomValues(t)}}]),n}(ii);function Ko(e,t){var r=e[t];e[t]=function(){var n=arguments;return new Promise((function(i,a){var o=r.apply(e,n);o.oncomplete=function(e){i(e.target.result)},o.onerror=function(e){a("Error on running '".concat(t,"' function"))}}))}}"undefined"!=typeof self&&self.msCrypto&&(Ko(e.nativeSubtle,"generateKey"),Ko(e.nativeSubtle,"digest"),Ko(e.nativeSubtle,"sign"),Ko(e.nativeSubtle,"verify"),Ko(e.nativeSubtle,"encrypt"),Ko(e.nativeSubtle,"decrypt"),Ko(e.nativeSubtle,"importKey"),Ko(e.nativeSubtle,"exportKey"),Ko(e.nativeSubtle,"wrapKey"),Ko(e.nativeSubtle,"unwrapKey"),Ko(e.nativeSubtle,"deriveKey"),Ko(e.nativeSubtle,"deriveBits")),Math.imul||(Math.imul=function(e,t){var r=65535&e,n=65535&t;return r*n+((e>>>16&65535)*n+r*(t>>>16&65535)<<16>>>0)|0});var Oo=self;e.nativeCrypto&&Object.freeze(e.nativeCrypto.getRandomValues);try{delete self.crypto,Oo.crypto=new Ro,Object.freeze(Oo.crypto)}catch(e){ui.error(e)}var No=Oo.crypto;return e.Crypto=Ro,e.CryptoKey=ci,e.crypto=No,e.setCrypto=function(t){e.nativeCrypto=t,e.nativeSubtle=t.subtle},e}({},self.asmCrypto,self.elliptic);
